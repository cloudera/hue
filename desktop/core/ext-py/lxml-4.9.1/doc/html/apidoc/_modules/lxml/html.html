<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>lxml.html &mdash; lxml  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> lxml
            <img src="../../_static/python-xml.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                4.9.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../lxml.html">lxml package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../lxml.html.html">lxml.html package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../lxml.html.ElementSoup.html">lxml.html.ElementSoup module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../lxml.html._diffcommand.html">lxml.html._diffcommand module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../lxml.html._setmixin.html">lxml.html._setmixin module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../lxml.html.builder.html">lxml.html.builder module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../lxml.html.clean.html">lxml.html.clean module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../lxml.html.defs.html">lxml.html.defs module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../lxml.html.diff.html">lxml.html.diff module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../lxml.html.formfill.html">lxml.html.formfill module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../lxml.html.html5parser.html">lxml.html.html5parser module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../lxml.html.soupparser.html">lxml.html.soupparser module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../lxml.isoschematron.html">lxml.isoschematron package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../lxml.ElementInclude.html">lxml.ElementInclude module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../lxml._elementpath.html">lxml._elementpath module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../lxml.builder.html">lxml.builder module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../lxml.cssselect.html">lxml.cssselect module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../lxml.doctestcompare.html">lxml.doctestcompare module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../lxml.etree.html">lxml.etree module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../lxml.objectify.html">lxml.objectify module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../lxml.sax.html">lxml.sax module</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">lxml</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
          <li><a href="../lxml.html">lxml</a> &raquo;</li>
      <li>lxml.html</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for lxml.html</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (c) 2004 Ian Bicking. All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># Redistribution and use in source and binary forms, with or without</span>
<span class="c1"># modification, are permitted provided that the following conditions are</span>
<span class="c1"># met:</span>
<span class="c1">#</span>
<span class="c1"># 1. Redistributions of source code must retain the above copyright</span>
<span class="c1"># notice, this list of conditions and the following disclaimer.</span>
<span class="c1">#</span>
<span class="c1"># 2. Redistributions in binary form must reproduce the above copyright</span>
<span class="c1"># notice, this list of conditions and the following disclaimer in</span>
<span class="c1"># the documentation and/or other materials provided with the</span>
<span class="c1"># distribution.</span>
<span class="c1">#</span>
<span class="c1"># 3. Neither the name of Ian Bicking nor the names of its contributors may</span>
<span class="c1"># be used to endorse or promote products derived from this software</span>
<span class="c1"># without specific prior written permission.</span>
<span class="c1">#</span>
<span class="c1"># THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<span class="c1"># &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<span class="c1"># LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<span class="c1"># A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL IAN BICKING OR</span>
<span class="c1"># CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,</span>
<span class="c1"># EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,</span>
<span class="c1"># PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR</span>
<span class="c1"># PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF</span>
<span class="c1"># LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING</span>
<span class="c1"># NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span>
<span class="c1"># SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>

<span class="sd">&quot;&quot;&quot;The ``lxml.html`` tool set for HTML handling.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;document_fromstring&#39;</span><span class="p">,</span> <span class="s1">&#39;fragment_fromstring&#39;</span><span class="p">,</span> <span class="s1">&#39;fragments_fromstring&#39;</span><span class="p">,</span> <span class="s1">&#39;fromstring&#39;</span><span class="p">,</span>
    <span class="s1">&#39;tostring&#39;</span><span class="p">,</span> <span class="s1">&#39;Element&#39;</span><span class="p">,</span> <span class="s1">&#39;defs&#39;</span><span class="p">,</span> <span class="s1">&#39;open_in_browser&#39;</span><span class="p">,</span> <span class="s1">&#39;submit_form&#39;</span><span class="p">,</span>
    <span class="s1">&#39;find_rel_links&#39;</span><span class="p">,</span> <span class="s1">&#39;find_class&#39;</span><span class="p">,</span> <span class="s1">&#39;make_links_absolute&#39;</span><span class="p">,</span>
    <span class="s1">&#39;resolve_base_href&#39;</span><span class="p">,</span> <span class="s1">&#39;iterlinks&#39;</span><span class="p">,</span> <span class="s1">&#39;rewrite_links&#39;</span><span class="p">,</span> <span class="s1">&#39;parse&#39;</span><span class="p">]</span>


<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">MutableMapping</span><span class="p">,</span> <span class="n">MutableSet</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">MutableMapping</span><span class="p">,</span> <span class="n">MutableSet</span>

<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">etree</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">defs</span>
<span class="kn">from</span> <span class="nn">._setmixin</span> <span class="kn">import</span> <span class="n">SetMixin</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">urlparse</span> <span class="kn">import</span> <span class="n">urljoin</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="c1"># Python 3</span>
    <span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urljoin</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">unicode</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="c1"># Python 3</span>
    <span class="n">unicode</span> <span class="o">=</span> <span class="nb">str</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">basestring</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="c1"># Python 3</span>
    <span class="n">basestring</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span>


<div class="viewcode-block" id="__fix_docstring"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.__fix_docstring">[docs]</a><span class="k">def</span> <span class="nf">__fix_docstring</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">s</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">sub</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(\s*)u&#39;&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="p">)</span><span class="o">.</span><span class="n">sub</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sub</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(\s*)b&#39;&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="p">)</span><span class="o">.</span><span class="n">sub</span>
    <span class="k">return</span> <span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\1&#39;&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span></div>


<span class="n">XHTML_NAMESPACE</span> <span class="o">=</span> <span class="s2">&quot;http://www.w3.org/1999/xhtml&quot;</span>

<span class="n">_rel_links_xpath</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">XPath</span><span class="p">(</span><span class="s2">&quot;descendant-or-self::a[@rel]|descendant-or-self::x:a[@rel]&quot;</span><span class="p">,</span>
                               <span class="n">namespaces</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="n">XHTML_NAMESPACE</span><span class="p">})</span>
<span class="n">_options_xpath</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">XPath</span><span class="p">(</span><span class="s2">&quot;descendant-or-self::option|descendant-or-self::x:option&quot;</span><span class="p">,</span>
                             <span class="n">namespaces</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="n">XHTML_NAMESPACE</span><span class="p">})</span>
<span class="n">_forms_xpath</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">XPath</span><span class="p">(</span><span class="s2">&quot;descendant-or-self::form|descendant-or-self::x:form&quot;</span><span class="p">,</span>
                           <span class="n">namespaces</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="n">XHTML_NAMESPACE</span><span class="p">})</span>
<span class="c1">#_class_xpath = etree.XPath(r&quot;descendant-or-self::*[regexp:match(@class, concat(&#39;\b&#39;, $class_name, &#39;\b&#39;))]&quot;, {&#39;regexp&#39;: &#39;http://exslt.org/regular-expressions&#39;})</span>
<span class="n">_class_xpath</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">XPath</span><span class="p">(</span><span class="s2">&quot;descendant-or-self::*[@class and contains(concat(&#39; &#39;, normalize-space(@class), &#39; &#39;), concat(&#39; &#39;, $class_name, &#39; &#39;))]&quot;</span><span class="p">)</span>
<span class="n">_id_xpath</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">XPath</span><span class="p">(</span><span class="s2">&quot;descendant-or-self::*[@id=$id]&quot;</span><span class="p">)</span>
<span class="n">_collect_string_content</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">XPath</span><span class="p">(</span><span class="s2">&quot;string()&quot;</span><span class="p">)</span>
<span class="n">_iter_css_urls</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;url\((&#39;</span><span class="o">+</span><span class="s1">&#39;[&quot;][^&quot;]*[&quot;]|&#39;</span><span class="o">+</span><span class="s2">&quot;[&#39;][^&#39;]*[&#39;]|&quot;</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;[^)]*)\)&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span><span class="o">.</span><span class="n">finditer</span>
<span class="n">_iter_css_imports</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;@import &quot;(.*?)&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">finditer</span>
<span class="n">_label_xpath</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">XPath</span><span class="p">(</span><span class="s2">&quot;//label[@for=$id]|//x:label[@for=$id]&quot;</span><span class="p">,</span>
                           <span class="n">namespaces</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="n">XHTML_NAMESPACE</span><span class="p">})</span>
<span class="n">_archive_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^ ]+&#39;</span><span class="p">)</span>
<span class="n">_parse_meta_refresh_url</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="sa">r</span><span class="s1">&#39;[^;=]*;\s*(?:url\s*=\s*)?(?P&lt;url&gt;.*)$&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span><span class="o">.</span><span class="n">search</span>


<div class="viewcode-block" id="_unquote_match"><a class="viewcode-back" href="../../lxml.html.html#lxml.html._unquote_match">[docs]</a><span class="k">def</span> <span class="nf">_unquote_match</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">s</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">or</span> <span class="n">s</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">pos</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">s</span><span class="p">,</span><span class="n">pos</span></div>


<div class="viewcode-block" id="_transform_result"><a class="viewcode-back" href="../../lxml.html.html#lxml.html._transform_result">[docs]</a><span class="k">def</span> <span class="nf">_transform_result</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert the result back into the input type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">tostring</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="n">unicode</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">tostring</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;unicode&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="_nons"><a class="viewcode-back" href="../../lxml.html.html#lxml.html._nons">[docs]</a><span class="k">def</span> <span class="nf">_nons</span><span class="p">(</span><span class="n">tag</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;{&#39;</span> <span class="ow">and</span> <span class="n">tag</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">XHTML_NAMESPACE</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">XHTML_NAMESPACE</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">tag</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">tag</span></div>


<div class="viewcode-block" id="Classes"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.Classes">[docs]</a><span class="k">class</span> <span class="nc">Classes</span><span class="p">(</span><span class="n">MutableSet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Provides access to an element&#39;s class attribute as a set-like collection.</span>
<span class="sd">    Usage::</span>

<span class="sd">        &gt;&gt;&gt; el = fromstring(&#39;&lt;p class=&quot;hidden large&quot;&gt;Text&lt;/p&gt;&#39;)</span>
<span class="sd">        &gt;&gt;&gt; classes = el.classes  # or: classes = Classes(el.attrib)</span>
<span class="sd">        &gt;&gt;&gt; classes |= [&#39;block&#39;, &#39;paragraph&#39;]</span>
<span class="sd">        &gt;&gt;&gt; el.get(&#39;class&#39;)</span>
<span class="sd">        &#39;hidden large block paragraph&#39;</span>
<span class="sd">        &gt;&gt;&gt; classes.toggle(&#39;hidden&#39;)</span>
<span class="sd">        False</span>
<span class="sd">        &gt;&gt;&gt; el.get(&#39;class&#39;)</span>
<span class="sd">        &#39;large block paragraph&#39;</span>
<span class="sd">        &gt;&gt;&gt; classes -= (&#39;some&#39;, &#39;classes&#39;, &#39;block&#39;)</span>
<span class="sd">        &gt;&gt;&gt; el.get(&#39;class&#39;)</span>
<span class="sd">        &#39;large paragraph&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attributes</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span> <span class="o">=</span> <span class="n">attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_class_value</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">attributes</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Classes.add"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.Classes.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a class.</span>

<span class="sd">        This has no effect if the class is already present.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span> <span class="ow">or</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\s&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid class name: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">classes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_class_value</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">classes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">classes</span><span class="p">)</span></div>

<div class="viewcode-block" id="Classes.discard"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.Classes.discard">[docs]</a>    <span class="k">def</span> <span class="nf">discard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove a class if it is currently present.</span>

<span class="sd">        If the class is not present, do nothing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span> <span class="ow">or</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\s&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid class name: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_class_value</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                   <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="n">value</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">classes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">classes</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;class&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="Classes.remove"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.Classes.remove">[docs]</a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove a class; it must currently be present.</span>

<span class="sd">        If the class is not present, raise a KeyError.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span> <span class="ow">or</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\s&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid class name: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Classes</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">classes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_class_value</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">classes</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">classes</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_class_value</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_class_value</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

    <span class="c1"># non-standard methods</span>

<div class="viewcode-block" id="Classes.update"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.Classes.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add all names from &#39;values&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">classes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_class_value</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">extended</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
                <span class="n">classes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="n">extended</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">extended</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">classes</span><span class="p">)</span></div>

<div class="viewcode-block" id="Classes.toggle"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.Classes.toggle">[docs]</a>    <span class="k">def</span> <span class="nf">toggle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a class name if it isn&#39;t there yet, or remove it if it exists.</span>

<span class="sd">        Returns true if the class was added (and is now enabled) and</span>
<span class="sd">        false if it was removed (and is now disabled).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span> <span class="ow">or</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\s&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid class name: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">classes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_class_value</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">classes</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">enabled</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">classes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">classes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">classes</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">enabled</span></div></div>


<div class="viewcode-block" id="HtmlMixin"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.HtmlMixin">[docs]</a><span class="k">class</span> <span class="nc">HtmlMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

<div class="viewcode-block" id="HtmlMixin.set"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.HtmlMixin.set">[docs]</a>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;set(self, key, value=None)</span>

<span class="sd">        Sets an element attribute.  If no value is provided, or if the value is None,</span>
<span class="sd">        creates a &#39;boolean&#39; attribute without value, e.g. &quot;&lt;form novalidate&gt;&lt;/form&gt;&quot;</span>
<span class="sd">        for ``form.set(&#39;novalidate&#39;)``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">HtmlMixin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">classes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A set-like wrapper around the &#39;class&#39; attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Classes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>

    <span class="nd">@classes</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">classes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classes</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">classes</span><span class="p">,</span> <span class="n">Classes</span><span class="p">)</span>  <span class="c1"># only allow &quot;el.classes |= ...&quot; etc.</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">classes</span><span class="o">.</span><span class="n">_get_class_value</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">base_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the base URL, given when the page was parsed.</span>

<span class="sd">        Use with ``urlparse.urljoin(el.base_url, href)`` to get</span>
<span class="sd">        absolute URLs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getroottree</span><span class="p">()</span><span class="o">.</span><span class="n">docinfo</span><span class="o">.</span><span class="n">URL</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">forms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of all the forms</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_forms_xpath</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">body</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the &lt;body&gt; element.  Can be called from a child element</span>
<span class="sd">        to get the document&#39;s head.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//body|//x:body&#39;</span><span class="p">,</span> <span class="n">namespaces</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="n">XHTML_NAMESPACE</span><span class="p">})[</span><span class="mi">0</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">head</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the &lt;head&gt; element.  Can be called from a child</span>
<span class="sd">        element to get the document&#39;s head.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//head|//x:head&#39;</span><span class="p">,</span> <span class="n">namespaces</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="n">XHTML_NAMESPACE</span><span class="p">})[</span><span class="mi">0</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get or set any &lt;label&gt; element associated with this element.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">id</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">_label_xpath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="nd">@label</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">id</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;You cannot set a label for an element (</span><span class="si">%r</span><span class="s2">) that has no id&quot;</span>
                <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_nons</span><span class="p">(</span><span class="n">label</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;You can only assign label to a label element (not </span><span class="si">%r</span><span class="s2">)&quot;</span>
                <span class="o">%</span> <span class="n">label</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;for&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>

    <span class="nd">@label</span><span class="o">.</span><span class="n">deleter</span>
    <span class="k">def</span> <span class="nf">label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">label</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;for&#39;</span><span class="p">]</span>

<div class="viewcode-block" id="HtmlMixin.drop_tree"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.HtmlMixin.drop_tree">[docs]</a>    <span class="k">def</span> <span class="nf">drop_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes this element from the tree, including its children and</span>
<span class="sd">        text.  The tail text is joined to the previous element or</span>
<span class="sd">        parent.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tail</span><span class="p">:</span>
            <span class="n">previous</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getprevious</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">previous</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">parent</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tail</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">previous</span><span class="o">.</span><span class="n">tail</span> <span class="o">=</span> <span class="p">(</span><span class="n">previous</span><span class="o">.</span><span class="n">tail</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tail</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="HtmlMixin.drop_tag"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.HtmlMixin.drop_tag">[docs]</a>    <span class="k">def</span> <span class="nf">drop_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove the tag, but not its children or text.  The children and text</span>
<span class="sd">        are merged into the parent.</span>

<span class="sd">        Example::</span>

<span class="sd">            &gt;&gt;&gt; h = fragment_fromstring(&#39;&lt;div&gt;Hello &lt;b&gt;World!&lt;/b&gt;&lt;/div&gt;&#39;)</span>
<span class="sd">            &gt;&gt;&gt; h.find(&#39;.//b&#39;).drop_tag()</span>
<span class="sd">            &gt;&gt;&gt; print(tostring(h, encoding=&#39;unicode&#39;))</span>
<span class="sd">            &lt;div&gt;Hello World!&lt;/div&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">previous</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getprevious</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="c1"># not a Comment, etc.</span>
            <span class="k">if</span> <span class="n">previous</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">parent</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">previous</span><span class="o">.</span><span class="n">tail</span> <span class="o">=</span> <span class="p">(</span><span class="n">previous</span><span class="o">.</span><span class="n">tail</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tail</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="n">last</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">last</span><span class="o">.</span><span class="n">tail</span> <span class="o">=</span> <span class="p">(</span><span class="n">last</span><span class="o">.</span><span class="n">tail</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tail</span>
            <span class="k">elif</span> <span class="n">previous</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">parent</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tail</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">previous</span><span class="o">.</span><span class="n">tail</span> <span class="o">=</span> <span class="p">(</span><span class="n">previous</span><span class="o">.</span><span class="n">tail</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tail</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">parent</span><span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[:]</span></div>

<div class="viewcode-block" id="HtmlMixin.find_rel_links"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.HtmlMixin.find_rel_links">[docs]</a>    <span class="k">def</span> <span class="nf">find_rel_links</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rel</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find any links like ``&lt;a rel=&quot;{rel}&quot;&gt;...&lt;/a&gt;``; returns a list of elements.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rel</span> <span class="o">=</span> <span class="n">rel</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">el</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">_rel_links_xpath</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rel&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">rel</span><span class="p">]</span></div>

<div class="viewcode-block" id="HtmlMixin.find_class"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.HtmlMixin.find_class">[docs]</a>    <span class="k">def</span> <span class="nf">find_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">class_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find any elements with the given class name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_class_xpath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">class_name</span><span class="o">=</span><span class="n">class_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="HtmlMixin.get_element_by_id"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.HtmlMixin.get_element_by_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_element_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="o">*</span><span class="n">default</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the first element in a document with the given id.  If none is</span>
<span class="sd">        found, return the default argument if provided or raise KeyError</span>
<span class="sd">        otherwise.</span>

<span class="sd">        Note that there can be more than one element with the same id,</span>
<span class="sd">        and this isn&#39;t uncommon in HTML documents found in the wild.</span>
<span class="sd">        Browsers return only the first match, and this function does</span>
<span class="sd">        the same.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># FIXME: should this check for multiple matches?</span>
            <span class="c1"># browsers just return the first one</span>
            <span class="k">return</span> <span class="n">_id_xpath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">default</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">default</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span></div>

<div class="viewcode-block" id="HtmlMixin.text_content"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.HtmlMixin.text_content">[docs]</a>    <span class="k">def</span> <span class="nf">text_content</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the text content of the tag (and the text in any children).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_collect_string_content</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="HtmlMixin.cssselect"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.HtmlMixin.cssselect">[docs]</a>    <span class="k">def</span> <span class="nf">cssselect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">translator</span><span class="o">=</span><span class="s1">&#39;html&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run the CSS expression on this element and its children,</span>
<span class="sd">        returning a list of the results.</span>

<span class="sd">        Equivalent to lxml.cssselect.CSSSelect(expr, translator=&#39;html&#39;)(self)</span>
<span class="sd">        -- note that pre-compiling the expression can provide a substantial</span>
<span class="sd">        speedup.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Do the import here to make the dependency optional.</span>
        <span class="kn">from</span> <span class="nn">lxml.cssselect</span> <span class="kn">import</span> <span class="n">CSSSelector</span>
        <span class="k">return</span> <span class="n">CSSSelector</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">translator</span><span class="o">=</span><span class="n">translator</span><span class="p">)(</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="c1">########################################</span>
    <span class="c1">## Link functions</span>
    <span class="c1">########################################</span>

<div class="viewcode-block" id="HtmlMixin.make_links_absolute"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.HtmlMixin.make_links_absolute">[docs]</a>    <span class="k">def</span> <span class="nf">make_links_absolute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resolve_base_href</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">handle_failures</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make all links in the document absolute, given the</span>
<span class="sd">        ``base_url`` for the document (the full URL where the document</span>
<span class="sd">        came from), or if no ``base_url`` is given, then the ``.base_url``</span>
<span class="sd">        of the document.</span>

<span class="sd">        If ``resolve_base_href`` is true, then any ``&lt;base href&gt;``</span>
<span class="sd">        tags in the document are used *and* removed from the document.</span>
<span class="sd">        If it is false then any such tag is ignored.</span>

<span class="sd">        If ``handle_failures`` is None (default), a failure to process</span>
<span class="sd">        a URL will abort the processing.  If set to &#39;ignore&#39;, errors</span>
<span class="sd">        are ignored.  If set to &#39;discard&#39;, failing URLs will be removed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">base_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">base_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span>
            <span class="k">if</span> <span class="n">base_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s2">&quot;No base_url given, and the document has no base_url&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resolve_base_href</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resolve_base_href</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">handle_failures</span> <span class="o">==</span> <span class="s1">&#39;ignore&#39;</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">link_repl</span><span class="p">(</span><span class="n">href</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">urljoin</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span> <span class="n">href</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">href</span>
        <span class="k">elif</span> <span class="n">handle_failures</span> <span class="o">==</span> <span class="s1">&#39;discard&#39;</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">link_repl</span><span class="p">(</span><span class="n">href</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">urljoin</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span> <span class="n">href</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">handle_failures</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">link_repl</span><span class="p">(</span><span class="n">href</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">urljoin</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span> <span class="n">href</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;unexpected value for handle_failures: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">handle_failures</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rewrite_links</span><span class="p">(</span><span class="n">link_repl</span><span class="p">)</span></div>

<div class="viewcode-block" id="HtmlMixin.resolve_base_href"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.HtmlMixin.resolve_base_href">[docs]</a>    <span class="k">def</span> <span class="nf">resolve_base_href</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handle_failures</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find any ``&lt;base href&gt;`` tag in the document, and apply its</span>
<span class="sd">        values to all links found in the document.  Also remove the</span>
<span class="sd">        tag once it has been applied.</span>

<span class="sd">        If ``handle_failures`` is None (default), a failure to process</span>
<span class="sd">        a URL will abort the processing.  If set to &#39;ignore&#39;, errors</span>
<span class="sd">        are ignored.  If set to &#39;discard&#39;, failing URLs will be removed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">base_href</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">basetags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//base[@href]|//x:base[@href]&#39;</span><span class="p">,</span>
                              <span class="n">namespaces</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">XHTML_NAMESPACE</span><span class="p">})</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">basetags</span><span class="p">:</span>
            <span class="n">base_href</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
            <span class="n">b</span><span class="o">.</span><span class="n">drop_tree</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">base_href</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_links_absolute</span><span class="p">(</span><span class="n">base_href</span><span class="p">,</span> <span class="n">resolve_base_href</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                 <span class="n">handle_failures</span><span class="o">=</span><span class="n">handle_failures</span><span class="p">)</span></div>

<div class="viewcode-block" id="HtmlMixin.iterlinks"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.HtmlMixin.iterlinks">[docs]</a>    <span class="k">def</span> <span class="nf">iterlinks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Yield (element, attribute, link, pos), where attribute may be None</span>
<span class="sd">        (indicating the link is in the text).  ``pos`` is the position</span>
<span class="sd">        where the link occurs; often 0, but sometimes something else in</span>
<span class="sd">        the case of links in stylesheets or style tags.</span>

<span class="sd">        Note: &lt;base href&gt; is *not* taken into account in any way.  The</span>
<span class="sd">        link you get is exactly the link in the document.</span>

<span class="sd">        Note: multiple links inside of a single text string or</span>
<span class="sd">        attribute value are returned in reversed order.  This makes it</span>
<span class="sd">        possible to replace or delete them from the text string value</span>
<span class="sd">        based on their reported text positions.  Otherwise, a</span>
<span class="sd">        modification at one text position can change the positions of</span>
<span class="sd">        links reported later on.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">link_attrs</span> <span class="o">=</span> <span class="n">defs</span><span class="o">.</span><span class="n">link_attrs</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">):</span>
            <span class="n">attribs</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">attrib</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="n">_nons</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span><span class="p">:</span>
                <span class="n">codebase</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="c1">## &lt;object&gt; tags have attributes that are relative to</span>
                <span class="c1">## codebase</span>
                <span class="k">if</span> <span class="s1">&#39;codebase&#39;</span> <span class="ow">in</span> <span class="n">attribs</span><span class="p">:</span>
                    <span class="n">codebase</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;codebase&#39;</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="s1">&#39;codebase&#39;</span><span class="p">,</span> <span class="n">codebase</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">attrib</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;classid&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">attrib</span> <span class="ow">in</span> <span class="n">attribs</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attrib</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">codebase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="n">codebase</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                        <span class="k">yield</span> <span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="n">attrib</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;archive&#39;</span> <span class="ow">in</span> <span class="n">attribs</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">_archive_re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;archive&#39;</span><span class="p">)):</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">codebase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="n">codebase</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                        <span class="k">yield</span> <span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="s1">&#39;archive&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">match</span><span class="o">.</span><span class="n">start</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">attrib</span> <span class="ow">in</span> <span class="n">link_attrs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">attrib</span> <span class="ow">in</span> <span class="n">attribs</span><span class="p">:</span>
                        <span class="k">yield</span> <span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="n">attrib</span><span class="p">,</span> <span class="n">attribs</span><span class="p">[</span><span class="n">attrib</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;meta&#39;</span><span class="p">:</span>
                <span class="n">http_equiv</span> <span class="o">=</span> <span class="n">attribs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http-equiv&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">http_equiv</span> <span class="o">==</span> <span class="s1">&#39;refresh&#39;</span><span class="p">:</span>
                    <span class="n">content</span> <span class="o">=</span> <span class="n">attribs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="n">match</span> <span class="o">=</span> <span class="n">_parse_meta_refresh_url</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
                    <span class="n">url</span> <span class="o">=</span> <span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">match</span> <span class="k">else</span> <span class="n">content</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="c1"># unexpected content means the redirect won&#39;t work, but we might</span>
                    <span class="c1"># as well be permissive and return the entire string.</span>
                    <span class="k">if</span> <span class="n">url</span><span class="p">:</span>
                        <span class="n">url</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">_unquote_match</span><span class="p">(</span>
                            <span class="n">url</span><span class="p">,</span> <span class="n">match</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">match</span> <span class="k">else</span> <span class="n">content</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
                        <span class="k">yield</span> <span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;param&#39;</span><span class="p">:</span>
                <span class="n">valuetype</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;valuetype&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
                <span class="k">if</span> <span class="n">valuetype</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;ref&#39;</span><span class="p">:</span>
                    <span class="c1">## FIXME: while it&#39;s fine we *find* this link,</span>
                    <span class="c1">## according to the spec we aren&#39;t supposed to</span>
                    <span class="c1">## actually change the value, including resolving</span>
                    <span class="c1">## it.  It can also still be a link, even if it</span>
                    <span class="c1">## doesn&#39;t have a valuetype=&quot;ref&quot; (which seems to be the norm)</span>
                    <span class="c1">## http://www.w3.org/TR/html401/struct/objects.html#adef-valuetype</span>
                    <span class="k">yield</span> <span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">el</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;style&#39;</span> <span class="ow">and</span> <span class="n">el</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="c1"># (start_pos, url)</span>
                    <span class="n">_unquote_match</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">match</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">1</span><span class="p">))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">_iter_css_urls</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                    <span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
                    <span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">_iter_css_imports</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                    <span class="p">]</span>
                <span class="k">if</span> <span class="n">urls</span><span class="p">:</span>
                    <span class="c1"># sort by start pos to bring both match sets back into order</span>
                    <span class="c1"># and reverse the list to report correct positions despite</span>
                    <span class="c1"># modifications</span>
                    <span class="n">urls</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
                        <span class="k">yield</span> <span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;style&#39;</span> <span class="ow">in</span> <span class="n">attribs</span><span class="p">:</span>
                <span class="n">urls</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_iter_css_urls</span><span class="p">(</span><span class="n">attribs</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">urls</span><span class="p">:</span>
                    <span class="c1"># return in reversed order to simplify in-place modifications</span>
                    <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">url</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="n">_unquote_match</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">match</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                        <span class="k">yield</span> <span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="s1">&#39;style&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span></div>

<div class="viewcode-block" id="HtmlMixin.rewrite_links"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.HtmlMixin.rewrite_links">[docs]</a>    <span class="k">def</span> <span class="nf">rewrite_links</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">link_repl_func</span><span class="p">,</span> <span class="n">resolve_base_href</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">base_href</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rewrite all the links in the document.  For each link</span>
<span class="sd">        ``link_repl_func(link)`` will be called, and the return value</span>
<span class="sd">        will replace the old link.</span>

<span class="sd">        Note that links may not be absolute (unless you first called</span>
<span class="sd">        ``make_links_absolute()``), and may be internal (e.g.,</span>
<span class="sd">        ``&#39;#anchor&#39;``).  They can also be values like</span>
<span class="sd">        ``&#39;mailto:email&#39;`` or ``&#39;javascript:expr&#39;``.</span>

<span class="sd">        If you give ``base_href`` then all links passed to</span>
<span class="sd">        ``link_repl_func()`` will take that into account.</span>

<span class="sd">        If the ``link_repl_func`` returns None, the attribute or</span>
<span class="sd">        tag text will be removed completely.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">base_href</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># FIXME: this can be done in one pass with a wrapper</span>
            <span class="c1"># around link_repl_func</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">make_links_absolute</span><span class="p">(</span>
                <span class="n">base_href</span><span class="p">,</span> <span class="n">resolve_base_href</span><span class="o">=</span><span class="n">resolve_base_href</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">resolve_base_href</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resolve_base_href</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">el</span><span class="p">,</span> <span class="n">attrib</span><span class="p">,</span> <span class="n">link</span><span class="p">,</span> <span class="n">pos</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterlinks</span><span class="p">():</span>
            <span class="n">new_link</span> <span class="o">=</span> <span class="n">link_repl_func</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">new_link</span> <span class="o">==</span> <span class="n">link</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">new_link</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Remove the attribute or element content</span>
                <span class="k">if</span> <span class="n">attrib</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">el</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">del</span> <span class="n">el</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="n">attrib</span><span class="p">]</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">attrib</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">new</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">text</span><span class="p">[:</span><span class="n">pos</span><span class="p">]</span> <span class="o">+</span> <span class="n">new_link</span> <span class="o">+</span> <span class="n">el</span><span class="o">.</span><span class="n">text</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">link</span><span class="p">):]</span>
                <span class="n">el</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">new</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cur</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attrib</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">pos</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">link</span><span class="p">):</span>
                    <span class="n">new</span> <span class="o">=</span> <span class="n">new_link</span>  <span class="c1"># most common case</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new</span> <span class="o">=</span> <span class="n">cur</span><span class="p">[:</span><span class="n">pos</span><span class="p">]</span> <span class="o">+</span> <span class="n">new_link</span> <span class="o">+</span> <span class="n">cur</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">link</span><span class="p">):]</span>
                <span class="n">el</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">attrib</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="_MethodFunc"><a class="viewcode-back" href="../../lxml.html.html#lxml.html._MethodFunc">[docs]</a><span class="k">class</span> <span class="nc">_MethodFunc</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An object that represents a method on an element as a function;</span>
<span class="sd">    the function takes either an element or an HTML string.  It</span>
<span class="sd">    returns whatever the function normally returns, or if the function</span>
<span class="sd">    works in-place (and so returns None) it returns a serialized form</span>
<span class="sd">    of the resulting document.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">source_class</span><span class="o">=</span><span class="n">HtmlMixin</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copy</span> <span class="o">=</span> <span class="n">copy</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">source_class</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="vm">__doc__</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">result_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;copy&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s2">&quot;The keyword &#39;copy&#39; can only be used with element inputs to </span><span class="si">%s</span><span class="s2">, not a string input&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">doc</span> <span class="o">=</span> <span class="n">fromstring</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;copy&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
                <span class="n">make_a_copy</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;copy&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">make_a_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span>
            <span class="k">if</span> <span class="n">make_a_copy</span><span class="p">:</span>
                <span class="n">doc</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
        <span class="n">meth</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">meth</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="c1"># FIXME: this None test is a bit sloppy</span>
        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Then return what we got in</span>
            <span class="k">return</span> <span class="n">_transform_result</span><span class="p">(</span><span class="n">result_type</span><span class="p">,</span> <span class="n">doc</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span></div>


<span class="n">find_rel_links</span> <span class="o">=</span> <span class="n">_MethodFunc</span><span class="p">(</span><span class="s1">&#39;find_rel_links&#39;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">find_class</span> <span class="o">=</span> <span class="n">_MethodFunc</span><span class="p">(</span><span class="s1">&#39;find_class&#39;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">make_links_absolute</span> <span class="o">=</span> <span class="n">_MethodFunc</span><span class="p">(</span><span class="s1">&#39;make_links_absolute&#39;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">resolve_base_href</span> <span class="o">=</span> <span class="n">_MethodFunc</span><span class="p">(</span><span class="s1">&#39;resolve_base_href&#39;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">iterlinks</span> <span class="o">=</span> <span class="n">_MethodFunc</span><span class="p">(</span><span class="s1">&#39;iterlinks&#39;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">rewrite_links</span> <span class="o">=</span> <span class="n">_MethodFunc</span><span class="p">(</span><span class="s1">&#39;rewrite_links&#39;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<div class="viewcode-block" id="HtmlComment"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.HtmlComment">[docs]</a><span class="k">class</span> <span class="nc">HtmlComment</span><span class="p">(</span><span class="n">HtmlMixin</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">CommentBase</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="HtmlElement"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.HtmlElement">[docs]</a><span class="k">class</span> <span class="nc">HtmlElement</span><span class="p">(</span><span class="n">HtmlMixin</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">ElementBase</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="HtmlProcessingInstruction"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.HtmlProcessingInstruction">[docs]</a><span class="k">class</span> <span class="nc">HtmlProcessingInstruction</span><span class="p">(</span><span class="n">HtmlMixin</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">PIBase</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="HtmlEntity"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.HtmlEntity">[docs]</a><span class="k">class</span> <span class="nc">HtmlEntity</span><span class="p">(</span><span class="n">HtmlMixin</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">EntityBase</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="HtmlElementClassLookup"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.HtmlElementClassLookup">[docs]</a><span class="k">class</span> <span class="nc">HtmlElementClassLookup</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">CustomElementClassLookup</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A lookup scheme for HTML Element classes.</span>

<span class="sd">    To create a lookup instance with different Element classes, pass a tag</span>
<span class="sd">    name mapping of Element classes in the ``classes`` keyword argument and/or</span>
<span class="sd">    a tag name mapping of Mixin classes in the ``mixins`` keyword argument.</span>
<span class="sd">    The special key &#39;*&#39; denotes a Mixin class that should be mixed into all</span>
<span class="sd">    Element classes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_default_element_classes</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mixins</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">CustomElementClassLookup</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">classes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">classes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_element_classes</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">mixins</span><span class="p">:</span>
            <span class="n">mixers</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">mixins</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">classes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">mixers</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mixers</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">mix_bases</span> <span class="ow">in</span> <span class="n">mixers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">cur</span> <span class="o">=</span> <span class="n">classes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">HtmlElement</span><span class="p">)</span>
                <span class="n">bases</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">mix_bases</span> <span class="o">+</span> <span class="p">[</span><span class="n">cur</span><span class="p">])</span>
                <span class="n">classes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_element_classes</span> <span class="o">=</span> <span class="n">classes</span>

<div class="viewcode-block" id="HtmlElementClassLookup.lookup"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.HtmlElementClassLookup.lookup">[docs]</a>    <span class="k">def</span> <span class="nf">lookup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_type</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">node_type</span> <span class="o">==</span> <span class="s1">&#39;element&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_element_classes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">HtmlElement</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">node_type</span> <span class="o">==</span> <span class="s1">&#39;comment&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HtmlComment</span>
        <span class="k">elif</span> <span class="n">node_type</span> <span class="o">==</span> <span class="s1">&#39;PI&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HtmlProcessingInstruction</span>
        <span class="k">elif</span> <span class="n">node_type</span> <span class="o">==</span> <span class="s1">&#39;entity&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HtmlEntity</span>
        <span class="c1"># Otherwise normal lookup</span>
        <span class="k">return</span> <span class="kc">None</span></div></div>


<span class="c1">################################################################################</span>
<span class="c1"># parsing</span>
<span class="c1">################################################################################</span>

<span class="n">_looks_like_full_html_unicode</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="n">unicode</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^\s*&lt;(?:html|!doctype)&#39;</span><span class="p">),</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span><span class="o">.</span><span class="n">match</span>
<span class="n">_looks_like_full_html_bytes</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="sa">r</span><span class="s1">&#39;^\s*&lt;(?:html|!doctype)&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">),</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span><span class="o">.</span><span class="n">match</span>


<div class="viewcode-block" id="document_fromstring"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.document_fromstring">[docs]</a><span class="k">def</span> <span class="nf">document_fromstring</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ensure_head_body</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">parser</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">html_parser</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">etree</span><span class="o">.</span><span class="n">ParserError</span><span class="p">(</span>
            <span class="s2">&quot;Document is empty&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ensure_head_body</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;head&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">value</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Element</span><span class="p">(</span><span class="s1">&#39;head&#39;</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ensure_head_body</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">value</span></div>


<div class="viewcode-block" id="fragments_fromstring"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.fragments_fromstring">[docs]</a><span class="k">def</span> <span class="nf">fragments_fromstring</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="n">no_leading_text</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">base_url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">parser</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parses several HTML elements, returning a list of elements.</span>

<span class="sd">    The first item in the list may be a string.</span>
<span class="sd">    If no_leading_text is true, then it will be an error if there is</span>
<span class="sd">    leading text, and it will always be a list of only elements.</span>

<span class="sd">    base_url will set the document&#39;s base_url attribute</span>
<span class="sd">    (and the tree&#39;s docinfo.URL).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">parser</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">html_parser</span>
    <span class="c1"># FIXME: check what happens when you give html with a body, head, etc.</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_looks_like_full_html_bytes</span><span class="p">(</span><span class="n">html</span><span class="p">):</span>
            <span class="c1"># can&#39;t use %-formatting in early Py3 versions</span>
            <span class="n">html</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;&lt;html&gt;&lt;body&gt;&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">html</span> <span class="o">+</span>
                    <span class="s1">&#39;&lt;/body&gt;&lt;/html&gt;&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_looks_like_full_html_unicode</span><span class="p">(</span><span class="n">html</span><span class="p">):</span>
            <span class="n">html</span> <span class="o">=</span> <span class="s1">&#39;&lt;html&gt;&lt;body&gt;</span><span class="si">%s</span><span class="s1">&lt;/body&gt;&lt;/html&gt;&#39;</span> <span class="o">%</span> <span class="n">html</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">document_fromstring</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="n">parser</span><span class="p">,</span> <span class="n">base_url</span><span class="o">=</span><span class="n">base_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">_nons</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;html&#39;</span>
    <span class="n">bodies</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">doc</span> <span class="k">if</span> <span class="n">_nons</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;body&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">bodies</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;too many bodies: </span><span class="si">%r</span><span class="s2"> in </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">bodies</span><span class="p">,</span> <span class="n">html</span><span class="p">))</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">bodies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">no_leading_text</span> <span class="ow">and</span> <span class="n">body</span><span class="o">.</span><span class="n">text</span> <span class="ow">and</span> <span class="n">body</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">etree</span><span class="o">.</span><span class="n">ParserError</span><span class="p">(</span>
            <span class="s2">&quot;There is leading text: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">body</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">body</span><span class="o">.</span><span class="n">text</span> <span class="ow">and</span> <span class="n">body</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
    <span class="c1"># FIXME: removing the reference to the parent artificial document</span>
    <span class="c1"># would be nice</span>
    <span class="k">return</span> <span class="n">elements</span></div>


<div class="viewcode-block" id="fragment_fromstring"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.fragment_fromstring">[docs]</a><span class="k">def</span> <span class="nf">fragment_fromstring</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="n">create_parent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">base_url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">parser</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parses a single HTML element; it is an error if there is more than</span>
<span class="sd">    one element, or if anything but whitespace precedes or follows the</span>
<span class="sd">    element.</span>

<span class="sd">    If ``create_parent`` is true (or is a tag name) then a parent node</span>
<span class="sd">    will be created to encapsulate the HTML in a single element.  In this</span>
<span class="sd">    case, leading or trailing text is also allowed, as are multiple elements</span>
<span class="sd">    as result of the parsing.</span>

<span class="sd">    Passing a ``base_url`` will set the document&#39;s ``base_url`` attribute</span>
<span class="sd">    (and the tree&#39;s docinfo.URL).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">parser</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">html_parser</span>

    <span class="n">accept_leading_text</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">create_parent</span><span class="p">)</span>

    <span class="n">elements</span> <span class="o">=</span> <span class="n">fragments_fromstring</span><span class="p">(</span>
        <span class="n">html</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="n">parser</span><span class="p">,</span> <span class="n">no_leading_text</span><span class="o">=</span><span class="ow">not</span> <span class="n">accept_leading_text</span><span class="p">,</span>
        <span class="n">base_url</span><span class="o">=</span><span class="n">base_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">create_parent</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">create_parent</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="n">create_parent</span> <span class="o">=</span> <span class="s1">&#39;div&#39;</span>
        <span class="n">new_root</span> <span class="o">=</span> <span class="n">Element</span><span class="p">(</span><span class="n">create_parent</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">elements</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">basestring</span><span class="p">):</span>
                <span class="n">new_root</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">new_root</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_root</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">elements</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">etree</span><span class="o">.</span><span class="n">ParserError</span><span class="p">(</span><span class="s1">&#39;No elements found&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">etree</span><span class="o">.</span><span class="n">ParserError</span><span class="p">(</span>
            <span class="s2">&quot;Multiple elements found (</span><span class="si">%s</span><span class="s2">)&quot;</span>
            <span class="o">%</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">_element_name</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">]))</span>
    <span class="n">el</span> <span class="o">=</span> <span class="n">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">tail</span> <span class="ow">and</span> <span class="n">el</span><span class="o">.</span><span class="n">tail</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">etree</span><span class="o">.</span><span class="n">ParserError</span><span class="p">(</span>
            <span class="s2">&quot;Element followed by text: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">el</span><span class="o">.</span><span class="n">tail</span><span class="p">)</span>
    <span class="n">el</span><span class="o">.</span><span class="n">tail</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">el</span></div>


<div class="viewcode-block" id="fromstring"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.fromstring">[docs]</a><span class="k">def</span> <span class="nf">fromstring</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="n">base_url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse the html, returning a single element/document.</span>

<span class="sd">    This tries to minimally parse the chunk of text, without knowing if it</span>
<span class="sd">    is a fragment or a document.</span>

<span class="sd">    base_url will set the document&#39;s base_url attribute (and the tree&#39;s docinfo.URL)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">parser</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">html_parser</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
        <span class="n">is_full_html</span> <span class="o">=</span> <span class="n">_looks_like_full_html_bytes</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">is_full_html</span> <span class="o">=</span> <span class="n">_looks_like_full_html_unicode</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">document_fromstring</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="n">parser</span><span class="p">,</span> <span class="n">base_url</span><span class="o">=</span><span class="n">base_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_full_html</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">doc</span>
    <span class="c1"># otherwise, lets parse it out...</span>
    <span class="n">bodies</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">bodies</span><span class="p">:</span>
        <span class="n">bodies</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;{</span><span class="si">%s</span><span class="s1">}body&#39;</span> <span class="o">%</span> <span class="n">XHTML_NAMESPACE</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">bodies</span><span class="p">:</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">bodies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bodies</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Somehow there are multiple bodies, which is bad, but just</span>
            <span class="c1"># smash them into one body</span>
            <span class="k">for</span> <span class="n">other_body</span> <span class="ow">in</span> <span class="n">bodies</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="k">if</span> <span class="n">other_body</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="p">):</span>
                        <span class="n">body</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tail</span> <span class="o">=</span> <span class="p">(</span><span class="n">body</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tail</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">other_body</span><span class="o">.</span><span class="n">text</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">body</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">other_body</span><span class="o">.</span><span class="n">text</span>
                <span class="n">body</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">other_body</span><span class="p">)</span>
                <span class="c1"># We&#39;ll ignore tail</span>
                <span class="c1"># I guess we are ignoring attributes too</span>
                <span class="n">other_body</span><span class="o">.</span><span class="n">drop_tree</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">body</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">heads</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;head&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">heads</span><span class="p">:</span>
        <span class="n">heads</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;{</span><span class="si">%s</span><span class="s1">}head&#39;</span> <span class="o">%</span> <span class="n">XHTML_NAMESPACE</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">heads</span><span class="p">:</span>
        <span class="c1"># Well, we have some sort of structure, so lets keep it all</span>
        <span class="n">head</span> <span class="o">=</span> <span class="n">heads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">heads</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">other_head</span> <span class="ow">in</span> <span class="n">heads</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">head</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">other_head</span><span class="p">)</span>
                <span class="c1"># We don&#39;t care about text or tail in a head</span>
                <span class="n">other_head</span><span class="o">.</span><span class="n">drop_tree</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">doc</span>
    <span class="k">if</span> <span class="n">body</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">doc</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">body</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">body</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">body</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tail</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">body</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tail</span><span class="o">.</span><span class="n">strip</span><span class="p">())):</span>
        <span class="c1"># The body has just one element, so it was probably a single</span>
        <span class="c1"># element passed in</span>
        <span class="k">return</span> <span class="n">body</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># Now we have a body which represents a bunch of tags which have the</span>
    <span class="c1"># content that was passed in.  We will create a fake container, which</span>
    <span class="c1"># is the body tag, except &lt;body&gt; implies too much structure.</span>
    <span class="k">if</span> <span class="n">_contains_block_level_tag</span><span class="p">(</span><span class="n">body</span><span class="p">):</span>
        <span class="n">body</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="s1">&#39;div&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">body</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="s1">&#39;span&#39;</span>
    <span class="k">return</span> <span class="n">body</span></div>


<div class="viewcode-block" id="parse"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.parse">[docs]</a><span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">filename_or_url</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">base_url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse a filename, URL, or file-like object into an HTML document</span>
<span class="sd">    tree.  Note: this returns a tree, not an element.  Use</span>
<span class="sd">    ``parse(...).getroot()`` to get the document root.</span>

<span class="sd">    You can override the base URL with the ``base_url`` keyword.  This</span>
<span class="sd">    is most useful when parsing from a file-like object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">parser</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">html_parser</span>
    <span class="k">return</span> <span class="n">etree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">filename_or_url</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">base_url</span><span class="o">=</span><span class="n">base_url</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>


<div class="viewcode-block" id="_contains_block_level_tag"><a class="viewcode-back" href="../../lxml.html.html#lxml.html._contains_block_level_tag">[docs]</a><span class="k">def</span> <span class="nf">_contains_block_level_tag</span><span class="p">(</span><span class="n">el</span><span class="p">):</span>
    <span class="c1"># FIXME: I could do this with XPath, but would that just be</span>
    <span class="c1"># unnecessarily slow?</span>
    <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">el</span><span class="o">.</span><span class="n">iter</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">_nons</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span> <span class="ow">in</span> <span class="n">defs</span><span class="o">.</span><span class="n">block_tags</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="_element_name"><a class="viewcode-back" href="../../lxml.html.html#lxml.html._element_name">[docs]</a><span class="k">def</span> <span class="nf">_element_name</span><span class="p">(</span><span class="n">el</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">CommentBase</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;comment&#39;</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;string&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_nons</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span></div>


<span class="c1">################################################################################</span>
<span class="c1"># form handling</span>
<span class="c1">################################################################################</span>

<div class="viewcode-block" id="FormElement"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.FormElement">[docs]</a><span class="k">class</span> <span class="nc">FormElement</span><span class="p">(</span><span class="n">HtmlElement</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a &lt;form&gt; element.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an accessor for all the input elements in the form.</span>

<span class="sd">        See `InputGetter` for more information about the object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">InputGetter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dictionary-like object that represents all the fields in this</span>
<span class="sd">        form.  You can set values in this dictionary to effect the</span>
<span class="sd">        form.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">FieldsDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">)</span>

    <span class="nd">@fields</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span>
        <span class="n">prev_keys</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">prev_keys</span><span class="p">:</span>
                <span class="n">prev_keys</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">fields</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">prev_keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Case of an unnamed input; these aren&#39;t really</span>
                <span class="c1"># expressed in form_values() anyway.</span>
                <span class="k">continue</span>
            <span class="n">fields</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="FormElement._name"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.FormElement._name">[docs]</a>    <span class="k">def</span> <span class="nf">_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
        <span class="n">iter_tags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">iter</span>
        <span class="n">forms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">iter_tags</span><span class="p">(</span><span class="s1">&#39;form&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">forms</span><span class="p">:</span>
            <span class="n">forms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">iter_tags</span><span class="p">(</span><span class="s1">&#39;{</span><span class="si">%s</span><span class="s1">}form&#39;</span> <span class="o">%</span> <span class="n">XHTML_NAMESPACE</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span></div>

<div class="viewcode-block" id="FormElement.form_values"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.FormElement.form_values">[docs]</a>    <span class="k">def</span> <span class="nf">form_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of tuples of the field values for the form.</span>
<span class="sd">        This is suitable to be passed to ``urllib.urlencode()``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">name</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">or</span> <span class="s1">&#39;disabled&#39;</span> <span class="ow">in</span> <span class="n">el</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="n">_nons</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;textarea&#39;</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">el</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;select&#39;</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">value</span>
                <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">multiple</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">el</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="p">(</span>
                    <span class="s2">&quot;Unexpected tag: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">el</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">checkable</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">el</span><span class="o">.</span><span class="n">checked</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;submit&#39;</span><span class="p">,</span> <span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="s1">&#39;reset&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">value</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">el</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">results</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get/set the form&#39;s ``action`` attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">base_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span>
        <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;action&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">base_url</span> <span class="ow">and</span> <span class="n">action</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">urljoin</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">action</span>

    <span class="nd">@action</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;action&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="nd">@action</span><span class="o">.</span><span class="n">deleter</span>
    <span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">attrib</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrib</span>
        <span class="k">if</span> <span class="s1">&#39;action&#39;</span> <span class="ow">in</span> <span class="n">attrib</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get/set the form&#39;s method.  Always returns a capitalized</span>
<span class="sd">        string, and defaults to ``&#39;GET&#39;``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

    <span class="nd">@method</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span></div>


<span class="n">HtmlElementClassLookup</span><span class="o">.</span><span class="n">_default_element_classes</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FormElement</span>


<div class="viewcode-block" id="submit_form"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.submit_form">[docs]</a><span class="k">def</span> <span class="nf">submit_form</span><span class="p">(</span><span class="n">form</span><span class="p">,</span> <span class="n">extra_values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">open_http</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function to submit a form.  Returns a file-like object, as from</span>
<span class="sd">    ``urllib.urlopen()``.  This object also has a ``.geturl()`` function,</span>
<span class="sd">    which shows the URL if there were any redirects.</span>

<span class="sd">    You can use this like::</span>

<span class="sd">        form = doc.forms[0]</span>
<span class="sd">        form.inputs[&#39;foo&#39;].value = &#39;bar&#39; # etc</span>
<span class="sd">        response = form.submit()</span>
<span class="sd">        doc = parse(response)</span>
<span class="sd">        doc.make_links_absolute(response.geturl())</span>

<span class="sd">    To change the HTTP requester, pass a function as ``open_http`` keyword</span>
<span class="sd">    argument that opens the URL for you.  The function must have the following</span>
<span class="sd">    signature::</span>

<span class="sd">        open_http(method, URL, values)</span>

<span class="sd">    The action is one of &#39;GET&#39; or &#39;POST&#39;, the URL is the target URL as a</span>
<span class="sd">    string, and the values are a sequence of ``(name, value)`` tuples with the</span>
<span class="sd">    form data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">form_values</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">extra_values</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">extra_values</span><span class="p">,</span> <span class="s1">&#39;items&#39;</span><span class="p">):</span>
            <span class="n">extra_values</span> <span class="o">=</span> <span class="n">extra_values</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="n">values</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">extra_values</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">open_http</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">open_http</span> <span class="o">=</span> <span class="n">open_http_urllib</span>
    <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">action</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">action</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">base_url</span>
    <span class="k">return</span> <span class="n">open_http</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">method</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></div>


<div class="viewcode-block" id="open_http_urllib"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.open_http_urllib">[docs]</a><span class="k">def</span> <span class="nf">open_http_urllib</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">url</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;cannot submit, no URL provided&quot;</span><span class="p">)</span>
    <span class="c1">## FIXME: should test that it&#39;s not a relative URL or something</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">urlencode</span><span class="p">,</span> <span class="n">urlopen</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span> <span class="c1"># Python 3</span>
        <span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">urlopen</span>
        <span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlencode</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;?&#39;</span> <span class="ow">in</span> <span class="n">url</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">+=</span> <span class="s1">&#39;&amp;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">+=</span> <span class="s1">&#39;?&#39;</span>
        <span class="n">url</span> <span class="o">+=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ASCII&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span></div>


<div class="viewcode-block" id="FieldsDict"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.FieldsDict">[docs]</a><span class="k">class</span> <span class="nc">FieldsDict</span><span class="p">(</span><span class="n">MutableMapping</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="n">inputs</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
            <span class="s2">&quot;You cannot remove keys from ElementDict&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="FieldsDict.keys"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.FieldsDict.keys">[docs]</a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span></div>
    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span>
    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1"> for form </span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">_name</span><span class="p">())</span></div>


<div class="viewcode-block" id="InputGetter"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.InputGetter">[docs]</a><span class="k">class</span> <span class="nc">InputGetter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An accessor that represents all the input fields in a form.</span>

<span class="sd">    You can get fields by name from this, with</span>
<span class="sd">    ``form.inputs[&#39;field_name&#39;]``.  If there are a set of checkboxes</span>
<span class="sd">    with the same name, they are returned as a list (a `CheckboxGroup`</span>
<span class="sd">    which also allows value setting).  Radio inputs are handled</span>
<span class="sd">    similarly.  Use ``.keys()`` and ``.items()`` to process all fields</span>
<span class="sd">    in this way.</span>

<span class="sd">    You can also iterate over this to get all input elements.  This</span>
<span class="sd">    won&#39;t return the same thing as if you get all the names, as</span>
<span class="sd">    checkboxes and radio elements are returned individually.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">form</span> <span class="o">=</span> <span class="n">form</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1"> for form </span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">_name</span><span class="p">())</span>

    <span class="c1">## FIXME: there should be more methods, and it&#39;s unclear if this is</span>
    <span class="c1">## a dictionary-like object or list-like object</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">field</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fields</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;No input element with the name </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>

        <span class="n">input_type</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">input_type</span> <span class="o">==</span> <span class="s1">&#39;radio&#39;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">group</span> <span class="o">=</span> <span class="n">RadioGroup</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
            <span class="n">group</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
            <span class="k">return</span> <span class="n">group</span>
        <span class="k">elif</span> <span class="n">input_type</span> <span class="o">==</span> <span class="s1">&#39;checkbox&#39;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">group</span> <span class="o">=</span> <span class="n">CheckboxGroup</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
            <span class="n">group</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
            <span class="k">return</span> <span class="n">group</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># I don&#39;t like throwing away elements like this</span>
            <span class="k">return</span> <span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

<div class="viewcode-block" id="InputGetter.keys"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.InputGetter.keys">[docs]</a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns all unique field names, in document order.</span>

<span class="sd">        :return: A list of all unique field names.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">seen</span> <span class="o">=</span> <span class="p">{</span><span class="kc">None</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">name</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
                <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">names</span></div>

<div class="viewcode-block" id="InputGetter.items"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.InputGetter.items">[docs]</a>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns all fields with their names, similar to dict.items().</span>

<span class="sd">        :return: A list of (name, field) tuples.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">name</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
                <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">items</span></div>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">iter</span><span class="p">(</span><span class="s1">&#39;select&#39;</span><span class="p">,</span> <span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="s1">&#39;textarea&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="InputMixin"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.InputMixin">[docs]</a><span class="k">class</span> <span class="nc">InputMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Mix-in for all input elements (input, select, and textarea)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get/set the name of the element</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>

    <span class="nd">@name</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="nd">@name</span><span class="o">.</span><span class="n">deleter</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">attrib</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrib</span>
        <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">attrib</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">type_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">type_name</span><span class="p">:</span>
            <span class="n">type_name</span> <span class="o">=</span> <span class="s1">&#39; type=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">type_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">type_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%x</span><span class="s1"> name=</span><span class="si">%r%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">type_name</span><span class="p">)</span></div>


<div class="viewcode-block" id="TextareaElement"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.TextareaElement">[docs]</a><span class="k">class</span> <span class="nc">TextareaElement</span><span class="p">(</span><span class="n">InputMixin</span><span class="p">,</span> <span class="n">HtmlElement</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ``&lt;textarea&gt;`` element.  You can get the name with ``.name`` and</span>
<span class="sd">    get/set the value with ``.value``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get/set the value (which is the contents of this element)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;{</span><span class="si">%s</span><span class="s2">}&quot;</span> <span class="o">%</span> <span class="n">XHTML_NAMESPACE</span><span class="p">):</span>
            <span class="n">serialisation_method</span> <span class="o">=</span> <span class="s1">&#39;xml&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">serialisation_method</span> <span class="o">=</span> <span class="s1">&#39;html&#39;</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="c1"># it&#39;s rare that we actually get here, so let&#39;s not use &#39;&#39;.join()</span>
            <span class="n">content</span> <span class="o">+=</span> <span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span>
                <span class="n">el</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">serialisation_method</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;unicode&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">content</span>

    <span class="nd">@value</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@value</span><span class="o">.</span><span class="n">deleter</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">del</span> <span class="bp">self</span><span class="p">[:]</span></div>


<span class="n">HtmlElementClassLookup</span><span class="o">.</span><span class="n">_default_element_classes</span><span class="p">[</span><span class="s1">&#39;textarea&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TextareaElement</span>


<div class="viewcode-block" id="SelectElement"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.SelectElement">[docs]</a><span class="k">class</span> <span class="nc">SelectElement</span><span class="p">(</span><span class="n">InputMixin</span><span class="p">,</span> <span class="n">HtmlElement</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ``&lt;select&gt;`` element.  You can get the name with ``.name``.</span>

<span class="sd">    ``.value`` will be the value of the selected option, unless this</span>
<span class="sd">    is a multi-select element (``&lt;select multiple&gt;``), in which case</span>
<span class="sd">    it will be a set-like object.  In either case ``.value_options``</span>
<span class="sd">    gives the possible values.</span>

<span class="sd">    The boolean attribute ``.multiple`` shows if this is a</span>
<span class="sd">    multi-select.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get/set the value of this select (the selected option).</span>

<span class="sd">        If this is a multi-select, this is a set-like object that</span>
<span class="sd">        represents all the selected options.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiple</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MultipleSelectOptions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">options</span> <span class="o">=</span> <span class="n">_options_xpath</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">selected_option</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">el</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">options</span><span class="p">)</span> <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;selected&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">selected_option</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">el</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">options</span> <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;disabled&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">selected_option</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="n">selected_option</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@value</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiple</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;You must pass in a sequence&quot;</span><span class="p">)</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
            <span class="n">values</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="n">values</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">checked_option</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">_options_xpath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="n">opt_value</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">opt_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">opt_value</span> <span class="o">=</span> <span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">opt_value</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
                    <span class="n">checked_option</span> <span class="o">=</span> <span class="n">el</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;There is no option with the value of </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">_options_xpath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;selected&#39;</span> <span class="ow">in</span> <span class="n">el</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">el</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;selected&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">checked_option</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">checked_option</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;selected&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="nd">@value</span><span class="o">.</span><span class="n">deleter</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># FIXME: should del be allowed at all?</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiple</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        All the possible values this select can have (the ``value``</span>
<span class="sd">        attribute of all the ``&lt;option&gt;`` elements.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">_options_xpath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">options</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">multiple</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Boolean attribute: is there a ``multiple`` attribute on this element.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;multiple&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrib</span>

    <span class="nd">@multiple</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">multiple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;multiple&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;multiple&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;multiple&#39;</span><span class="p">]</span></div>


<span class="n">HtmlElementClassLookup</span><span class="o">.</span><span class="n">_default_element_classes</span><span class="p">[</span><span class="s1">&#39;select&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SelectElement</span>


<div class="viewcode-block" id="MultipleSelectOptions"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.MultipleSelectOptions">[docs]</a><span class="k">class</span> <span class="nc">MultipleSelectOptions</span><span class="p">(</span><span class="n">SetMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents all the selected options in a ``&lt;select multiple&gt;`` element.</span>

<span class="sd">    You can add to this set-like option to select an option, or remove</span>
<span class="sd">    to unselect the option.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">select</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select</span> <span class="o">=</span> <span class="n">select</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterator of all the ``&lt;option&gt;`` elements.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="n">_options_xpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;selected&#39;</span> <span class="ow">in</span> <span class="n">option</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                <span class="n">opt_value</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">opt_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">opt_value</span> <span class="o">=</span> <span class="p">(</span><span class="n">option</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">yield</span> <span class="n">opt_value</span>

<div class="viewcode-block" id="MultipleSelectOptions.add"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.MultipleSelectOptions.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="n">opt_value</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">opt_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">opt_value</span> <span class="o">=</span> <span class="p">(</span><span class="n">option</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">opt_value</span> <span class="o">==</span> <span class="n">item</span><span class="p">:</span>
                <span class="n">option</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;selected&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;There is no option with the value </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">item</span><span class="p">)</span></div>

<div class="viewcode-block" id="MultipleSelectOptions.remove"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.MultipleSelectOptions.remove">[docs]</a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="n">opt_value</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">opt_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">opt_value</span> <span class="o">=</span> <span class="p">(</span><span class="n">option</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">opt_value</span> <span class="o">==</span> <span class="n">item</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;selected&#39;</span> <span class="ow">in</span> <span class="n">option</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                    <span class="k">del</span> <span class="n">option</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;selected&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;The option </span><span class="si">%r</span><span class="s2"> is not currently selected&quot;</span> <span class="o">%</span> <span class="n">item</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;There is not option with the value </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">item</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1"> {</span><span class="si">%s</span><span class="s1">} for select name=</span><span class="si">%r</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">repr</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">select</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>


<div class="viewcode-block" id="RadioGroup"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.RadioGroup">[docs]</a><span class="k">class</span> <span class="nc">RadioGroup</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This object represents several ``&lt;input type=radio&gt;`` elements</span>
<span class="sd">    that have the same name.</span>

<span class="sd">    You can use this like a list, but also use the property</span>
<span class="sd">    ``.value`` to check/uncheck inputs.  Also you can use</span>
<span class="sd">    ``.value_options`` to get the possible values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get/set the value, which checks the radio with that value (and</span>
<span class="sd">        unchecks any other value).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;checked&#39;</span> <span class="ow">in</span> <span class="n">el</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">el</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@value</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">checked_option</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
                    <span class="n">checked_option</span> <span class="o">=</span> <span class="n">el</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;There is no radio input with the value </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;checked&#39;</span> <span class="ow">in</span> <span class="n">el</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">el</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;checked&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">checked_option</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">checked_option</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;checked&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="nd">@value</span><span class="o">.</span><span class="n">deleter</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of all the possible values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="nb">list</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span></div>


<div class="viewcode-block" id="CheckboxGroup"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.CheckboxGroup">[docs]</a><span class="k">class</span> <span class="nc">CheckboxGroup</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a group of checkboxes (``&lt;input type=checkbox&gt;``) that</span>
<span class="sd">    have the same name.</span>

<span class="sd">    In addition to using this like a list, the ``.value`` attribute</span>
<span class="sd">    returns a set-like object that you can add to or remove from to</span>
<span class="sd">    check and uncheck checkboxes.  You can also use ``.value_options``</span>
<span class="sd">    to get the possible values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a set-like object that can be modified to check or</span>
<span class="sd">        uncheck individual checkboxes according to their value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">CheckboxValues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@value</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
        <span class="n">values</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;A CheckboxGroup (name=</span><span class="si">%r</span><span class="s2">) must be set to a sequence (not </span><span class="si">%r</span><span class="s2">)&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
        <span class="n">values</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@value</span><span class="o">.</span><span class="n">deleter</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of all the possible values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="nb">list</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span></div>


<div class="viewcode-block" id="CheckboxValues"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.CheckboxValues">[docs]</a><span class="k">class</span> <span class="nc">CheckboxValues</span><span class="p">(</span><span class="n">SetMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents the values of the checked checkboxes in a group of</span>
<span class="sd">    checkboxes with the same name.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group</span> <span class="o">=</span> <span class="n">group</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">([</span>
            <span class="n">el</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">group</span>
            <span class="k">if</span> <span class="s1">&#39;checked&#39;</span> <span class="ow">in</span> <span class="n">el</span><span class="o">.</span><span class="n">attrib</span><span class="p">])</span>

<div class="viewcode-block" id="CheckboxValues.add"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.CheckboxValues.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
                <span class="n">el</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;checked&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;No checkbox with value </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="CheckboxValues.remove"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.CheckboxValues.remove">[docs]</a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;checked&#39;</span> <span class="ow">in</span> <span class="n">el</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                    <span class="k">del</span> <span class="n">el</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;checked&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                        <span class="s2">&quot;The checkbox with value </span><span class="si">%r</span><span class="s2"> was already unchecked&quot;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                <span class="s2">&quot;No checkbox with value </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1"> {</span><span class="si">%s</span><span class="s1">} for checkboxes name=</span><span class="si">%r</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">repr</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>


<div class="viewcode-block" id="InputElement"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.InputElement">[docs]</a><span class="k">class</span> <span class="nc">InputElement</span><span class="p">(</span><span class="n">InputMixin</span><span class="p">,</span> <span class="n">HtmlElement</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents an ``&lt;input&gt;`` element.</span>

<span class="sd">    You can get the type with ``.type`` (which is lower-cased and</span>
<span class="sd">    defaults to ``&#39;text&#39;``).</span>

<span class="sd">    Also you can get and set the value with ``.value``</span>

<span class="sd">    Checkboxes and radios have the attribute ``input.checkable ==</span>
<span class="sd">    True`` (for all others it is false) and a boolean attribute</span>
<span class="sd">    ``.checked``.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">## FIXME: I&#39;m a little uncomfortable with the use of .checked</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get/set the value of this element, using the ``value`` attribute.</span>

<span class="sd">        Also, if this is a checkbox and it has no value, this defaults</span>
<span class="sd">        to ``&#39;on&#39;``.  If it is a checkbox or radio that is not</span>
<span class="sd">        checked, this returns None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkable</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">checked</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;on&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>

    <span class="nd">@value</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkable</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">checked</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">checked</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="nd">@value</span><span class="o">.</span><span class="n">deleter</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkable</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checked</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;value&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the type of this element (using the type attribute).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="nd">@type</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">checkable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Boolean: can this element be checked?</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;checkbox&#39;</span><span class="p">,</span> <span class="s1">&#39;radio&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">checked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Boolean attribute to get/set the presence of the ``checked``</span>
<span class="sd">        attribute.</span>

<span class="sd">        You can only use this on checkable input types.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkable</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Not a checkable input type&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;checked&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrib</span>

    <span class="nd">@checked</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">checked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkable</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Not a checkable input type&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;checked&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">attrib</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrib</span>
            <span class="k">if</span> <span class="s1">&#39;checked&#39;</span> <span class="ow">in</span> <span class="n">attrib</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;checked&#39;</span><span class="p">]</span></div>


<span class="n">HtmlElementClassLookup</span><span class="o">.</span><span class="n">_default_element_classes</span><span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">InputElement</span>


<div class="viewcode-block" id="LabelElement"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.LabelElement">[docs]</a><span class="k">class</span> <span class="nc">LabelElement</span><span class="p">(</span><span class="n">HtmlElement</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a ``&lt;label&gt;`` element.</span>

<span class="sd">    Label elements are linked to other elements with their ``for``</span>
<span class="sd">    attribute.  You can access this element with ``label.for_element``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">for_element</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get/set the element this label points to.  Return None if it</span>
<span class="sd">        can&#39;t be found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;for&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">id</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">get_element_by_id</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>

    <span class="nd">@for_element</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">for_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">id</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;Element </span><span class="si">%r</span><span class="s2"> has no id attribute&quot;</span> <span class="o">%</span> <span class="n">other</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;for&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>

    <span class="nd">@for_element</span><span class="o">.</span><span class="n">deleter</span>
    <span class="k">def</span> <span class="nf">for_element</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">attrib</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrib</span>
        <span class="k">if</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">attrib</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span></div>


<span class="n">HtmlElementClassLookup</span><span class="o">.</span><span class="n">_default_element_classes</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">LabelElement</span>


<span class="c1">############################################################</span>
<span class="c1">## Serialization</span>
<span class="c1">############################################################</span>

<div class="viewcode-block" id="html_to_xhtml"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.html_to_xhtml">[docs]</a><span class="k">def</span> <span class="nf">html_to_xhtml</span><span class="p">(</span><span class="n">html</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert all tags in an HTML tree to XHTML by moving them to the</span>
<span class="sd">    XHTML namespace.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;{</span><span class="si">%s</span><span class="s2">}&quot;</span> <span class="o">%</span> <span class="n">XHTML_NAMESPACE</span>
    <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">html</span><span class="o">.</span><span class="n">iter</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">):</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">tag</span>
        <span class="k">if</span> <span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;{&#39;</span><span class="p">:</span>
            <span class="n">el</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">tag</span></div>


<div class="viewcode-block" id="xhtml_to_html"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.xhtml_to_html">[docs]</a><span class="k">def</span> <span class="nf">xhtml_to_html</span><span class="p">(</span><span class="n">xhtml</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert all tags in an XHTML tree to HTML by removing their</span>
<span class="sd">    XHTML namespace.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">xhtml</span> <span class="o">=</span> <span class="n">xhtml</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;{</span><span class="si">%s</span><span class="s2">}&quot;</span> <span class="o">%</span> <span class="n">XHTML_NAMESPACE</span>
    <span class="n">prefix_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">xhtml</span><span class="o">.</span><span class="n">iter</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span><span class="p">):</span>
        <span class="n">el</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">tag</span><span class="p">[</span><span class="n">prefix_len</span><span class="p">:]</span></div>


<span class="c1"># This isn&#39;t a general match, but it&#39;s a match for what libxml2</span>
<span class="c1"># specifically serialises:</span>
<span class="n">__str_replace_meta_content_type</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="sa">r</span><span class="s1">&#39;&lt;meta http-equiv=&quot;Content-Type&quot;[^&gt;]*&gt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sub</span>
<span class="n">__bytes_replace_meta_content_type</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="sa">r</span><span class="s1">&#39;&lt;meta http-equiv=&quot;Content-Type&quot;[^&gt;]*&gt;&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ASCII&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">sub</span>


<div class="viewcode-block" id="tostring"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.tostring">[docs]</a><span class="k">def</span> <span class="nf">tostring</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">pretty_print</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">include_meta_content_type</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;html&quot;</span><span class="p">,</span> <span class="n">with_tail</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">doctype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return an HTML string representation of the document.</span>

<span class="sd">    Note: if include_meta_content_type is true this will create a</span>
<span class="sd">    ``&lt;meta http-equiv=&quot;Content-Type&quot; ...&gt;`` tag in the head;</span>
<span class="sd">    regardless of the value of include_meta_content_type any existing</span>
<span class="sd">    ``&lt;meta http-equiv=&quot;Content-Type&quot; ...&gt;`` tag will be removed</span>

<span class="sd">    The ``encoding`` argument controls the output encoding (defaults to</span>
<span class="sd">    ASCII, with &amp;#...; character references for any characters outside</span>
<span class="sd">    of ASCII).  Note that you can pass the name ``&#39;unicode&#39;`` as</span>
<span class="sd">    ``encoding`` argument to serialise to a Unicode string.</span>

<span class="sd">    The ``method`` argument defines the output method.  It defaults to</span>
<span class="sd">    &#39;html&#39;, but can also be &#39;xml&#39; for xhtml output, or &#39;text&#39; to</span>
<span class="sd">    serialise to plain text without markup.</span>

<span class="sd">    To leave out the tail text of the top-level element that is being</span>
<span class="sd">    serialised, pass ``with_tail=False``.</span>

<span class="sd">    The ``doctype`` option allows passing in a plain string that will</span>
<span class="sd">    be serialised before the XML tree.  Note that passing in non</span>
<span class="sd">    well-formed content here will make the XML output non well-formed.</span>
<span class="sd">    Also, an existing doctype in the document tree will not be removed</span>
<span class="sd">    when serialising an ElementTree instance.</span>

<span class="sd">    Example::</span>

<span class="sd">        &gt;&gt;&gt; from lxml import html</span>
<span class="sd">        &gt;&gt;&gt; root = html.fragment_fromstring(&#39;&lt;p&gt;Hello&lt;br&gt;world!&lt;/p&gt;&#39;)</span>

<span class="sd">        &gt;&gt;&gt; html.tostring(root)</span>
<span class="sd">        b&#39;&lt;p&gt;Hello&lt;br&gt;world!&lt;/p&gt;&#39;</span>
<span class="sd">        &gt;&gt;&gt; html.tostring(root, method=&#39;html&#39;)</span>
<span class="sd">        b&#39;&lt;p&gt;Hello&lt;br&gt;world!&lt;/p&gt;&#39;</span>

<span class="sd">        &gt;&gt;&gt; html.tostring(root, method=&#39;xml&#39;)</span>
<span class="sd">        b&#39;&lt;p&gt;Hello&lt;br/&gt;world!&lt;/p&gt;&#39;</span>

<span class="sd">        &gt;&gt;&gt; html.tostring(root, method=&#39;text&#39;)</span>
<span class="sd">        b&#39;Helloworld!&#39;</span>

<span class="sd">        &gt;&gt;&gt; html.tostring(root, method=&#39;text&#39;, encoding=&#39;unicode&#39;)</span>
<span class="sd">        u&#39;Helloworld!&#39;</span>

<span class="sd">        &gt;&gt;&gt; root = html.fragment_fromstring(&#39;&lt;div&gt;&lt;p&gt;Hello&lt;br&gt;world!&lt;/p&gt;TAIL&lt;/div&gt;&#39;)</span>
<span class="sd">        &gt;&gt;&gt; html.tostring(root[0], method=&#39;text&#39;, encoding=&#39;unicode&#39;)</span>
<span class="sd">        u&#39;Helloworld!TAIL&#39;</span>

<span class="sd">        &gt;&gt;&gt; html.tostring(root[0], method=&#39;text&#39;, encoding=&#39;unicode&#39;, with_tail=False)</span>
<span class="sd">        u&#39;Helloworld!&#39;</span>

<span class="sd">        &gt;&gt;&gt; doc = html.document_fromstring(&#39;&lt;p&gt;Hello&lt;br&gt;world!&lt;/p&gt;&#39;)</span>
<span class="sd">        &gt;&gt;&gt; html.tostring(doc, method=&#39;html&#39;, encoding=&#39;unicode&#39;)</span>
<span class="sd">        u&#39;&lt;html&gt;&lt;body&gt;&lt;p&gt;Hello&lt;br&gt;world!&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;&#39;</span>

<span class="sd">        &gt;&gt;&gt; print(html.tostring(doc, method=&#39;html&#39;, encoding=&#39;unicode&#39;,</span>
<span class="sd">        ...          doctype=&#39;&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01//EN&quot;&#39;</span>
<span class="sd">        ...                  &#39; &quot;http://www.w3.org/TR/html4/strict.dtd&quot;&gt;&#39;))</span>
<span class="sd">        &lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01//EN&quot; &quot;http://www.w3.org/TR/html4/strict.dtd&quot;&gt;</span>
<span class="sd">        &lt;html&gt;&lt;body&gt;&lt;p&gt;Hello&lt;br&gt;world!&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">pretty_print</span><span class="o">=</span><span class="n">pretty_print</span><span class="p">,</span>
                          <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">with_tail</span><span class="o">=</span><span class="n">with_tail</span><span class="p">,</span>
                          <span class="n">doctype</span><span class="o">=</span><span class="n">doctype</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;html&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">include_meta_content_type</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">html</span> <span class="o">=</span> <span class="n">__str_replace_meta_content_type</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">html</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">html</span> <span class="o">=</span> <span class="n">__bytes_replace_meta_content_type</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(),</span> <span class="n">html</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">html</span></div>


<span class="n">tostring</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">__fix_docstring</span><span class="p">(</span><span class="n">tostring</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>


<div class="viewcode-block" id="open_in_browser"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.open_in_browser">[docs]</a><span class="k">def</span> <span class="nf">open_in_browser</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Open the HTML document in a web browser, saving it to a temporary</span>
<span class="sd">    file to open it.  Note that this does not delete the file after</span>
<span class="sd">    use.  This is mainly meant for debugging.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">os</span>
    <span class="kn">import</span> <span class="nn">webbrowser</span>
    <span class="kn">import</span> <span class="nn">tempfile</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">_ElementTree</span><span class="p">):</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">ElementTree</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
    <span class="n">handle</span><span class="p">,</span> <span class="n">fn</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.html&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fdopen</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;html&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span> <span class="ow">or</span> <span class="n">doc</span><span class="o">.</span><span class="n">docinfo</span><span class="o">.</span><span class="n">encoding</span> <span class="ow">or</span> <span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="c1"># we leak the file itself here, but we should at least close it</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;file://&#39;</span> <span class="o">+</span> <span class="n">fn</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></div>


<span class="c1">################################################################################</span>
<span class="c1"># configure Element class lookup</span>
<span class="c1">################################################################################</span>

<div class="viewcode-block" id="HTMLParser"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.HTMLParser">[docs]</a><span class="k">class</span> <span class="nc">HTMLParser</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">HTMLParser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An HTML parser that is configured to return lxml.html Element</span>
<span class="sd">    objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">HTMLParser</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_element_class_lookup</span><span class="p">(</span><span class="n">HtmlElementClassLookup</span><span class="p">())</span></div>


<div class="viewcode-block" id="XHTMLParser"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.XHTMLParser">[docs]</a><span class="k">class</span> <span class="nc">XHTMLParser</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">XMLParser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An XML parser that is configured to return lxml.html Element</span>
<span class="sd">    objects.</span>

<span class="sd">    Note that this parser is not really XHTML aware unless you let it</span>
<span class="sd">    load a DTD that declares the HTML entities.  To do this, make sure</span>
<span class="sd">    you have the XHTML DTDs installed in your catalogs, and create the</span>
<span class="sd">    parser like this::</span>

<span class="sd">        &gt;&gt;&gt; parser = XHTMLParser(load_dtd=True)</span>

<span class="sd">    If you additionally want to validate the document, use this::</span>

<span class="sd">        &gt;&gt;&gt; parser = XHTMLParser(dtd_validation=True)</span>

<span class="sd">    For catalog support, see http://www.xmlsoft.org/catalog.html.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">XHTMLParser</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_element_class_lookup</span><span class="p">(</span><span class="n">HtmlElementClassLookup</span><span class="p">())</span></div>


<div class="viewcode-block" id="Element"><a class="viewcode-back" href="../../lxml.html.html#lxml.html.Element">[docs]</a><span class="k">def</span> <span class="nf">Element</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a new HTML Element.</span>

<span class="sd">    This can also be used for XHTML documents.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">html_parser</span><span class="o">.</span><span class="n">makeelement</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v</span></div>


<span class="n">html_parser</span> <span class="o">=</span> <span class="n">HTMLParser</span><span class="p">()</span>
<span class="n">xhtml_parser</span> <span class="o">=</span> <span class="n">XHTMLParser</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, lxml dev team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>