<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">



<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        
        <title>
            
    
    SQLite
 &mdash;
    SQLAlchemy 1.3 Documentation

        </title>

        
            <!-- begin iterate through site-imported + sphinx environment css_files -->
                <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
                <link rel="stylesheet" href="../_static/docs.css" type="text/css" />
                <link rel="stylesheet" href="../_static/changelog.css" type="text/css" />
                <link rel="stylesheet" href="../_static/sphinx_paramlinks.css" type="text/css" />
            <!-- end iterate through site-imported + sphinx environment css_files -->
        

        

    

    <!-- begin layout.mako headers -->

    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
        <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="SQLAlchemy 1.3 Documentation" href="../index.html" />
        <link rel="up" title="Dialects" href="index.html" />
        <link rel="next" title="Oracle" href="oracle.html" />
        <link rel="prev" title="MySQL" href="mysql.html" />
    <!-- end layout.mako headers -->


    </head>
    <body>
        
















<div id="docs-container">





<div id="docs-top-navigation-container" class="body-background">
<div id="docs-header">
    <div id="docs-version-header">
        Release: <span class="version-num">1.3.17</span>


        | Release Date: May 13, 2020

    </div>

    <h1>SQLAlchemy 1.3 Documentation</h1>

</div>
</div>

<div id="docs-body-container">

    <div id="fixed-sidebar" class="withsidebar">


        <div id="docs-sidebar-popout">
            <h3><a href="../index.html">SQLAlchemy 1.3 Documentation</a></h3>
            <p id="sidebar-topnav">
                <a href="../contents.html">Contents</a> |
                <a href="../genindex.html">Index</a>
            </p>

            <div id="sidebar-search">
                <form class="search" action="../search.html" method="get">
                  <label>
                  Search terms:
                  <input type="text" placeholder="search..." name="q" size="12" />
                  </label>
                  <input type="hidden" name="check_keywords" value="yes" />
                  <input type="hidden" name="area" value="default" />
                </form>
            </div>

        </div>

        <div id="docs-sidebar">

        <div id="sidebar-banner">
            
        </div>

        <div id="docs-sidebar-inner">

        
        <h3>
            <a href="index.html" title="Dialects">Dialects</a>
        </h3>

        <ul>
<li><span class="link-container"><a class="reference external" href="postgresql.html">PostgreSQL</a></span></li>
<li><span class="link-container"><a class="reference external" href="mysql.html">MySQL</a></span></li>
<li class="selected"><span class="link-container"><strong>SQLite</strong><a class="paramlink headerlink reference internal" href="#">¶</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#dialect-sqlite">Support for the SQLite database.</a></span></li>
<li><span class="link-container"><a class="reference external" href="#date-and-time-types">Date and Time Types</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#ensuring-text-affinity">Ensuring Text affinity</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#sqlite-auto-incrementing-behavior">SQLite Auto Incrementing Behavior</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#using-the-autoincrement-keyword">Using the AUTOINCREMENT Keyword</a></span></li>
<li><span class="link-container"><a class="reference external" href="#allowing-autoincrement-behavior-sqlalchemy-types-other-than-integer-integer">Allowing autoincrement behavior SQLAlchemy types other than Integer/INTEGER</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#database-locking-behavior-concurrency">Database Locking Behavior / Concurrency</a></span></li>
<li><span class="link-container"><a class="reference external" href="#transaction-isolation-level-autocommit">Transaction Isolation Level / Autocommit</a></span></li>
<li><span class="link-container"><a class="reference external" href="#savepoint-support">SAVEPOINT Support</a></span></li>
<li><span class="link-container"><a class="reference external" href="#transactional-ddl">Transactional DDL</a></span></li>
<li><span class="link-container"><a class="reference external" href="#foreign-key-support">Foreign Key Support</a></span></li>
<li><span class="link-container"><a class="reference external" href="#on-conflict-support-for-constraints">ON CONFLICT support for constraints</a></span></li>
<li><span class="link-container"><a class="reference external" href="#type-reflection">Type Reflection</a></span></li>
<li><span class="link-container"><a class="reference external" href="#partial-indexes">Partial Indexes</a></span></li>
<li><span class="link-container"><a class="reference external" href="#dotted-column-names">Dotted Column Names</a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlite-data-types">SQLite Data Types</a></span></li>
<li><span class="link-container"><a class="reference external" href="#module-sqlalchemy.dialects.sqlite.pysqlite">Pysqlite</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#dialect-sqlite-pysqlite-url">DBAPI</a></span></li>
<li><span class="link-container"><a class="reference external" href="#dialect-sqlite-pysqlite-connect">Connecting</a></span></li>
<li><span class="link-container"><a class="reference external" href="#driver">Driver</a></span></li>
<li><span class="link-container"><a class="reference external" href="#connect-strings">Connect Strings</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#uri-connections">URI Connections</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#compatibility-with-sqlite3-native-date-and-datetime-types">Compatibility with sqlite3 “native” date and datetime types</a></span></li>
<li><span class="link-container"><a class="reference external" href="#threading-pooling-behavior">Threading/Pooling Behavior</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#using-a-memory-database-in-multiple-threads">Using a Memory Database in Multiple Threads</a></span></li>
<li><span class="link-container"><a class="reference external" href="#using-temporary-tables-with-sqlite">Using Temporary Tables with SQLite</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#unicode">Unicode</a></span></li>
<li><span class="link-container"><a class="reference external" href="#dealing-with-mixed-string-binary-columns-in-python-3">Dealing with Mixed String / Binary Columns in Python 3</a></span></li>
<li><span class="link-container"><a class="reference external" href="#serializable-isolation-savepoints-transactional-ddl">Serializable isolation / Savepoints / Transactional DDL</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#module-sqlalchemy.dialects.sqlite.pysqlcipher">Pysqlcipher</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#dialect-sqlite-pysqlcipher-url">DBAPI</a></span></li>
<li><span class="link-container"><a class="reference external" href="#dialect-sqlite-pysqlcipher-connect">Connecting</a></span></li>
<li><span class="link-container"><a class="reference external" href="#id3">Driver</a></span></li>
<li><span class="link-container"><a class="reference external" href="#id5">Connect Strings</a></span></li>
<li><span class="link-container"><a class="reference external" href="#pooling-behavior">Pooling Behavior</a></span></li>
</ul>
</li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="oracle.html">Oracle</a></span></li>
<li><span class="link-container"><a class="reference external" href="mssql.html">Microsoft SQL Server</a></span></li>
<li><span class="link-container"><a class="reference external" href="firebird.html">Firebird</a></span></li>
<li><span class="link-container"><a class="reference external" href="sybase.html">Sybase</a></span></li>
</ul>



        </div>

        </div>

    </div>

    

    <div id="docs-body" class="withsidebar" >
        
<div class="section" id="module-sqlalchemy.dialects.sqlite.base">
<span id="sqlite"></span><span id="sqlite-toplevel"></span><h1>SQLite<a class="headerlink" href="#module-sqlalchemy.dialects.sqlite.base" title="Permalink to this headline">¶</a></h1>
<div class="section" id="dialect-sqlite">
<p>Support for the SQLite database.</p>
<h2>DBAPI Support<a class="headerlink" href="#dialect-sqlite" title="Permalink to this headline">¶</a></h2>
<p>The following dialect/DBAPI options are available.  Please refer to individual DBAPI sections for connect information.<ul class="simple">
<li><p><a class="reference external" href="#module-sqlalchemy.dialects.sqlite.pysqlite">pysqlite</a></p></li>
<li><p><a class="reference external" href="#module-sqlalchemy.dialects.sqlite.pysqlcipher">pysqlcipher</a></p></li>
</ul>
</p>
</div>
<div class="section" id="date-and-time-types">
<span id="sqlite-datetime"></span><h2>Date and Time Types<a class="headerlink" href="#date-and-time-types" title="Permalink to this headline">¶</a></h2>
<p>SQLite does not have built-in DATE, TIME, or DATETIME types, and pysqlite does
not provide out of the box functionality for translating values between Python
<cite>datetime</cite> objects and a SQLite-supported format. SQLAlchemy’s own
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.DateTime" title="sqlalchemy.types.DateTime"><code class="xref py py-class docutils literal notranslate"><span class="pre">DateTime</span></code></a> and related types provide date formatting
and parsing functionality when SQLite is used. The implementation classes are
<a class="reference internal" href="#sqlalchemy.dialects.sqlite.DATETIME" title="sqlalchemy.dialects.sqlite.DATETIME"><code class="xref py py-class docutils literal notranslate"><span class="pre">DATETIME</span></code></a>, <a class="reference internal" href="#sqlalchemy.dialects.sqlite.DATE" title="sqlalchemy.dialects.sqlite.DATE"><code class="xref py py-class docutils literal notranslate"><span class="pre">DATE</span></code></a> and <a class="reference internal" href="#sqlalchemy.dialects.sqlite.TIME" title="sqlalchemy.dialects.sqlite.TIME"><code class="xref py py-class docutils literal notranslate"><span class="pre">TIME</span></code></a>.
These types represent dates and times as ISO formatted strings, which also
nicely support ordering. There’s no reliance on typical “libc” internals for
these functions so historical dates are fully supported.</p>
<div class="section" id="ensuring-text-affinity">
<h3>Ensuring Text affinity<a class="headerlink" href="#ensuring-text-affinity" title="Permalink to this headline">¶</a></h3>
<p>The DDL rendered for these types is the standard <code class="docutils literal notranslate"><span class="pre">DATE</span></code>, <code class="docutils literal notranslate"><span class="pre">TIME</span></code>
and <code class="docutils literal notranslate"><span class="pre">DATETIME</span></code> indicators.    However, custom storage formats can also be
applied to these types.   When the
storage format is detected as containing no alpha characters, the DDL for
these types is rendered as <code class="docutils literal notranslate"><span class="pre">DATE_CHAR</span></code>, <code class="docutils literal notranslate"><span class="pre">TIME_CHAR</span></code>, and <code class="docutils literal notranslate"><span class="pre">DATETIME_CHAR</span></code>,
so that the column continues to have textual affinity.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="http://www.sqlite.org/datatype3.html#affinity">Type Affinity</a> -
in the SQLite documentation</p>
</div>
</div>
</div>
<div class="section" id="sqlite-auto-incrementing-behavior">
<span id="sqlite-autoincrement"></span><h2>SQLite Auto Incrementing Behavior<a class="headerlink" href="#sqlite-auto-incrementing-behavior" title="Permalink to this headline">¶</a></h2>
<p>Background on SQLite’s autoincrement is at: <a class="reference external" href="http://sqlite.org/autoinc.html">http://sqlite.org/autoinc.html</a></p>
<p>Key concepts:</p>
<ul class="simple">
<li><p>SQLite has an implicit “auto increment” feature that takes place for any
non-composite primary-key column that is specifically created using
“INTEGER PRIMARY KEY” for the type + primary key.</p></li>
<li><p>SQLite also has an explicit “AUTOINCREMENT” keyword, that is <strong>not</strong>
equivalent to the implicit autoincrement feature; this keyword is not
recommended for general use.  SQLAlchemy does not render this keyword
unless a special SQLite-specific directive is used (see below).  However,
it still requires that the column’s type is named “INTEGER”.</p></li>
</ul>
<div class="section" id="using-the-autoincrement-keyword">
<h3>Using the AUTOINCREMENT Keyword<a class="headerlink" href="#using-the-autoincrement-keyword" title="Permalink to this headline">¶</a></h3>
<p>To specifically render the AUTOINCREMENT keyword on the primary key column
when rendering DDL, add the flag <code class="docutils literal notranslate"><span class="pre">sqlite_autoincrement=True</span></code> to the Table
construct:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Table</span><span class="p">(</span><span class="s1">&#39;sometable&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
        <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">sqlite_autoincrement</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></pre></div>
</div>
</div>
<div class="section" id="allowing-autoincrement-behavior-sqlalchemy-types-other-than-integer-integer">
<h3>Allowing autoincrement behavior SQLAlchemy types other than Integer/INTEGER<a class="headerlink" href="#allowing-autoincrement-behavior-sqlalchemy-types-other-than-integer-integer" title="Permalink to this headline">¶</a></h3>
<p>SQLite’s typing model is based on naming conventions.  Among other things, this
means that any type name which contains the substring <code class="docutils literal notranslate"><span class="pre">&quot;INT&quot;</span></code> will be
determined to be of “integer affinity”.  A type named <code class="docutils literal notranslate"><span class="pre">&quot;BIGINT&quot;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&quot;SPECIAL_INT&quot;</span></code> or even <code class="docutils literal notranslate"><span class="pre">&quot;XYZINTQPR&quot;</span></code>, will be considered by SQLite to be
of “integer” affinity.  However, <strong>the SQLite autoincrement feature, whether
implicitly or explicitly enabled, requires that the name of the column’s type
is exactly the string “INTEGER”</strong>.  Therefore, if an application uses a type
like <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.BigInteger" title="sqlalchemy.types.BigInteger"><code class="xref py py-class docutils literal notranslate"><span class="pre">BigInteger</span></code></a> for a primary key, on SQLite this type will need to
be rendered as the name <code class="docutils literal notranslate"><span class="pre">&quot;INTEGER&quot;</span></code> when emitting the initial <code class="docutils literal notranslate"><span class="pre">CREATE</span>
<span class="pre">TABLE</span></code> statement in order for the autoincrement behavior to be available.</p>
<p>One approach to achieve this is to use <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Integer" title="sqlalchemy.types.Integer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Integer</span></code></a> on SQLite
only using <a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine.with_variant" title="sqlalchemy.types.TypeEngine.with_variant"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TypeEngine.with_variant()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s2">&quot;my_table&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">BigInteger</span><span class="p">()</span><span class="o">.</span><span class="n">with_variant</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="s2">&quot;sqlite&quot;</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<p>Another is to use a subclass of <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.BigInteger" title="sqlalchemy.types.BigInteger"><code class="xref py py-class docutils literal notranslate"><span class="pre">BigInteger</span></code></a> that overrides its DDL
name to be <code class="docutils literal notranslate"><span class="pre">INTEGER</span></code> when compiled against SQLite:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="k">import</span> <span class="n">BigInteger</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.compiler</span> <span class="k">import</span> <span class="n">compiles</span>

<span class="k">class</span> <span class="nc">SLBigInteger</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="nd">@compiles</span><span class="p">(</span><span class="n">SLBigInteger</span><span class="p">,</span> <span class="s1">&#39;sqlite&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">bi_c</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">compiler</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;INTEGER&quot;</span>

<span class="nd">@compiles</span><span class="p">(</span><span class="n">SLBigInteger</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">bi_c</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">compiler</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">compiler</span><span class="o">.</span><span class="n">visit_BIGINT</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>


<span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s2">&quot;my_table&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">SLBigInteger</span><span class="p">(),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine.with_variant" title="sqlalchemy.types.TypeEngine.with_variant"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TypeEngine.with_variant()</span></code></a></p>
<p><a class="reference internal" href="../core/compiler.html"><span class="std std-ref">Custom SQL Constructs and Compilation Extension</span></a></p>
<p><a class="reference external" href="http://sqlite.org/datatype3.html">Datatypes In SQLite Version 3</a></p>
</div>
</div>
</div>
<div class="section" id="database-locking-behavior-concurrency">
<span id="sqlite-concurrency"></span><h2>Database Locking Behavior / Concurrency<a class="headerlink" href="#database-locking-behavior-concurrency" title="Permalink to this headline">¶</a></h2>
<p>SQLite is not designed for a high level of write concurrency. The database
itself, being a file, is locked completely during write operations within
transactions, meaning exactly one “connection” (in reality a file handle)
has exclusive access to the database during this period - all other
“connections” will be blocked during this time.</p>
<p>The Python DBAPI specification also calls for a connection model that is
always in a transaction; there is no <code class="docutils literal notranslate"><span class="pre">connection.begin()</span></code> method,
only <code class="docutils literal notranslate"><span class="pre">connection.commit()</span></code> and <code class="docutils literal notranslate"><span class="pre">connection.rollback()</span></code>, upon which a
new transaction is to be begun immediately.  This may seem to imply
that the SQLite driver would in theory allow only a single filehandle on a
particular database file at any time; however, there are several
factors both within SQLite itself as well as within the pysqlite driver
which loosen this restriction significantly.</p>
<p>However, no matter what locking modes are used, SQLite will still always
lock the database file once a transaction is started and DML (e.g. INSERT,
UPDATE, DELETE) has at least been emitted, and this will block
other transactions at least at the point that they also attempt to emit DML.
By default, the length of time on this block is very short before it times out
with an error.</p>
<p>This behavior becomes more critical when used in conjunction with the
SQLAlchemy ORM.  SQLAlchemy’s <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> object by default runs
within a transaction, and with its autoflush model, may emit DML preceding
any SELECT statement.   This may lead to a SQLite database that locks
more quickly than is expected.   The locking mode of SQLite and the pysqlite
driver can be manipulated to some degree, however it should be noted that
achieving a high degree of write-concurrency with SQLite is a losing battle.</p>
<p>For more information on SQLite’s lack of write concurrency by design, please
see
<a class="reference external" href="http://www.sqlite.org/whentouse.html">Situations Where Another RDBMS May Work Better - High Concurrency</a> near the bottom of the page.</p>
<p>The following subsections introduce areas that are impacted by SQLite’s
file-based architecture and additionally will usually require workarounds to
work when using the pysqlite driver.</p>
</div>
<div class="section" id="transaction-isolation-level-autocommit">
<span id="sqlite-isolation-level"></span><h2>Transaction Isolation Level / Autocommit<a class="headerlink" href="#transaction-isolation-level-autocommit" title="Permalink to this headline">¶</a></h2>
<p>SQLite supports “transaction isolation” in a non-standard way, along two
axes.  One is that of the
<a class="reference external" href="http://www.sqlite.org/pragma.html#pragma_read_uncommitted">PRAGMA read_uncommitted</a>
instruction.   This setting can essentially switch SQLite between its
default mode of <code class="docutils literal notranslate"><span class="pre">SERIALIZABLE</span></code> isolation, and a “dirty read” isolation
mode normally referred to as <code class="docutils literal notranslate"><span class="pre">READ</span> <span class="pre">UNCOMMITTED</span></code>.</p>
<p>SQLAlchemy ties into this PRAGMA statement using the
<a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.isolation_level" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.isolation_level</span></code></a> parameter of
<a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a>.
Valid values for this parameter when used with SQLite are <code class="docutils literal notranslate"><span class="pre">&quot;SERIALIZABLE&quot;</span></code>
and <code class="docutils literal notranslate"><span class="pre">&quot;READ</span> <span class="pre">UNCOMMITTED&quot;</span></code> corresponding to a value of 0 and 1, respectively.
SQLite defaults to <code class="docutils literal notranslate"><span class="pre">SERIALIZABLE</span></code>, however its behavior is impacted by
the pysqlite driver’s default behavior.</p>
<p>When using the pysqlite driver, the <code class="docutils literal notranslate"><span class="pre">&quot;AUTOCOMMIT&quot;</span></code> isolation level is also
available, which will alter the pysqlite connection using the <code class="docutils literal notranslate"><span class="pre">.isolation_level</span></code>
attribute on the DBAPI connection and set it to None for the duration
of the setting.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.3.16: </span>added support for SQLite AUTOCOMMIT isolation level
when using the pysqlite / sqlite3 SQLite driver.</p>
</div>
<p>The other axis along which SQLite’s transactional locking is impacted is
via the nature of the <code class="docutils literal notranslate"><span class="pre">BEGIN</span></code> statement used.   The three varieties
are “deferred”, “immediate”, and “exclusive”, as described at
<a class="reference external" href="http://sqlite.org/lang_transaction.html">BEGIN TRANSACTION</a>.   A straight
<code class="docutils literal notranslate"><span class="pre">BEGIN</span></code> statement uses the “deferred” mode, where the database file is
not locked until the first read or write operation, and read access remains
open to other transactions until the first write operation.  But again,
it is critical to note that the pysqlite driver interferes with this behavior
by <em>not even emitting BEGIN</em> until the first write operation.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>SQLite’s transactional scope is impacted by unresolved
issues in the pysqlite driver, which defers BEGIN statements to a greater
degree than is often feasible. See the section <a class="reference internal" href="#pysqlite-serializable"><span class="std std-ref">Serializable isolation / Savepoints / Transactional DDL</span></a>
for techniques to work around this behavior.</p>
</div>
</div>
<div class="section" id="savepoint-support">
<h2>SAVEPOINT Support<a class="headerlink" href="#savepoint-support" title="Permalink to this headline">¶</a></h2>
<p>SQLite supports SAVEPOINTs, which only function once a transaction is
begun.   SQLAlchemy’s SAVEPOINT support is available using the
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.begin_nested" title="sqlalchemy.engine.Connection.begin_nested"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin_nested()</span></code></a> method at the Core level, and
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.session.Session.begin_nested" title="sqlalchemy.orm.session.Session.begin_nested"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.begin_nested()</span></code></a> at the ORM level.   However, SAVEPOINTs
won’t work at all with pysqlite unless workarounds are taken.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>SQLite’s SAVEPOINT feature is impacted by unresolved
issues in the pysqlite driver, which defers BEGIN statements to a greater
degree than is often feasible. See the section <a class="reference internal" href="#pysqlite-serializable"><span class="std std-ref">Serializable isolation / Savepoints / Transactional DDL</span></a>
for techniques to work around this behavior.</p>
</div>
</div>
<div class="section" id="transactional-ddl">
<h2>Transactional DDL<a class="headerlink" href="#transactional-ddl" title="Permalink to this headline">¶</a></h2>
<p>The SQLite database supports transactional <a class="reference internal" href="../glossary.html#term-DDL"><span class="xref std std-term">DDL</span></a> as well.
In this case, the pysqlite driver is not only failing to start transactions,
it also is ending any existing transaction when DDL is detected, so again,
workarounds are required.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>SQLite’s transactional DDL is impacted by unresolved issues
in the pysqlite driver, which fails to emit BEGIN and additionally
forces a COMMIT to cancel any transaction when DDL is encountered.
See the section <a class="reference internal" href="#pysqlite-serializable"><span class="std std-ref">Serializable isolation / Savepoints / Transactional DDL</span></a>
for techniques to work around this behavior.</p>
</div>
</div>
<div class="section" id="foreign-key-support">
<span id="sqlite-foreign-keys"></span><h2>Foreign Key Support<a class="headerlink" href="#foreign-key-support" title="Permalink to this headline">¶</a></h2>
<p>SQLite supports FOREIGN KEY syntax when emitting CREATE statements for tables,
however by default these constraints have no effect on the operation of the
table.</p>
<p>Constraint checking on SQLite has three prerequisites:</p>
<ul class="simple">
<li><p>At least version 3.6.19 of SQLite must be in use</p></li>
<li><p>The SQLite library must be compiled <em>without</em> the SQLITE_OMIT_FOREIGN_KEY
or SQLITE_OMIT_TRIGGER symbols enabled.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">PRAGMA</span> <span class="pre">foreign_keys</span> <span class="pre">=</span> <span class="pre">ON</span></code> statement must be emitted on all
connections before use.</p></li>
</ul>
<p>SQLAlchemy allows for the <code class="docutils literal notranslate"><span class="pre">PRAGMA</span></code> statement to be emitted automatically for
new connections through the usage of events:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.engine</span> <span class="k">import</span> <span class="n">Engine</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="k">import</span> <span class="n">event</span>

<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">Engine</span><span class="p">,</span> <span class="s2">&quot;connect&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">set_sqlite_pragma</span><span class="p">(</span><span class="n">dbapi_connection</span><span class="p">,</span> <span class="n">connection_record</span><span class="p">):</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">dbapi_connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;PRAGMA foreign_keys=ON&quot;</span><span class="p">)</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When SQLite foreign keys are enabled, it is <strong>not possible</strong>
to emit CREATE or DROP statements for tables that contain
mutually-dependent foreign key constraints;
to emit the DDL for these tables requires that ALTER TABLE be used to
create or drop these constraints separately, for which SQLite has
no support.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="http://www.sqlite.org/foreignkeys.html">SQLite Foreign Key Support</a>
- on the SQLite web site.</p>
<p><a class="reference internal" href="../core/event.html"><span class="std std-ref">Events</span></a> - SQLAlchemy event API.</p>
<dl class="simple">
<dt><a class="reference internal" href="../core/constraints.html#use-alter"><span class="std std-ref">Creating/Dropping Foreign Key Constraints via ALTER</span></a> - more information on SQLAlchemy’s facilities for handling</dt><dd><p>mutually-dependent foreign key constraints.</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="on-conflict-support-for-constraints">
<span id="sqlite-on-conflict-ddl"></span><h2>ON CONFLICT support for constraints<a class="headerlink" href="#on-conflict-support-for-constraints" title="Permalink to this headline">¶</a></h2>
<p>SQLite supports a non-standard clause known as ON CONFLICT which can be applied
to primary key, unique, check, and not null constraints.   In DDL, it is
rendered either within the “CONSTRAINT” clause or within the column definition
itself depending on the location of the target constraint.    To render this
clause within DDL, the extension parameter <code class="docutils literal notranslate"><span class="pre">sqlite_on_conflict</span></code> can be
specified with a string conflict resolution algorithm within the
<a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.PrimaryKeyConstraint" title="sqlalchemy.schema.PrimaryKeyConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">PrimaryKeyConstraint</span></code></a>, <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.UniqueConstraint" title="sqlalchemy.schema.UniqueConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">UniqueConstraint</span></code></a>,
<a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.CheckConstraint" title="sqlalchemy.schema.CheckConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">CheckConstraint</span></code></a> objects.  Within the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> object,
there
are individual parameters <code class="docutils literal notranslate"><span class="pre">sqlite_on_conflict_not_null</span></code>,
<code class="docutils literal notranslate"><span class="pre">sqlite_on_conflict_primary_key</span></code>, <code class="docutils literal notranslate"><span class="pre">sqlite_on_conflict_unique</span></code> which each
correspond to the three types of relevant constraint types that can be
indicated from a <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> object.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://www.sqlite.org/lang_conflict.html">ON CONFLICT</a> - in the SQLite
documentation</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.3.</span></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">sqlite_on_conflict</span></code> parameters accept a  string argument which is just
the resolution name to be chosen, which on SQLite can be one of ROLLBACK,
ABORT, FAIL, IGNORE, and REPLACE.   For example, to add a UNIQUE constraint
that specifies the IGNORE algorithm:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">some_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s1">&#39;some_table&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">),</span>
    <span class="n">UniqueConstraint</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">sqlite_on_conflict</span><span class="o">=</span><span class="s1">&#39;IGNORE&#39;</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<p>The above renders CREATE TABLE DDL as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">TABLE</span> <span class="n">some_table</span> <span class="p">(</span>
    <span class="nb">id</span> <span class="n">INTEGER</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span>
    <span class="n">data</span> <span class="n">INTEGER</span><span class="p">,</span>
    <span class="n">PRIMARY</span> <span class="n">KEY</span> <span class="p">(</span><span class="nb">id</span><span class="p">),</span>
    <span class="n">UNIQUE</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="n">ON</span> <span class="n">CONFLICT</span> <span class="n">IGNORE</span>
<span class="p">)</span></pre></div>
</div>
<p>When using the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column.params.unique" title="sqlalchemy.schema.Column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Column.unique</span></code></a>
flag to add a UNIQUE constraint
to a single column, the <code class="docutils literal notranslate"><span class="pre">sqlite_on_conflict_unique</span></code> parameter can
be added to the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> as well, which will be added to the
UNIQUE constraint in the DDL:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">some_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s1">&#39;some_table&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
           <span class="n">sqlite_on_conflict_unique</span><span class="o">=</span><span class="s1">&#39;IGNORE&#39;</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<p>rendering:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">TABLE</span> <span class="n">some_table</span> <span class="p">(</span>
    <span class="nb">id</span> <span class="n">INTEGER</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span>
    <span class="n">data</span> <span class="n">INTEGER</span><span class="p">,</span>
    <span class="n">PRIMARY</span> <span class="n">KEY</span> <span class="p">(</span><span class="nb">id</span><span class="p">),</span>
    <span class="n">UNIQUE</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="n">ON</span> <span class="n">CONFLICT</span> <span class="n">IGNORE</span>
<span class="p">)</span></pre></div>
</div>
<p>To apply the FAIL algorithm for a NOT NULL constraint,
<code class="docutils literal notranslate"><span class="pre">sqlite_on_conflict_not_null</span></code> is used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">some_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s1">&#39;some_table&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
           <span class="n">sqlite_on_conflict_not_null</span><span class="o">=</span><span class="s1">&#39;FAIL&#39;</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<p>this renders the column inline ON CONFLICT phrase:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">TABLE</span> <span class="n">some_table</span> <span class="p">(</span>
    <span class="nb">id</span> <span class="n">INTEGER</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span>
    <span class="n">data</span> <span class="n">INTEGER</span> <span class="n">NOT</span> <span class="n">NULL</span> <span class="n">ON</span> <span class="n">CONFLICT</span> <span class="n">FAIL</span><span class="p">,</span>
    <span class="n">PRIMARY</span> <span class="n">KEY</span> <span class="p">(</span><span class="nb">id</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<p>Similarly, for an inline primary key, use <code class="docutils literal notranslate"><span class="pre">sqlite_on_conflict_primary_key</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">some_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s1">&#39;some_table&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
           <span class="n">sqlite_on_conflict_primary_key</span><span class="o">=</span><span class="s1">&#39;FAIL&#39;</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<p>SQLAlchemy renders the PRIMARY KEY constraint separately, so the conflict
resolution algorithm is applied to the constraint itself:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">TABLE</span> <span class="n">some_table</span> <span class="p">(</span>
    <span class="nb">id</span> <span class="n">INTEGER</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span>
    <span class="n">PRIMARY</span> <span class="n">KEY</span> <span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="n">ON</span> <span class="n">CONFLICT</span> <span class="n">FAIL</span>
<span class="p">)</span></pre></div>
</div>
</div>
<div class="section" id="type-reflection">
<span id="sqlite-type-reflection"></span><h2>Type Reflection<a class="headerlink" href="#type-reflection" title="Permalink to this headline">¶</a></h2>
<p>SQLite types are unlike those of most other database backends, in that
the string name of the type usually does not correspond to a “type” in a
one-to-one fashion.  Instead, SQLite links per-column typing behavior
to one of five so-called “type affinities” based on a string matching
pattern for the type.</p>
<p>SQLAlchemy’s reflection process, when inspecting types, uses a simple
lookup table to link the keywords returned to provided SQLAlchemy types.
This lookup table is present within the SQLite dialect as it is for all
other dialects.  However, the SQLite dialect has a different “fallback”
routine for when a particular type name is not located in the lookup map;
it instead implements the SQLite “type affinity” scheme located at
<a class="reference external" href="http://www.sqlite.org/datatype3.html">http://www.sqlite.org/datatype3.html</a> section 2.1.</p>
<p>The provided typemap will make direct associations from an exact string
name match for the following types:</p>
<p><a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.BIGINT" title="sqlalchemy.types.BIGINT"><code class="xref py py-class docutils literal notranslate"><span class="pre">BIGINT</span></code></a>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.BLOB" title="sqlalchemy.types.BLOB"><code class="xref py py-class docutils literal notranslate"><span class="pre">BLOB</span></code></a>,
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.BOOLEAN" title="sqlalchemy.types.BOOLEAN"><code class="xref py py-class docutils literal notranslate"><span class="pre">BOOLEAN</span></code></a>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.BOOLEAN" title="sqlalchemy.types.BOOLEAN"><code class="xref py py-class docutils literal notranslate"><span class="pre">BOOLEAN</span></code></a>,
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.CHAR" title="sqlalchemy.types.CHAR"><code class="xref py py-class docutils literal notranslate"><span class="pre">CHAR</span></code></a>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.DATE" title="sqlalchemy.types.DATE"><code class="xref py py-class docutils literal notranslate"><span class="pre">DATE</span></code></a>,
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.DATETIME" title="sqlalchemy.types.DATETIME"><code class="xref py py-class docutils literal notranslate"><span class="pre">DATETIME</span></code></a>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.FLOAT" title="sqlalchemy.types.FLOAT"><code class="xref py py-class docutils literal notranslate"><span class="pre">FLOAT</span></code></a>,
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.DECIMAL" title="sqlalchemy.types.DECIMAL"><code class="xref py py-class docutils literal notranslate"><span class="pre">DECIMAL</span></code></a>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.FLOAT" title="sqlalchemy.types.FLOAT"><code class="xref py py-class docutils literal notranslate"><span class="pre">FLOAT</span></code></a>,
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.INTEGER" title="sqlalchemy.types.INTEGER"><code class="xref py py-class docutils literal notranslate"><span class="pre">INTEGER</span></code></a>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.INTEGER" title="sqlalchemy.types.INTEGER"><code class="xref py py-class docutils literal notranslate"><span class="pre">INTEGER</span></code></a>,
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.NUMERIC" title="sqlalchemy.types.NUMERIC"><code class="xref py py-class docutils literal notranslate"><span class="pre">NUMERIC</span></code></a>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.REAL" title="sqlalchemy.types.REAL"><code class="xref py py-class docutils literal notranslate"><span class="pre">REAL</span></code></a>,
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.SMALLINT" title="sqlalchemy.types.SMALLINT"><code class="xref py py-class docutils literal notranslate"><span class="pre">SMALLINT</span></code></a>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.TEXT" title="sqlalchemy.types.TEXT"><code class="xref py py-class docutils literal notranslate"><span class="pre">TEXT</span></code></a>,
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.TIME" title="sqlalchemy.types.TIME"><code class="xref py py-class docutils literal notranslate"><span class="pre">TIME</span></code></a>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.TIMESTAMP" title="sqlalchemy.types.TIMESTAMP"><code class="xref py py-class docutils literal notranslate"><span class="pre">TIMESTAMP</span></code></a>,
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.VARCHAR" title="sqlalchemy.types.VARCHAR"><code class="xref py py-class docutils literal notranslate"><span class="pre">VARCHAR</span></code></a>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.NVARCHAR" title="sqlalchemy.types.NVARCHAR"><code class="xref py py-class docutils literal notranslate"><span class="pre">NVARCHAR</span></code></a>,
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.NCHAR" title="sqlalchemy.types.NCHAR"><code class="xref py py-class docutils literal notranslate"><span class="pre">NCHAR</span></code></a></p>
<p>When a type name does not match one of the above types, the “type affinity”
lookup is used instead:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.INTEGER" title="sqlalchemy.types.INTEGER"><code class="xref py py-class docutils literal notranslate"><span class="pre">INTEGER</span></code></a> is returned if the type name includes the
string <code class="docutils literal notranslate"><span class="pre">INT</span></code></p></li>
<li><p><a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.TEXT" title="sqlalchemy.types.TEXT"><code class="xref py py-class docutils literal notranslate"><span class="pre">TEXT</span></code></a> is returned if the type name includes the
string <code class="docutils literal notranslate"><span class="pre">CHAR</span></code>, <code class="docutils literal notranslate"><span class="pre">CLOB</span></code> or <code class="docutils literal notranslate"><span class="pre">TEXT</span></code></p></li>
<li><p><a class="reference internal" href="../core/type_api.html#sqlalchemy.types.NullType" title="sqlalchemy.types.NullType"><code class="xref py py-class docutils literal notranslate"><span class="pre">NullType</span></code></a> is returned if the type name includes the
string <code class="docutils literal notranslate"><span class="pre">BLOB</span></code></p></li>
<li><p><a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.REAL" title="sqlalchemy.types.REAL"><code class="xref py py-class docutils literal notranslate"><span class="pre">REAL</span></code></a> is returned if the type name includes the string
<code class="docutils literal notranslate"><span class="pre">REAL</span></code>, <code class="docutils literal notranslate"><span class="pre">FLOA</span></code> or <code class="docutils literal notranslate"><span class="pre">DOUB</span></code>.</p></li>
<li><p>Otherwise, the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.NUMERIC" title="sqlalchemy.types.NUMERIC"><code class="xref py py-class docutils literal notranslate"><span class="pre">NUMERIC</span></code></a> type is used.</p></li>
</ul>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.9.3: </span>Support for SQLite type affinity rules when reflecting
columns.</p>
</div>
</div>
<div class="section" id="partial-indexes">
<span id="sqlite-partial-index"></span><h2>Partial Indexes<a class="headerlink" href="#partial-indexes" title="Permalink to this headline">¶</a></h2>
<p>A partial index, e.g. one which uses a WHERE clause, can be specified
with the DDL system using the argument <code class="docutils literal notranslate"><span class="pre">sqlite_where</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tbl</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&#39;testtbl&#39;</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">))</span>
<span class="n">idx</span> <span class="o">=</span> <span class="n">Index</span><span class="p">(</span><span class="s1">&#39;test_idx1&#39;</span><span class="p">,</span> <span class="n">tbl</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
            <span class="n">sqlite_where</span><span class="o">=</span><span class="n">and_</span><span class="p">(</span><span class="n">tbl</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">,</span> <span class="n">tbl</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">))</span></pre></div>
</div>
<p>The index will be rendered at create time as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">INDEX</span> <span class="n">test_idx1</span> <span class="n">ON</span> <span class="n">testtbl</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">WHERE</span> <span class="n">data</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="n">AND</span> <span class="n">data</span> <span class="o">&lt;</span> <span class="mi">10</span></pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.9.9.</span></p>
</div>
</div>
<div class="section" id="dotted-column-names">
<span id="sqlite-dotted-column-names"></span><h2>Dotted Column Names<a class="headerlink" href="#dotted-column-names" title="Permalink to this headline">¶</a></h2>
<p>Using table or column names that explicitly have periods in them is
<strong>not recommended</strong>.   While this is generally a bad idea for relational
databases in general, as the dot is a syntactically significant character,
the SQLite driver up until version <strong>3.10.0</strong> of SQLite has a bug which
requires that SQLAlchemy filter out these dots in result sets.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.1: </span>The following SQLite issue has been resolved as of version 3.10.0
of SQLite.  SQLAlchemy as of <strong>1.1</strong> automatically disables its internal
workarounds based on detection of this version.</p>
</div>
<p>The bug, entirely outside of SQLAlchemy, can be illustrated thusly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>

<span class="k">assert</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">sqlite_version_info</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;bug is fixed in this version&quot;</span>

<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;:memory:&quot;</span><span class="p">)</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;create table x (a integer, b integer)&quot;</span><span class="p">)</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;insert into x (a, b) values (1, 1)&quot;</span><span class="p">)</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;insert into x (a, b) values (2, 2)&quot;</span><span class="p">)</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;select x.a, x.b from x&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    select x.a, x.b from x where a=1</span>
<span class="s1">    union</span>
<span class="s1">    select x.a, x.b from x where a=2</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">],</span> \
    <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">]</span></pre></div>
</div>
<p>The second assertion fails:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">&quot;test.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">19</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
    <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">]</span>
<span class="ne">AssertionError</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;x.a&#39;</span><span class="p">,</span> <span class="s1">&#39;x.b&#39;</span><span class="p">]</span></pre></div>
</div>
<p>Where above, the driver incorrectly reports the names of the columns
including the name of the table, which is entirely inconsistent vs.
when the UNION is not present.</p>
<p>SQLAlchemy relies upon column names being predictable in how they match
to the original statement, so the SQLAlchemy dialect has no choice but
to filter these out:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="k">import</span> <span class="n">create_engine</span>

<span class="n">eng</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite://&quot;</span><span class="p">)</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">eng</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;create table x (a integer, b integer)&quot;</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;insert into x (a, b) values (1, 1)&quot;</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;insert into x (a, b) values (2, 2)&quot;</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;select x.a, x.b from x&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">]</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    select x.a, x.b from x where a=1</span>
<span class="s1">    union</span>
<span class="s1">    select x.a, x.b from x where a=2</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">]</span></pre></div>
</div>
<p>Note that above, even though SQLAlchemy filters out the dots, <em>both
names are still addressable</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">row</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;x.a&quot;</span><span class="p">]</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">]</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;x.b&quot;</span><span class="p">]</span>
<span class="go">1</span></pre></div>
</div>
<p>Therefore, the workaround applied by SQLAlchemy only impacts
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.ResultProxy.keys" title="sqlalchemy.engine.ResultProxy.keys"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ResultProxy.keys()</span></code></a> and <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.RowProxy.keys" title="sqlalchemy.engine.RowProxy.keys"><code class="xref py py-meth docutils literal notranslate"><span class="pre">RowProxy.keys()</span></code></a>
in the public API. In
the very specific case where an application is forced to use column names that
contain dots, and the functionality of <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.ResultProxy.keys" title="sqlalchemy.engine.ResultProxy.keys"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ResultProxy.keys()</span></code></a> and
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.RowProxy.keys" title="sqlalchemy.engine.RowProxy.keys"><code class="xref py py-meth docutils literal notranslate"><span class="pre">RowProxy.keys()</span></code></a> is required to return these dotted names unmodified,
the <code class="docutils literal notranslate"><span class="pre">sqlite_raw_colnames</span></code> execution option may be provided, either on a
per-<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> basis:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">sqlite_raw_colnames</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    select x.a, x.b from x where a=1</span>
<span class="s1">    union</span>
<span class="s1">    select x.a, x.b from x where a=2</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;x.a&quot;</span><span class="p">,</span> <span class="s2">&quot;x.b&quot;</span><span class="p">]</span></pre></div>
</div>
<p>or on a per-<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> basis:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite://&quot;</span><span class="p">,</span> <span class="n">execution_options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;sqlite_raw_colnames&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span></pre></div>
</div>
<p>When using the per-<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> execution option, note that
<strong>Core and ORM queries that use UNION may not function properly</strong>.</p>
</div>
<div class="section" id="sqlite-data-types">
<h2>SQLite Data Types<a class="headerlink" href="#sqlite-data-types" title="Permalink to this headline">¶</a></h2>
<p>As with all SQLAlchemy dialects, all UPPERCASE types that are known to be
valid with SQLite are importable from the top level dialect, whether
they originate from <a class="reference internal" href="../core/type_basics.html#module-sqlalchemy.types" title="sqlalchemy.types"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sqlalchemy.types</span></code></a> or from the local dialect:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.dialects.sqlite</span> <span class="k">import</span> \
            <span class="n">BLOB</span><span class="p">,</span> <span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">CHAR</span><span class="p">,</span> <span class="n">DATE</span><span class="p">,</span> <span class="n">DATETIME</span><span class="p">,</span> <span class="n">DECIMAL</span><span class="p">,</span> <span class="n">FLOAT</span><span class="p">,</span> \
            <span class="n">INTEGER</span><span class="p">,</span> <span class="n">NUMERIC</span><span class="p">,</span> <span class="n">JSON</span><span class="p">,</span> <span class="n">SMALLINT</span><span class="p">,</span> <span class="n">TEXT</span><span class="p">,</span> <span class="n">TIME</span><span class="p">,</span> <span class="n">TIMESTAMP</span><span class="p">,</span> \
            <span class="n">VARCHAR</span></pre></div>
</div>
<span class="target" id="module-sqlalchemy.dialects.sqlite"></span><dl class="py class">
<dt id="sqlalchemy.dialects.sqlite.DATETIME">
<em class="property">class </em><code class="sig-prename descclassname">sqlalchemy.dialects.sqlite.</code><code class="sig-name descname">DATETIME</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.sqlite.DATETIME" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.sqlite.base._DateTimeMixin</span></code>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.DateTime" title="sqlalchemy.types.DateTime"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.DateTime</span></code></a></p>
<p>Represent a Python datetime object in SQLite using a string.</p>
<p>The default string storage format is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;</span><span class="si">%(year)04d</span><span class="s2">-</span><span class="si">%(month)02d</span><span class="s2">-</span><span class="si">%(day)02d</span><span class="s2"> </span><span class="si">%(hour)02d</span><span class="s2">:</span><span class="si">%(minute)02d</span><span class="s2">:</span><span class="si">%(second)02d</span><span class="s2">.</span><span class="si">%(microsecond)06d</span><span class="s2">&quot;</span></pre></div>
</div>
<p>e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2011</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mf">57.10558</span></pre></div>
</div>
<p>The storage format can be customized to some degree using the
<code class="docutils literal notranslate"><span class="pre">storage_format</span></code> and <code class="docutils literal notranslate"><span class="pre">regexp</span></code> parameters, such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.dialects.sqlite</span> <span class="k">import</span> <span class="n">DATETIME</span>

<span class="n">dt</span> <span class="o">=</span> <span class="n">DATETIME</span><span class="p">(</span><span class="n">storage_format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(year)04d</span><span class="s2">/</span><span class="si">%(month)02d</span><span class="s2">/</span><span class="si">%(day)02d</span><span class="s2"> &quot;</span>
                             <span class="s2">&quot;</span><span class="si">%(hour)02d</span><span class="s2">:</span><span class="si">%(minute)02d</span><span class="s2">:</span><span class="si">%(second)02d</span><span class="s2">&quot;</span><span class="p">,</span>
              <span class="n">regexp</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;(\d+)/(\d+)/(\d+) (\d+)-(\d+)-(\d+)&quot;</span>
<span class="p">)</span></pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.sqlite.DATETIME.params.storage_format"></span><strong>storage_format</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.sqlite.DATETIME.params.storage_format">¶</a> – format string which will be applied to the dict
with keys year, month, day, hour, minute, second, and microsecond.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.sqlite.DATETIME.params.regexp"></span><strong>regexp</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.sqlite.DATETIME.params.regexp">¶</a> – regular expression which will be applied to incoming result
rows. If the regexp contains named groups, the resulting match dict is
applied to the Python datetime() constructor as keyword arguments.
Otherwise, if positional groups are used, the datetime() constructor
is called with positional arguments via
<code class="docutils literal notranslate"><span class="pre">*map(int,</span> <span class="pre">match_obj.groups(0))</span></code>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt id="sqlalchemy.dialects.sqlite.DATE">
<em class="property">class </em><code class="sig-prename descclassname">sqlalchemy.dialects.sqlite.</code><code class="sig-name descname">DATE</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">storage_format</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">regexp</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kw</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.sqlite.DATE" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.sqlite.base._DateTimeMixin</span></code>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Date" title="sqlalchemy.types.Date"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.Date</span></code></a></p>
<p>Represent a Python date object in SQLite using a string.</p>
<p>The default string storage format is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;</span><span class="si">%(year)04d</span><span class="s2">-</span><span class="si">%(month)02d</span><span class="s2">-</span><span class="si">%(day)02d</span><span class="s2">&quot;</span></pre></div>
</div>
<p>e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2011</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">15</span></pre></div>
</div>
<p>The storage format can be customized to some degree using the
<code class="docutils literal notranslate"><span class="pre">storage_format</span></code> and <code class="docutils literal notranslate"><span class="pre">regexp</span></code> parameters, such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.dialects.sqlite</span> <span class="k">import</span> <span class="n">DATE</span>

<span class="n">d</span> <span class="o">=</span> <span class="n">DATE</span><span class="p">(</span>
        <span class="n">storage_format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(month)02d</span><span class="s2">/</span><span class="si">%(day)02d</span><span class="s2">/</span><span class="si">%(year)04d</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">regexp</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;(?P&lt;month&gt;\d+)/(?P&lt;day&gt;\d+)/(?P&lt;year&gt;\d+)&quot;</span><span class="p">)</span>
    <span class="p">)</span></pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.sqlite.DATE.params.storage_format"></span><strong>storage_format</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.sqlite.DATE.params.storage_format">¶</a> – format string which will be applied to the
dict with keys year, month, and day.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.sqlite.DATE.params.regexp"></span><strong>regexp</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.sqlite.DATE.params.regexp">¶</a> – regular expression which will be applied to
incoming result rows. If the regexp contains named groups, the
resulting match dict is applied to the Python date() constructor
as keyword arguments. Otherwise, if positional groups are used, the
date() constructor is called with positional arguments via
<code class="docutils literal notranslate"><span class="pre">*map(int,</span> <span class="pre">match_obj.groups(0))</span></code>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt id="sqlalchemy.dialects.sqlite.JSON">
<em class="property">class </em><code class="sig-prename descclassname">sqlalchemy.dialects.sqlite.</code><code class="sig-name descname">JSON</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">none_as_null</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.sqlite.JSON" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.JSON</span></code></a></p>
<p>SQLite JSON type.</p>
<p>SQLite supports JSON as of version 3.9 through its <a class="reference external" href="https://www.sqlite.org/json1.html">JSON1</a> extension. Note
that <a class="reference external" href="https://www.sqlite.org/json1.html">JSON1</a> is a
<a class="reference external" href="https://www.sqlite.org/loadext.html">loadable extension</a> and as such
may not be available, or may require run-time loading.</p>
<p>The <a class="reference internal" href="#sqlalchemy.dialects.sqlite.JSON" title="sqlalchemy.dialects.sqlite.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a> type supports persistence of JSON values
as well as the core index operations provided by <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a>
datatype, by adapting the operations to render the <code class="docutils literal notranslate"><span class="pre">JSON_EXTRACT</span></code>
function wrapped in the <code class="docutils literal notranslate"><span class="pre">JSON_QUOTE</span></code> function at the database level.
Extracted values are quoted in order to ensure that the results are
always JSON string values.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.3.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://www.sqlite.org/json1.html">JSON1</a></p>
</div>
</dd></dl>

<dl class="py class">
<dt id="sqlalchemy.dialects.sqlite.TIME">
<em class="property">class </em><code class="sig-prename descclassname">sqlalchemy.dialects.sqlite.</code><code class="sig-name descname">TIME</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.sqlite.TIME" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.sqlite.base._DateTimeMixin</span></code>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Time" title="sqlalchemy.types.Time"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.Time</span></code></a></p>
<p>Represent a Python time object in SQLite using a string.</p>
<p>The default string storage format is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;</span><span class="si">%(hour)02d</span><span class="s2">:</span><span class="si">%(minute)02d</span><span class="s2">:</span><span class="si">%(second)02d</span><span class="s2">.</span><span class="si">%(microsecond)06d</span><span class="s2">&quot;</span></pre></div>
</div>
<p>e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">12</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mf">57.10558</span></pre></div>
</div>
<p>The storage format can be customized to some degree using the
<code class="docutils literal notranslate"><span class="pre">storage_format</span></code> and <code class="docutils literal notranslate"><span class="pre">regexp</span></code> parameters, such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.dialects.sqlite</span> <span class="k">import</span> <span class="n">TIME</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">TIME</span><span class="p">(</span><span class="n">storage_format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(hour)02d</span><span class="s2">-</span><span class="si">%(minute)02d</span><span class="s2">-&quot;</span>
                        <span class="s2">&quot;</span><span class="si">%(second)02d</span><span class="s2">-</span><span class="si">%(microsecond)06d</span><span class="s2">&quot;</span><span class="p">,</span>
         <span class="n">regexp</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;(\d+)-(\d+)-(\d+)-(?:-(\d+))?&quot;</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.sqlite.TIME.params.storage_format"></span><strong>storage_format</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.sqlite.TIME.params.storage_format">¶</a> – format string which will be applied to the dict
with keys hour, minute, second, and microsecond.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.sqlite.TIME.params.regexp"></span><strong>regexp</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.sqlite.TIME.params.regexp">¶</a> – regular expression which will be applied to incoming result
rows. If the regexp contains named groups, the resulting match dict is
applied to the Python time() constructor as keyword arguments. Otherwise,
if positional groups are used, the time() constructor is called with
positional arguments via <code class="docutils literal notranslate"><span class="pre">*map(int,</span> <span class="pre">match_obj.groups(0))</span></code>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-sqlalchemy.dialects.sqlite.pysqlite">
<span id="pysqlite"></span><h2>Pysqlite<a class="headerlink" href="#module-sqlalchemy.dialects.sqlite.pysqlite" title="Permalink to this headline">¶</a></h2>
<p>Support for the SQLite database via the pysqlite driver.<p>Note that <code class="docutils literal notranslate"><span class="pre">pysqlite</span></code> is the same driver as the <code class="docutils literal notranslate"><span class="pre">sqlite3</span></code>
module included with the Python distribution.</p>
</p>
<div class="section" id="dialect-sqlite-pysqlite-url">
<h3>DBAPI<a class="headerlink" href="#dialect-sqlite-pysqlite-url" title="Permalink to this headline">¶</a></h3>
<p>Documentation and download information (if applicable) for pysqlite is available at:
<a class="reference external" href="http://docs.python.org/library/sqlite3.html">http://docs.python.org/library/sqlite3.html</a></p>
</div>
<div class="section" id="dialect-sqlite-pysqlite-connect">
<h3>Connecting<a class="headerlink" href="#dialect-sqlite-pysqlite-connect" title="Permalink to this headline">¶</a></h3>
<p>Connect String:<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sqlite</span><span class="o">+</span><span class="n">pysqlite</span><span class="p">:</span><span class="o">///</span><span class="n">file_path</span></pre></div>
</div>
</p>
</div>
<div class="section" id="driver">
<h3>Driver<a class="headerlink" href="#driver" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">sqlite3</span></code> Python DBAPI is standard on all modern Python versions;
for cPython and Pypy, no additional installation is necessary.</p>
</div>
<div class="section" id="connect-strings">
<h3>Connect Strings<a class="headerlink" href="#connect-strings" title="Permalink to this headline">¶</a></h3>
<p>The file specification for the SQLite database is taken as the “database”
portion of the URL.  Note that the format of a SQLAlchemy url is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">driver</span><span class="p">:</span><span class="o">//</span><span class="n">user</span><span class="p">:</span><span class="k">pass</span><span class="nd">@host</span><span class="o">/</span><span class="n">database</span></pre></div>
</div>
<p>This means that the actual filename to be used starts with the characters to
the <strong>right</strong> of the third slash.   So connecting to a relative filepath
looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># relative path</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;sqlite:///path/to/database.db&#39;</span><span class="p">)</span></pre></div>
</div>
<p>An absolute path, which is denoted by starting with a slash, means you
need <strong>four</strong> slashes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># absolute path</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;sqlite:////path/to/database.db&#39;</span><span class="p">)</span></pre></div>
</div>
<p>To use a Windows path, regular drive specifications and backslashes can be
used. Double backslashes are probably needed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># absolute path on Windows</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;sqlite:///C:</span><span class="se">\\</span><span class="s1">path</span><span class="se">\\</span><span class="s1">to</span><span class="se">\\</span><span class="s1">database.db&#39;</span><span class="p">)</span></pre></div>
</div>
<p>The sqlite <code class="docutils literal notranslate"><span class="pre">:memory:</span></code> identifier is the default if no filepath is
present.  Specify <code class="docutils literal notranslate"><span class="pre">sqlite://</span></code> and nothing else:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># in-memory database</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;sqlite://&#39;</span><span class="p">)</span></pre></div>
</div>
<div class="section" id="uri-connections">
<span id="pysqlite-uri-connections"></span><h4>URI Connections<a class="headerlink" href="#uri-connections" title="Permalink to this headline">¶</a></h4>
<p>Modern versions of SQLite support an alternative system of connecting using a
<a class="reference external" href="https://www.sqlite.org/uri.html">driver level URI</a>, which has the  advantage
that additional driver-level arguments can be passed including options such as
“read only”.   The Python sqlite3 driver supports this mode under modern Python
3 versions.   The SQLAlchemy pysqlite driver supports this mode of use by
specifing “uri=true” in the URL query string.  The SQLite-level “URI” is kept
as the “database” portion of the SQLAlchemy url (that is, following a slash):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite:///file:path/to/database?mode=ro&amp;uri=true&quot;</span><span class="p">)</span></pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The “uri=true” parameter must appear in the <strong>query string</strong>
of the URL.  It will not currently work as expected if it is only
present in the <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.connect_args" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.connect_args</span></code></a>
parameter dictionary.</p>
</div>
<p>The logic reconciles the simultaneous presence of SQLAlchemy’s query string and
SQLite’s query string by separating out the parameters that belong to the
Python sqlite3 driver vs. those that belong to the SQLite URI.  This is
achieved through the use of a fixed list of parameters known to be accepted by
the Python side of the driver.  For example, to include a URL that indicates
the Python sqlite3 “timeout” and “check_same_thread” parameters, along with the
SQLite “mode” and “nolock” parameters, they can all be passed together on the
query string:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;sqlite:///file:path/to/database?&quot;</span>
    <span class="s2">&quot;check_same_thread=true&amp;timeout=10&amp;mode=ro&amp;nolock=1&amp;uri=true&quot;</span>
<span class="p">)</span></pre></div>
</div>
<p>Above, the pysqlite / sqlite3 DBAPI would be passed arguments as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
    <span class="s2">&quot;file:path/to/database?mode=ro&amp;nolock=1&quot;</span><span class="p">,</span>
    <span class="n">check_same_thread</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">uri</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span></pre></div>
</div>
<p>Regarding future parameters added to either the Python or native drivers. new
parameter names added to the SQLite URI scheme should be automatically
accommodated by this scheme.  New parameter names added to the Python driver
side can be accommodated by specifying them in the
<a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.connect_args" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.connect_args</span></code></a> dictionary,
until dialect support is
added by SQLAlchemy.   For the less likely case that the native SQLite driver
adds a new parameter name that overlaps with one of the existing, known Python
driver parameters (such as “timeout” perhaps), SQLAlchemy’s dialect would
require adjustment for the URL scheme to continue to support this.</p>
<p>As is always the case for all SQLAlchemy dialects, the entire “URL” process
can be bypassed in <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a> through the use of the
<a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.creator" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.creator</span></code></a>
parameter which allows for a custom callable
that creates a Python sqlite3 driver level connection directly.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.3.9.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://www.sqlite.org/uri.html">Uniform Resource Identifiers</a> - in
the SQLite documentation</p>
</div>
</div>
</div>
<div class="section" id="compatibility-with-sqlite3-native-date-and-datetime-types">
<h3>Compatibility with sqlite3 “native” date and datetime types<a class="headerlink" href="#compatibility-with-sqlite3-native-date-and-datetime-types" title="Permalink to this headline">¶</a></h3>
<p>The pysqlite driver includes the sqlite3.PARSE_DECLTYPES and
sqlite3.PARSE_COLNAMES options, which have the effect of any column
or expression explicitly cast as “date” or “timestamp” will be converted
to a Python date or datetime object.  The date and datetime types provided
with the pysqlite dialect are not currently compatible with these options,
since they render the ISO date/datetime including microseconds, which
pysqlite’s driver does not.   Additionally, SQLAlchemy does not at
this time automatically render the “cast” syntax required for the
freestanding functions “current_timestamp” and “current_date” to return
datetime/date types natively.   Unfortunately, pysqlite
does not provide the standard DBAPI types in <code class="docutils literal notranslate"><span class="pre">cursor.description</span></code>,
leaving SQLAlchemy with no way to detect these types on the fly
without expensive per-row type checks.</p>
<p>Keeping in mind that pysqlite’s parsing option is not recommended,
nor should be necessary, for use with SQLAlchemy, usage of PARSE_DECLTYPES
can be forced if one configures “native_datetime=True” on create_engine():</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;sqlite://&#39;</span><span class="p">,</span>
    <span class="n">connect_args</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;detect_types&#39;</span><span class="p">:</span>
        <span class="n">sqlite3</span><span class="o">.</span><span class="n">PARSE_DECLTYPES</span><span class="o">|</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">PARSE_COLNAMES</span><span class="p">},</span>
    <span class="n">native_datetime</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span></pre></div>
</div>
<p>With this flag enabled, the DATE and TIMESTAMP types (but note - not the
DATETIME or TIME types…confused yet ?) will not perform any bind parameter
or result processing. Execution of “func.current_date()” will return a string.
“func.current_timestamp()” is registered as returning a DATETIME type in
SQLAlchemy, so this function still receives SQLAlchemy-level result
processing.</p>
</div>
<div class="section" id="threading-pooling-behavior">
<span id="pysqlite-threading-pooling"></span><h3>Threading/Pooling Behavior<a class="headerlink" href="#threading-pooling-behavior" title="Permalink to this headline">¶</a></h3>
<p>Pysqlite’s default behavior is to prohibit the usage of a single connection
in more than one thread.   This is originally intended to work with older
versions of SQLite that did not support multithreaded operation under
various circumstances.  In particular, older SQLite versions
did not allow a <code class="docutils literal notranslate"><span class="pre">:memory:</span></code> database to be used in multiple threads
under any circumstances.</p>
<p>Pysqlite does include a now-undocumented flag known as
<code class="docutils literal notranslate"><span class="pre">check_same_thread</span></code> which will disable this check, however note that
pysqlite connections are still not safe to use in concurrently in multiple
threads.  In particular, any statement execution calls would need to be
externally mutexed, as Pysqlite does not provide for thread-safe propagation
of error messages among other things.   So while even <code class="docutils literal notranslate"><span class="pre">:memory:</span></code> databases
can be shared among threads in modern SQLite, Pysqlite doesn’t provide enough
thread-safety to make this usage worth it.</p>
<p>SQLAlchemy sets up pooling to work with Pysqlite’s default behavior:</p>
<ul class="simple">
<li><p>When a <code class="docutils literal notranslate"><span class="pre">:memory:</span></code> SQLite database is specified, the dialect by default
will use <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.SingletonThreadPool" title="sqlalchemy.pool.SingletonThreadPool"><code class="xref py py-class docutils literal notranslate"><span class="pre">SingletonThreadPool</span></code></a>. This pool maintains a single
connection per thread, so that all access to the engine within the current
thread use the same <code class="docutils literal notranslate"><span class="pre">:memory:</span></code> database - other threads would access a
different <code class="docutils literal notranslate"><span class="pre">:memory:</span></code> database.</p></li>
<li><p>When a file-based database is specified, the dialect will use
<a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.NullPool" title="sqlalchemy.pool.NullPool"><code class="xref py py-class docutils literal notranslate"><span class="pre">NullPool</span></code></a> as the source of connections. This pool closes and
discards connections which are returned to the pool immediately. SQLite
file-based connections have extremely low overhead, so pooling is not
necessary. The scheme also prevents a connection from being used again in
a different thread and works best with SQLite’s coarse-grained file locking.</p></li>
</ul>
<div class="section" id="using-a-memory-database-in-multiple-threads">
<h4>Using a Memory Database in Multiple Threads<a class="headerlink" href="#using-a-memory-database-in-multiple-threads" title="Permalink to this headline">¶</a></h4>
<p>To use a <code class="docutils literal notranslate"><span class="pre">:memory:</span></code> database in a multithreaded scenario, the same
connection object must be shared among threads, since the database exists
only within the scope of that connection.   The
<a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.StaticPool" title="sqlalchemy.pool.StaticPool"><code class="xref py py-class docutils literal notranslate"><span class="pre">StaticPool</span></code></a> implementation will maintain a single connection
globally, and the <code class="docutils literal notranslate"><span class="pre">check_same_thread</span></code> flag can be passed to Pysqlite
as <code class="docutils literal notranslate"><span class="pre">False</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.pool</span> <span class="k">import</span> <span class="n">StaticPool</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;sqlite://&#39;</span><span class="p">,</span>
                    <span class="n">connect_args</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;check_same_thread&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">},</span>
                    <span class="n">poolclass</span><span class="o">=</span><span class="n">StaticPool</span><span class="p">)</span></pre></div>
</div>
<p>Note that using a <code class="docutils literal notranslate"><span class="pre">:memory:</span></code> database in multiple threads requires a recent
version of SQLite.</p>
</div>
<div class="section" id="using-temporary-tables-with-sqlite">
<h4>Using Temporary Tables with SQLite<a class="headerlink" href="#using-temporary-tables-with-sqlite" title="Permalink to this headline">¶</a></h4>
<p>Due to the way SQLite deals with temporary tables, if you wish to use a
temporary table in a file-based SQLite database across multiple checkouts
from the connection pool, such as when using an ORM <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> where
the temporary table should continue to remain after <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.session.Session.commit" title="sqlalchemy.orm.session.Session.commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.commit()</span></code></a> or
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.session.Session.rollback" title="sqlalchemy.orm.session.Session.rollback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.rollback()</span></code></a> is called, a pool which maintains a single
connection must be used.   Use <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.SingletonThreadPool" title="sqlalchemy.pool.SingletonThreadPool"><code class="xref py py-class docutils literal notranslate"><span class="pre">SingletonThreadPool</span></code></a> if the scope is
only needed within the current thread, or <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.StaticPool" title="sqlalchemy.pool.StaticPool"><code class="xref py py-class docutils literal notranslate"><span class="pre">StaticPool</span></code></a> is scope is
needed within multiple threads for this case:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># maintain the same connection per thread</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.pool</span> <span class="k">import</span> <span class="n">SingletonThreadPool</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;sqlite:///mydb.db&#39;</span><span class="p">,</span>
                    <span class="n">poolclass</span><span class="o">=</span><span class="n">SingletonThreadPool</span><span class="p">)</span>


<span class="c1"># maintain the same connection across all threads</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.pool</span> <span class="k">import</span> <span class="n">StaticPool</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;sqlite:///mydb.db&#39;</span><span class="p">,</span>
                    <span class="n">poolclass</span><span class="o">=</span><span class="n">StaticPool</span><span class="p">)</span></pre></div>
</div>
<p>Note that <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.SingletonThreadPool" title="sqlalchemy.pool.SingletonThreadPool"><code class="xref py py-class docutils literal notranslate"><span class="pre">SingletonThreadPool</span></code></a> should be configured for the number
of threads that are to be used; beyond that number, connections will be
closed out in a non deterministic way.</p>
</div>
</div>
<div class="section" id="unicode">
<h3>Unicode<a class="headerlink" href="#unicode" title="Permalink to this headline">¶</a></h3>
<p>The pysqlite driver only returns Python <code class="docutils literal notranslate"><span class="pre">unicode</span></code> objects in result sets,
never plain strings, and accommodates <code class="docutils literal notranslate"><span class="pre">unicode</span></code> objects within bound
parameter values in all cases.   Regardless of the SQLAlchemy string type in
use, string-based result values will by Python <code class="docutils literal notranslate"><span class="pre">unicode</span></code> in Python 2.
The <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Unicode" title="sqlalchemy.types.Unicode"><code class="xref py py-class docutils literal notranslate"><span class="pre">Unicode</span></code></a> type should still be used to indicate those columns that
require unicode, however, so that non-<code class="docutils literal notranslate"><span class="pre">unicode</span></code> values passed inadvertently
will emit a warning.  Pysqlite will emit an error if a non-<code class="docutils literal notranslate"><span class="pre">unicode</span></code> string
is passed containing non-ASCII characters.</p>
</div>
<div class="section" id="dealing-with-mixed-string-binary-columns-in-python-3">
<h3>Dealing with Mixed String / Binary Columns in Python 3<a class="headerlink" href="#dealing-with-mixed-string-binary-columns-in-python-3" title="Permalink to this headline">¶</a></h3>
<p>The SQLite database is weakly typed, and as such it is possible when using
binary values, which in Python 3 are represented as <code class="docutils literal notranslate"><span class="pre">b'some</span> <span class="pre">string'</span></code>, that a
particular SQLite database can have data values within different rows where
some of them will be returned as a <code class="docutils literal notranslate"><span class="pre">b''</span></code> value by the Pysqlite driver, and
others will be returned as Python strings, e.g. <code class="docutils literal notranslate"><span class="pre">''</span></code> values.   This situation
is not known to occur if the SQLAlchemy <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.LargeBinary" title="sqlalchemy.types.LargeBinary"><code class="xref py py-class docutils literal notranslate"><span class="pre">LargeBinary</span></code></a> datatype is used
consistently, however if a particular SQLite database has data that was
inserted using the Pysqlite driver directly, or when using the SQLAlchemy
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.String" title="sqlalchemy.types.String"><code class="xref py py-class docutils literal notranslate"><span class="pre">String</span></code></a> type which was later changed to <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.LargeBinary" title="sqlalchemy.types.LargeBinary"><code class="xref py py-class docutils literal notranslate"><span class="pre">LargeBinary</span></code></a>, the
table will not be consistently readable because SQLAlchemy’s
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.LargeBinary" title="sqlalchemy.types.LargeBinary"><code class="xref py py-class docutils literal notranslate"><span class="pre">LargeBinary</span></code></a> datatype does not handle strings so it has no way of
“encoding” a value that is in string format.</p>
<p>To deal with a SQLite table that has mixed string / binary data in the
same column, use a custom type that will check each row individually:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># note this is Python 3 only</span>

<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="k">import</span> <span class="n">String</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="k">import</span> <span class="n">TypeDecorator</span>

<span class="k">class</span> <span class="nc">MixedBinary</span><span class="p">(</span><span class="n">TypeDecorator</span><span class="p">):</span>
    <span class="n">impl</span> <span class="o">=</span> <span class="n">String</span>

    <span class="k">def</span> <span class="nf">process_result_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dialect</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">value</span></pre></div>
</div>
<p>Then use the above <code class="docutils literal notranslate"><span class="pre">MixedBinary</span></code> datatype in the place where
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.LargeBinary" title="sqlalchemy.types.LargeBinary"><code class="xref py py-class docutils literal notranslate"><span class="pre">LargeBinary</span></code></a> would normally be used.</p>
</div>
<div class="section" id="serializable-isolation-savepoints-transactional-ddl">
<span id="pysqlite-serializable"></span><h3>Serializable isolation / Savepoints / Transactional DDL<a class="headerlink" href="#serializable-isolation-savepoints-transactional-ddl" title="Permalink to this headline">¶</a></h3>
<p>In the section <a class="reference internal" href="#sqlite-concurrency"><span class="std std-ref">Database Locking Behavior / Concurrency</span></a>, we refer to the pysqlite
driver’s assortment of issues that prevent several features of SQLite
from working correctly.  The pysqlite DBAPI driver has several
long-standing bugs which impact the correctness of its transactional
behavior.   In its default mode of operation, SQLite features such as
SERIALIZABLE isolation, transactional DDL, and SAVEPOINT support are
non-functional, and in order to use these features, workarounds must
be taken.</p>
<p>The issue is essentially that the driver attempts to second-guess the user’s
intent, failing to start transactions and sometimes ending them prematurely, in
an effort to minimize the SQLite databases’s file locking behavior, even
though SQLite itself uses “shared” locks for read-only activities.</p>
<p>SQLAlchemy chooses to not alter this behavior by default, as it is the
long-expected behavior of the pysqlite driver; if and when the pysqlite
driver attempts to repair these issues, that will be more of a driver towards
defaults for SQLAlchemy.</p>
<p>The good news is that with a few events, we can implement transactional
support fully, by disabling pysqlite’s feature entirely and emitting BEGIN
ourselves. This is achieved using two event listeners:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="k">import</span> <span class="n">create_engine</span><span class="p">,</span> <span class="n">event</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite:///myfile.db&quot;</span><span class="p">)</span>

<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="s2">&quot;connect&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">do_connect</span><span class="p">(</span><span class="n">dbapi_connection</span><span class="p">,</span> <span class="n">connection_record</span><span class="p">):</span>
    <span class="c1"># disable pysqlite&#39;s emitting of the BEGIN statement entirely.</span>
    <span class="c1"># also stops it from emitting COMMIT before any DDL.</span>
    <span class="n">dbapi_connection</span><span class="o">.</span><span class="n">isolation_level</span> <span class="o">=</span> <span class="kc">None</span>

<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="s2">&quot;begin&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">do_begin</span><span class="p">(</span><span class="n">conn</span><span class="p">):</span>
    <span class="c1"># emit our own BEGIN</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;BEGIN&quot;</span><span class="p">)</span></pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When using the above recipe, it is advised to not use the
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.execution_options.params.isolation_level" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.isolation_level</span></code></a> setting on
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> and <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a>
with the SQLite driver,
as this function necessarily will also alter the “.isolation_level” setting.</p>
</div>
<p>Above, we intercept a new pysqlite connection and disable any transactional
integration.   Then, at the point at which SQLAlchemy knows that transaction
scope is to begin, we emit <code class="docutils literal notranslate"><span class="pre">&quot;BEGIN&quot;</span></code> ourselves.</p>
<p>When we take control of <code class="docutils literal notranslate"><span class="pre">&quot;BEGIN&quot;</span></code>, we can also control directly SQLite’s
locking modes, introduced at
<a class="reference external" href="http://sqlite.org/lang_transaction.html">BEGIN TRANSACTION</a>,
by adding the desired locking mode to our <code class="docutils literal notranslate"><span class="pre">&quot;BEGIN&quot;</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="s2">&quot;begin&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">do_begin</span><span class="p">(</span><span class="n">conn</span><span class="p">):</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;BEGIN EXCLUSIVE&quot;</span><span class="p">)</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="http://sqlite.org/lang_transaction.html">BEGIN TRANSACTION</a> -
on the SQLite site</p>
<p><a class="reference external" href="http://bugs.python.org/issue9924">sqlite3 SELECT does not BEGIN a transaction</a> -
on the Python bug tracker</p>
<p><a class="reference external" href="http://bugs.python.org/issue10740">sqlite3 module breaks transactions and potentially corrupts data</a> -
on the Python bug tracker</p>
</div>
</div>
</div>
<div class="section" id="module-sqlalchemy.dialects.sqlite.pysqlcipher">
<span id="pysqlcipher"></span><h2>Pysqlcipher<a class="headerlink" href="#module-sqlalchemy.dialects.sqlite.pysqlcipher" title="Permalink to this headline">¶</a></h2>
<p>Support for the SQLite database via the pysqlcipher driver.<p><code class="docutils literal notranslate"><span class="pre">pysqlcipher</span></code> is a fork of the standard <code class="docutils literal notranslate"><span class="pre">pysqlite</span></code> driver to make
use of the <a class="reference external" href="https://www.zetetic.net/sqlcipher">SQLCipher</a> backend.</p>
<p><code class="docutils literal notranslate"><span class="pre">pysqlcipher3</span></code> is a fork of <code class="docutils literal notranslate"><span class="pre">pysqlcipher</span></code> for Python 3. This dialect
will attempt to import it if <code class="docutils literal notranslate"><span class="pre">pysqlcipher</span></code> is non-present.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.1.4: </span>- added fallback import for pysqlcipher3</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.9.9: </span>- added pysqlcipher dialect</p>
</div>
</p>
<div class="section" id="dialect-sqlite-pysqlcipher-url">
<h3>DBAPI<a class="headerlink" href="#dialect-sqlite-pysqlcipher-url" title="Permalink to this headline">¶</a></h3>
<p>Documentation and download information (if applicable) for pysqlcipher is available at:
<a class="reference external" href="https://pypi.python.org/pypi/pysqlcipher">https://pypi.python.org/pypi/pysqlcipher</a></p>
</div>
<div class="section" id="dialect-sqlite-pysqlcipher-connect">
<h3>Connecting<a class="headerlink" href="#dialect-sqlite-pysqlcipher-connect" title="Permalink to this headline">¶</a></h3>
<p>Connect String:<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sqlite+pysqlcipher://:passphrase/file_path[?kdf_iter=&lt;iter&gt;]</pre></div>
</div>
</p>
</div>
<div class="section" id="id3">
<h3>Driver<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>The driver here is the
<a class="reference external" href="https://pypi.python.org/pypi/pysqlcipher">pysqlcipher</a>
driver, which makes use of the SQLCipher engine.  This system essentially
introduces new PRAGMA commands to SQLite which allows the setting of a
passphrase and other encryption parameters, allowing the database
file to be encrypted.</p>
<p><cite>pysqlcipher3</cite> is a fork of <cite>pysqlcipher</cite> with support for Python 3,
the driver is the same.</p>
</div>
<div class="section" id="id5">
<h3>Connect Strings<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>The format of the connect string is in every way the same as that
of the <a class="reference internal" href="#module-sqlalchemy.dialects.sqlite.pysqlite" title="sqlalchemy.dialects.sqlite.pysqlite"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pysqlite</span></code></a> driver, except that the
“password” field is now accepted, which should contain a passphrase:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;sqlite+pysqlcipher://:testing@/foo.db&#39;</span><span class="p">)</span></pre></div>
</div>
<p>For an absolute file path, two leading slashes should be used for the
database name:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;sqlite+pysqlcipher://:testing@//path/to/foo.db&#39;</span><span class="p">)</span></pre></div>
</div>
<p>A selection of additional encryption-related pragmas supported by SQLCipher
as documented at <a class="reference external" href="https://www.zetetic.net/sqlcipher/sqlcipher-api/">https://www.zetetic.net/sqlcipher/sqlcipher-api/</a> can be passed
in the query string, and will result in that PRAGMA being called for each
new connection.  Currently, <code class="docutils literal notranslate"><span class="pre">cipher</span></code>, <code class="docutils literal notranslate"><span class="pre">kdf_iter</span></code>
<code class="docutils literal notranslate"><span class="pre">cipher_page_size</span></code> and <code class="docutils literal notranslate"><span class="pre">cipher_use_hmac</span></code> are supported:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;sqlite+pysqlcipher://:testing@/foo.db?cipher=aes-256-cfb&amp;kdf_iter=64000&#39;</span><span class="p">)</span></pre></div>
</div>
</div>
<div class="section" id="pooling-behavior">
<h3>Pooling Behavior<a class="headerlink" href="#pooling-behavior" title="Permalink to this headline">¶</a></h3>
<p>The driver makes a change to the default pool behavior of pysqlite
as described in <a class="reference internal" href="#pysqlite-threading-pooling"><span class="std std-ref">Threading/Pooling Behavior</span></a>.   The pysqlcipher driver
has been observed to be significantly slower on connection than the
pysqlite driver, most likely due to the encryption overhead, so the
dialect here defaults to using the <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.SingletonThreadPool" title="sqlalchemy.pool.SingletonThreadPool"><code class="xref py py-class docutils literal notranslate"><span class="pre">SingletonThreadPool</span></code></a>
implementation,
instead of the <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.NullPool" title="sqlalchemy.pool.NullPool"><code class="xref py py-class docutils literal notranslate"><span class="pre">NullPool</span></code></a> pool used by pysqlite.  As always, the pool
implementation is entirely configurable using the
<a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.poolclass" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.poolclass</span></code></a> parameter; the <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.StaticPool" title="sqlalchemy.pool.StaticPool"><code class="xref py py-class docutils literal notranslate"><span class="pre">StaticPool</span></code></a>
may
be more feasible for single-threaded use, or <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.NullPool" title="sqlalchemy.pool.NullPool"><code class="xref py py-class docutils literal notranslate"><span class="pre">NullPool</span></code></a> may be used
to prevent unencrypted connections from being held open for long periods of
time, at the expense of slower startup time for new connections.</p>
</div>
</div>
</div>

    </div>

</div>

<div id="docs-bottom-navigation" class="docs-navigation-links, withsidebar">
        Previous:
        <a href="mysql.html" title="previous chapter">MySQL</a>
        Next:
        <a href="oracle.html" title="next chapter">Oracle</a>

    <div id="docs-copyright">
        &copy; <a href="../copyright.html">Copyright</a> 2007-2020, the SQLAlchemy authors and contributors.
        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 3.0.3.
    </div>
</div>

</div>



        
        

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
          URL_ROOT:    '../',
          VERSION:     '1.3.17',
          COLLAPSE_MODINDEX: false,
          FILE_SUFFIX: '.html'
      };
    </script>

    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>

    <!-- begin iterate through sphinx environment script_files -->
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    <!-- end iterate through sphinx environment script_files -->

    <script type="text/javascript" src="../_static/detectmobile.js"></script>
    <script type="text/javascript" src="../_static/init.js"></script>


    </body>
</html>


