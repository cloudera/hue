<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">



<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        
        <title>
            
    
    What’s New in SQLAlchemy 0.8?
 &mdash;
    SQLAlchemy 1.3 Documentation

        </title>

        
            <!-- begin iterate through site-imported + sphinx environment css_files -->
                <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
                <link rel="stylesheet" href="../_static/docs.css" type="text/css" />
                <link rel="stylesheet" href="../_static/changelog.css" type="text/css" />
                <link rel="stylesheet" href="../_static/sphinx_paramlinks.css" type="text/css" />
            <!-- end iterate through site-imported + sphinx environment css_files -->
        

        

    

    <!-- begin layout.mako headers -->

    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
        <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="SQLAlchemy 1.3 Documentation" href="../index.html" />
        <link rel="up" title="Changes and Migration" href="index.html" />
        <link rel="next" title="What’s New in SQLAlchemy 0.7?" href="migration_07.html" />
        <link rel="prev" title="What’s New in SQLAlchemy 0.9?" href="migration_09.html" />
    <!-- end layout.mako headers -->


    </head>
    <body>
        
















<div id="docs-container">





<div id="docs-top-navigation-container" class="body-background">
<div id="docs-header">
    <div id="docs-version-header">
        Release: <span class="version-num">1.3.17</span>


        | Release Date: May 13, 2020

    </div>

    <h1>SQLAlchemy 1.3 Documentation</h1>

</div>
</div>

<div id="docs-body-container">

    <div id="fixed-sidebar" class="withsidebar">


        <div id="docs-sidebar-popout">
            <h3><a href="../index.html">SQLAlchemy 1.3 Documentation</a></h3>
            <p id="sidebar-topnav">
                <a href="../contents.html">Contents</a> |
                <a href="../genindex.html">Index</a>
            </p>

            <div id="sidebar-search">
                <form class="search" action="../search.html" method="get">
                  <label>
                  Search terms:
                  <input type="text" placeholder="search..." name="q" size="12" />
                  </label>
                  <input type="hidden" name="check_keywords" value="yes" />
                  <input type="hidden" name="area" value="default" />
                </form>
            </div>

        </div>

        <div id="docs-sidebar">

        <div id="sidebar-banner">
            
        </div>

        <div id="docs-sidebar-inner">

        
        <h3>
            <a href="index.html" title="Changes and Migration">Changes and Migration</a>
        </h3>

        <ul>
<li><span class="link-container"><a class="reference external" href="migration_13.html">What’s New in SQLAlchemy 1.3?</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_13.html">1.3 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_12.html">1.2 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_11.html">1.1 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_10.html">1.0 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_09.html">0.9 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_08.html">0.8 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_07.html">0.7 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_06.html">0.6 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_05.html">0.5 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_04.html">0.4 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_03.html">0.3 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_02.html">0.2 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_01.html">0.1 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_12.html">What’s New in SQLAlchemy 1.2?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_11.html">What’s New in SQLAlchemy 1.1?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_10.html">What’s New in SQLAlchemy 1.0?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_09.html">What’s New in SQLAlchemy 0.9?</a></span></li>
<li class="selected"><span class="link-container"><strong>What’s New in SQLAlchemy 0.8?</strong><a class="paramlink headerlink reference internal" href="#">¶</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#introduction">Introduction</a></span></li>
<li><span class="link-container"><a class="reference external" href="#platform-support">Platform Support</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#targeting-python-2-5-and-up-now">Targeting Python 2.5 and Up Now</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#new-orm-features">New ORM Features</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#rewritten-orm-relationship-mechanics">Rewritten <code class="xref py py-func docutils literal notranslate"><span class="pre">_orm.relationship()</span></code> mechanics</a></span></li>
<li><span class="link-container"><a class="reference external" href="#new-class-object-inspection-system">New Class/Object Inspection System</a></span></li>
<li><span class="link-container"><a class="reference external" href="#new-with-polymorphic-feature-can-be-used-anywhere">New with_polymorphic() feature, can be used anywhere</a></span></li>
<li><span class="link-container"><a class="reference external" href="#of-type-works-with-alias-with-polymorphic-any-has-joinedload-subqueryload-contains-eager">of_type() works with alias(), with_polymorphic(), any(), has(), joinedload(), subqueryload(), contains_eager()</a></span></li>
<li><span class="link-container"><a class="reference external" href="#events-can-be-applied-to-unmapped-superclasses">Events Can Be Applied to Unmapped Superclasses</a></span></li>
<li><span class="link-container"><a class="reference external" href="#declarative-distinguishes-between-modules-packages">Declarative Distinguishes Between Modules/Packages</a></span></li>
<li><span class="link-container"><a class="reference external" href="#new-deferredreflection-feature-in-declarative">New DeferredReflection Feature in Declarative</a></span></li>
<li><span class="link-container"><a class="reference external" href="#orm-classes-now-accepted-by-core-constructs">ORM Classes Now Accepted by Core Constructs</a></span></li>
<li><span class="link-container"><a class="reference external" href="#query-update-supports-update-from">Query.update() supports UPDATE..FROM</a></span></li>
<li><span class="link-container"><a class="reference external" href="#rollback-will-only-roll-back-dirty-objects-from-a-begin-nested">rollback() will only roll back “dirty” objects from a begin_nested()</a></span></li>
<li><span class="link-container"><a class="reference external" href="#caching-example-now-uses-dogpile-cache">Caching Example now uses dogpile.cache</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#new-core-features">New Core Features</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#fully-extensible-type-level-operator-support-in-core">Fully extensible, type-level operator support in Core</a></span></li>
<li><span class="link-container"><a class="reference external" href="#multiple-values-support-for-insert">Multiple-VALUES support for Insert</a></span></li>
<li><span class="link-container"><a class="reference external" href="#type-expressions">Type Expressions</a></span></li>
<li><span class="link-container"><a class="reference external" href="#core-inspection-system">Core Inspection System</a></span></li>
<li><span class="link-container"><a class="reference external" href="#new-method-expression-select-correlate-except">New Method <code class="xref py py-meth docutils literal notranslate"><span class="pre">_expression.Select.correlate_except()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#postgresql-hstore-type">PostgreSQL HSTORE type</a></span></li>
<li><span class="link-container"><a class="reference external" href="#enhanced-postgresql-array-type">Enhanced PostgreSQL ARRAY type</a></span></li>
<li><span class="link-container"><a class="reference external" href="#new-configurable-date-time-types-for-sqlite">New, configurable DATE, TIME types for SQLite</a></span></li>
<li><span class="link-container"><a class="reference external" href="#collate-supported-across-all-dialects-in-particular-mysql-postgresql-sqlite">“COLLATE” supported across all dialects; in particular MySQL, PostgreSQL, SQLite</a></span></li>
<li><span class="link-container"><a class="reference external" href="#prefixes-now-supported-for-expression-update-expression-delete">“Prefixes” now supported for <code class="xref py py-func docutils literal notranslate"><span class="pre">_expression.update()</span></code>, <code class="xref py py-func docutils literal notranslate"><span class="pre">_expression.delete()</span></code></a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#behavioral-changes">Behavioral Changes</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#the-consideration-of-a-pending-object-as-an-orphan-has-been-made-more-aggressive">The consideration of a “pending” object as an “orphan” has been made more aggressive</a></span></li>
<li><span class="link-container"><a class="reference external" href="#the-after-attach-event-fires-after-the-item-is-associated-with-the-session-instead-of-before-before-attach-added">The after_attach event fires after the item is associated with the Session instead of before; before_attach added</a></span></li>
<li><span class="link-container"><a class="reference external" href="#query-now-auto-correlates-like-a-select-does">Query now auto-correlates like a select() does</a></span></li>
<li><span class="link-container"><a class="reference external" href="#correlation-is-now-always-context-specific">Correlation is now always context-specific</a></span></li>
<li><span class="link-container"><a class="reference external" href="#create-all-and-drop-all-will-now-honor-an-empty-list-as-such">create_all() and drop_all() will now honor an empty list as such</a></span></li>
<li><span class="link-container"><a class="reference external" href="#repaired-the-event-targeting-of-instrumentationevents">Repaired the Event Targeting of <code class="xref py py-class docutils literal notranslate"><span class="pre">InstrumentationEvents</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#no-more-magic-coercion-of-to-in-when-comparing-to-subquery-in-ms-sql">No more magic coercion of “=” to IN when comparing to subquery in MS-SQL</a></span></li>
<li><span class="link-container"><a class="reference external" href="#fixed-the-behavior-of-session-is-modified">Fixed the behavior of <code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.is_modified()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#schema-column-key-is-honored-in-the-expression-select-c-attribute-of-expression-select-with-expression-select-apply-labels"><code class="xref py py-attr docutils literal notranslate"><span class="pre">_schema.Column.key</span></code> is honored in the <code class="xref py py-attr docutils literal notranslate"><span class="pre">_expression.Select.c</span></code> attribute of <code class="xref py py-func docutils literal notranslate"><span class="pre">_expression.select()</span></code> with <code class="xref py py-meth docutils literal notranslate"><span class="pre">_expression.Select.apply_labels()</span></code></a></span></li>
<li><span class="link-container"><a class="reference external" href="#single-parent-warning-is-now-an-error">single_parent warning is now an error</a></span></li>
<li><span class="link-container"><a class="reference external" href="#adding-the-inspector-argument-to-the-column-reflect-event">Adding the <code class="docutils literal notranslate"><span class="pre">inspector</span></code> argument to the <code class="docutils literal notranslate"><span class="pre">column_reflect</span></code> event</a></span></li>
<li><span class="link-container"><a class="reference external" href="#disabling-auto-detect-of-collations-casing-for-mysql">Disabling auto-detect of collations, casing for MySQL</a></span></li>
<li><span class="link-container"><a class="reference external" href="#unconsumed-column-names-warning-becomes-an-exception">“Unconsumed column names” warning becomes an exception</a></span></li>
<li><span class="link-container"><a class="reference external" href="#inspector-get-primary-keys-is-deprecated-use-inspector-get-pk-constraint">Inspector.get_primary_keys() is deprecated, use Inspector.get_pk_constraint</a></span></li>
<li><span class="link-container"><a class="reference external" href="#case-insensitive-result-row-names-will-be-disabled-in-most-cases">Case-insensitive result row names will be disabled in most cases</a></span></li>
<li><span class="link-container"><a class="reference external" href="#instrumentationmanager-and-alternate-class-instrumentation-is-now-an-extension"><code class="docutils literal notranslate"><span class="pre">InstrumentationManager</span></code> and alternate class instrumentation is now an extension</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#removed">Removed</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#sqlsoup">SQLSoup</a></span></li>
<li><span class="link-container"><a class="reference external" href="#mutabletype">MutableType</a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlalchemy-exceptions-has-been-sqlalchemy-exc-for-years">sqlalchemy.exceptions (has been sqlalchemy.exc for years)</a></span></li>
</ul>
</li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="migration_07.html">What’s New in SQLAlchemy 0.7?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_06.html">What’s New in SQLAlchemy 0.6?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_05.html">What’s new in SQLAlchemy 0.5?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_04.html">What’s new in SQLAlchemy 0.4?</a></span></li>
</ul>



        </div>

        </div>

    </div>

    

    <div id="docs-body" class="withsidebar" >
        
<div class="section" id="what-s-new-in-sqlalchemy-0-8">
<h1>What’s New in SQLAlchemy 0.8?<a class="headerlink" href="#what-s-new-in-sqlalchemy-0-8" title="Permalink to this headline">¶</a></h1>
<div class="admonition-about-this-document admonition">
<p class="admonition-title">About this Document</p>
<p>This document describes changes between SQLAlchemy version 0.7,
undergoing maintenance releases as of October, 2012,
and SQLAlchemy version 0.8, which is expected for release
in early 2013.</p>
<p>Document date: October 25, 2012
Updated: March 9, 2013</p>
</div>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This guide introduces what’s new in SQLAlchemy version 0.8,
and also documents changes which affect users migrating
their applications from the 0.7 series of SQLAlchemy to 0.8.</p>
<p>SQLAlchemy releases are closing in on 1.0, and each new
version since 0.5 features fewer major usage changes.   Most
applications that are settled into modern 0.7 patterns
should be movable to 0.8 with no changes. Applications that
use 0.6 and even 0.5 patterns should be directly migratable
to 0.8 as well, though larger applications may want to test
with each interim version.</p>
</div>
<div class="section" id="platform-support">
<h2>Platform Support<a class="headerlink" href="#platform-support" title="Permalink to this headline">¶</a></h2>
<div class="section" id="targeting-python-2-5-and-up-now">
<h3>Targeting Python 2.5 and Up Now<a class="headerlink" href="#targeting-python-2-5-and-up-now" title="Permalink to this headline">¶</a></h3>
<p>SQLAlchemy 0.8 will target Python 2.5 and forward;
compatibility for Python 2.4 is being dropped.</p>
<p>The internals will be able to make usage of Python ternaries
(that is, <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">if</span> <span class="pre">y</span> <span class="pre">else</span> <span class="pre">z</span></code>) which will improve things
versus the usage of <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">and</span> <span class="pre">x</span> <span class="pre">or</span> <span class="pre">z</span></code>, which naturally has
been the source of some bugs, as well as context managers
(that is, <code class="docutils literal notranslate"><span class="pre">with:</span></code>) and perhaps in some cases
<code class="docutils literal notranslate"><span class="pre">try:/except:/else:</span></code> blocks which will help with code
readability.</p>
<p>SQLAlchemy will eventually drop 2.5 support as well - when
2.6 is reached as the baseline, SQLAlchemy will move to use
2.6/3.3 in-place compatibility, removing the usage of the
<code class="docutils literal notranslate"><span class="pre">2to3</span></code> tool and maintaining a source base that works with
Python 2 and 3 at the same time.</p>
</div>
</div>
<div class="section" id="new-orm-features">
<h2>New ORM Features<a class="headerlink" href="#new-orm-features" title="Permalink to this headline">¶</a></h2>
<div class="section" id="rewritten-orm-relationship-mechanics">
<span id="feature-relationship-08"></span><h3>Rewritten <a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> mechanics<a class="headerlink" href="#rewritten-orm-relationship-mechanics" title="Permalink to this headline">¶</a></h3>
<p>0.8 features a much improved and capable system regarding
how <a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> determines how to join between two
entities.  The new system includes these features:</p>
<ul>
<li><p>The <code class="docutils literal notranslate"><span class="pre">primaryjoin</span></code> argument is <strong>no longer needed</strong> when
constructing a <a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a>   against a class that
has multiple foreign key paths to the target.  Only the
<code class="docutils literal notranslate"><span class="pre">foreign_keys</span></code>   argument is needed to specify those
columns which should be included:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Parent</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;parent&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">child_id_one</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;child.id&#39;</span><span class="p">))</span>
    <span class="n">child_id_two</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;child.id&#39;</span><span class="p">))</span>

    <span class="n">child_one</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Child&quot;</span><span class="p">,</span> <span class="n">foreign_keys</span><span class="o">=</span><span class="n">child_id_one</span><span class="p">)</span>
    <span class="n">child_two</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Child&quot;</span><span class="p">,</span> <span class="n">foreign_keys</span><span class="o">=</span><span class="n">child_id_two</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Child</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;child&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></pre></div>
</div>
</li>
<li><p>relationships against self-referential, composite foreign
keys where <strong>a column points to itself</strong>   are now
supported.   The canonical case is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Folder</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;folder&#39;</span>
    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">(</span>
      <span class="n">ForeignKeyConstraint</span><span class="p">(</span>
          <span class="p">[</span><span class="s1">&#39;account_id&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span><span class="p">],</span>
          <span class="p">[</span><span class="s1">&#39;folder.account_id&#39;</span><span class="p">,</span> <span class="s1">&#39;folder.folder_id&#39;</span><span class="p">]),</span>
    <span class="p">)</span>

    <span class="n">account_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">folder_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">parent_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>

    <span class="n">parent_folder</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Folder&quot;</span><span class="p">,</span>
                        <span class="n">backref</span><span class="o">=</span><span class="s2">&quot;child_folders&quot;</span><span class="p">,</span>
                        <span class="n">remote_side</span><span class="o">=</span><span class="p">[</span><span class="n">account_id</span><span class="p">,</span> <span class="n">folder_id</span><span class="p">]</span>
                  <span class="p">)</span></pre></div>
</div>
<p>Above, the <code class="docutils literal notranslate"><span class="pre">Folder</span></code> refers to its parent <code class="docutils literal notranslate"><span class="pre">Folder</span></code>
joining from <code class="docutils literal notranslate"><span class="pre">account_id</span></code> to itself, and <code class="docutils literal notranslate"><span class="pre">parent_id</span></code>
to <code class="docutils literal notranslate"><span class="pre">folder_id</span></code>.  When SQLAlchemy constructs an auto-
join, no longer can it assume all columns on the “remote”
side are aliased, and all columns on the “local” side are
not - the <code class="docutils literal notranslate"><span class="pre">account_id</span></code> column is <strong>on both sides</strong>.   So
the internal relationship mechanics were totally rewritten
to support an entirely different system whereby two copies
of <code class="docutils literal notranslate"><span class="pre">account_id</span></code> are generated, each containing different
<em>annotations</em> to determine their role within the
statement.  Note the join condition within a basic eager
load:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SELECT
    folder.account_id AS folder_account_id,
    folder.folder_id AS folder_folder_id,
    folder.parent_id AS folder_parent_id,
    folder.name AS folder_name,
    folder_1.account_id AS folder_1_account_id,
    folder_1.folder_id AS folder_1_folder_id,
    folder_1.parent_id AS folder_1_parent_id,
    folder_1.name AS folder_1_name
FROM folder
    LEFT OUTER JOIN folder AS folder_1
    ON
        folder_1.account_id = folder.account_id
        AND folder.folder_id = folder_1.parent_id

WHERE folder.folder_id = ? AND folder.account_id = ?</pre></div>
</div>
</li>
<li><p>Previously difficult custom join conditions, like those involving
functions and/or CASTing of types, will now function as
expected in most cases:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">HostEntry</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;host_entry&#39;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ip_address</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">INET</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>

    <span class="c1"># relationship() using explicit foreign_keys, remote_side</span>
    <span class="n">parent_host</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;HostEntry&quot;</span><span class="p">,</span>
                        <span class="n">primaryjoin</span><span class="o">=</span><span class="n">ip_address</span> <span class="o">==</span> <span class="n">cast</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">INET</span><span class="p">),</span>
                        <span class="n">foreign_keys</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="n">remote_side</span><span class="o">=</span><span class="n">ip_address</span>
                    <span class="p">)</span></pre></div>
</div>
<p>The new <a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> mechanics make use of a
SQLAlchemy concept known as <a class="reference internal" href="../glossary.html#term-annotations"><span class="xref std std-term">annotations</span></a>.  These annotations
are also available to application code explicitly via
the <a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.foreign" title="sqlalchemy.orm.foreign"><code class="xref py py-func docutils literal notranslate"><span class="pre">foreign()</span></code></a> and <a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.remote" title="sqlalchemy.orm.remote"><code class="xref py py-func docutils literal notranslate"><span class="pre">remote()</span></code></a> functions, either
as a means to improve readability for advanced configurations
or to directly inject an exact configuration, bypassing
the usual join-inspection heuristics:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="k">import</span> <span class="n">foreign</span><span class="p">,</span> <span class="n">remote</span>

<span class="k">class</span> <span class="nc">HostEntry</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;host_entry&#39;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ip_address</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">INET</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>

    <span class="c1"># relationship() using explicit foreign() and remote() annotations</span>
    <span class="c1"># in lieu of separate arguments</span>
    <span class="n">parent_host</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;HostEntry&quot;</span><span class="p">,</span>
                        <span class="n">primaryjoin</span><span class="o">=</span><span class="n">remote</span><span class="p">(</span><span class="n">ip_address</span><span class="p">)</span> <span class="o">==</span> \
                                <span class="n">cast</span><span class="p">(</span><span class="n">foreign</span><span class="p">(</span><span class="n">content</span><span class="p">),</span> <span class="n">INET</span><span class="p">),</span>
                    <span class="p">)</span></pre></div>
</div>
</li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../orm/join_conditions.html#relationship-configure-joins"><span class="std std-ref">Configuring how Relationship Joins</span></a> - a newly revised section on <a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a>
detailing the latest techniques for customizing related attributes and collection
access.</p>
</div>
<p><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/1401">#1401</a> <a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/610">#610</a></p>
</div>
<div class="section" id="new-class-object-inspection-system">
<span id="feature-orminspection-08"></span><h3>New Class/Object Inspection System<a class="headerlink" href="#new-class-object-inspection-system" title="Permalink to this headline">¶</a></h3>
<p>Lots of SQLAlchemy users are writing systems that require
the ability to inspect the attributes of a mapped class,
including being able to get at the primary key columns,
object relationships, plain attributes, and so forth,
typically for the purpose of building data-marshalling
systems, like JSON/XML conversion schemes and of course form
libraries galore.</p>
<p>Originally, the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> and <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> model were the
original inspection points, which have a well-documented
system.  While SQLAlchemy ORM models are also fully
introspectable, this has never been a fully stable and
supported feature, and users tended to not have a clear idea
how to get at this information.</p>
<p>0.8 now provides a consistent, stable and fully
documented API for this purpose, including an inspection
system which works on mapped classes, instances, attributes,
and other Core and ORM constructs.  The entrypoint to this
system is the core-level <a class="reference internal" href="../core/inspection.html#sqlalchemy.inspect" title="sqlalchemy.inspect"><code class="xref py py-func docutils literal notranslate"><span class="pre">inspect()</span></code></a> function.
In most cases, the object being inspected
is one already part of SQLAlchemy’s system,
such as <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a>, <a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.state.InstanceState" title="sqlalchemy.orm.state.InstanceState"><code class="xref py py-class docutils literal notranslate"><span class="pre">InstanceState</span></code></a>,
<a class="reference internal" href="../core/reflection.html#sqlalchemy.engine.reflection.Inspector" title="sqlalchemy.engine.reflection.Inspector"><code class="xref py py-class docutils literal notranslate"><span class="pre">Inspector</span></code></a>.  In some cases, new objects have been
added with the job of providing the inspection API in
certain contexts, such as <a class="reference internal" href="../orm/query.html#sqlalchemy.orm.util.AliasedInsp" title="sqlalchemy.orm.util.AliasedInsp"><code class="xref py py-class docutils literal notranslate"><span class="pre">AliasedInsp</span></code></a> and
<a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.state.AttributeState" title="sqlalchemy.orm.state.AttributeState"><code class="xref py py-class docutils literal notranslate"><span class="pre">AttributeState</span></code></a>.</p>
<p>A walkthrough of some key capabilities follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;user&#39;</span>
<span class="gp">... </span>    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">name_syn</span> <span class="o">=</span> <span class="n">synonym</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">addresses</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Address&quot;</span><span class="p">)</span>
<span class="gp">...</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># universal entry point is inspect()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">inspect</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># b in this case is the Mapper</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span>
<span class="go">&lt;Mapper at 0x101521950; User&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Column namespace</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">id</span>
<span class="go">Column(&#39;id&#39;, Integer(), table=&lt;user&gt;, primary_key=True, nullable=False)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># mapper&#39;s perspective of the primary key</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">primary_key</span>
<span class="go">(Column(&#39;id&#39;, Integer(), table=&lt;user&gt;, primary_key=True, nullable=False),)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># MapperProperties available from .attrs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="go">[&#39;name_syn&#39;, &#39;addresses&#39;, &#39;id&#39;, &#39;name&#39;]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># .column_attrs, .relationships, etc. filter this collection</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">column_attrs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="go">[&#39;id&#39;, &#39;name&#39;]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">relationships</span><span class="p">)</span>
<span class="go">[&lt;sqlalchemy.orm.properties.RelationshipProperty object at 0x1015212d0&gt;]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># they are also namespaces</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">column_attrs</span><span class="o">.</span><span class="n">id</span>
<span class="go">&lt;sqlalchemy.orm.properties.ColumnProperty object at 0x101525090&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">relationships</span><span class="o">.</span><span class="n">addresses</span>
<span class="go">&lt;sqlalchemy.orm.properties.RelationshipProperty object at 0x1015212d0&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># point inspect() at a mapped, class level attribute,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># returns the attribute itself</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">inspect</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">addresses</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span>
<span class="go">&lt;sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x101521fd0&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># From here we can get the mapper:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">mapper</span>
<span class="go">&lt;Mapper at 0x101525810; Address&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># the parent inspector, in this case a mapper</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">parent</span>
<span class="go">&lt;Mapper at 0x101521950; User&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># an expression</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">expression</span><span class="p">)</span>
<span class="go">&quot;user&quot;.id = address.user_id</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># inspect works on instances</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u1</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">inspect</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># it returns the InstanceState</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span>
<span class="go">&lt;sqlalchemy.orm.state.InstanceState object at 0x10152bed0&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># similar attrs accessor refers to the</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="go">[&#39;id&#39;, &#39;name_syn&#39;, &#39;addresses&#39;, &#39;name&#39;]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># attribute interface - from attrs, you get a state object</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">id</span>
<span class="go">&lt;sqlalchemy.orm.state.AttributeState object at 0x10152bf90&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># this object can give you, current value...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">value</span>
<span class="go">3</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># ... current history</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">history</span>
<span class="go">History(added=[3], unchanged=(), deleted=())</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># InstanceState can also provide session state information</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># lets assume the object is persistent</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># now we can get primary key identity, always</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># works in query.get()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">identity</span>
<span class="go">(3,)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># the mapper level key</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">identity_key</span>
<span class="go">(&lt;class &#39;__main__.User&#39;&gt;, (3,))</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># state within the session</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">persistent</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">transient</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">deleted</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">detached</span>
<span class="go">(True, False, False, False)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># owning session</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">session</span>
<span class="go">&lt;sqlalchemy.orm.session.Session object at 0x101701150&gt;</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../core/inspection.html"><span class="std std-ref">Runtime Inspection API</span></a></p>
</div>
<p><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2208">#2208</a></p>
</div>
<div class="section" id="new-with-polymorphic-feature-can-be-used-anywhere">
<h3>New with_polymorphic() feature, can be used anywhere<a class="headerlink" href="#new-with-polymorphic-feature-can-be-used-anywhere" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="../orm/query.html#sqlalchemy.orm.query.Query.with_polymorphic" title="sqlalchemy.orm.query.Query.with_polymorphic"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.with_polymorphic()</span></code></a> method allows the user to
specify which tables should be present when querying against
a joined-table entity.   Unfortunately the method is awkward
and only applies to the first entity in the list, and
otherwise has awkward behaviors both in usage as well as
within the internals.  A new enhancement to the
<a class="reference internal" href="../orm/query.html#sqlalchemy.orm.aliased" title="sqlalchemy.orm.aliased"><code class="xref py py-func docutils literal notranslate"><span class="pre">aliased()</span></code></a> construct has been added called
<a class="reference internal" href="../orm/inheritance_loading.html#sqlalchemy.orm.with_polymorphic" title="sqlalchemy.orm.with_polymorphic"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_polymorphic()</span></code></a> which allows any entity to be
“aliased” into a “polymorphic” version of itself, freely
usable anywhere:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="k">import</span> <span class="n">with_polymorphic</span>
<span class="n">palias</span> <span class="o">=</span> <span class="n">with_polymorphic</span><span class="p">(</span><span class="n">Person</span><span class="p">,</span> <span class="p">[</span><span class="n">Engineer</span><span class="p">,</span> <span class="n">Manager</span><span class="p">])</span>
<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Company</span><span class="p">)</span><span class="o">.</span>\
            <span class="n">join</span><span class="p">(</span><span class="n">palias</span><span class="p">,</span> <span class="n">Company</span><span class="o">.</span><span class="n">employees</span><span class="p">)</span><span class="o">.</span>\
            <span class="nb">filter</span><span class="p">(</span><span class="n">or_</span><span class="p">(</span><span class="n">Engineer</span><span class="o">.</span><span class="n">language</span><span class="o">==</span><span class="s1">&#39;java&#39;</span><span class="p">,</span> <span class="n">Manager</span><span class="o">.</span><span class="n">hair</span><span class="o">==</span><span class="s1">&#39;pointy&#39;</span><span class="p">))</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../orm/inheritance_loading.html#with-polymorphic"><span class="std std-ref">Using with_polymorphic</span></a> - newly updated documentation for polymorphic
loading control.</p>
</div>
<p><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2333">#2333</a></p>
</div>
<div class="section" id="of-type-works-with-alias-with-polymorphic-any-has-joinedload-subqueryload-contains-eager">
<h3>of_type() works with alias(), with_polymorphic(), any(), has(), joinedload(), subqueryload(), contains_eager()<a class="headerlink" href="#of-type-works-with-alias-with-polymorphic-any-has-joinedload-subqueryload-contains-eager" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.PropComparator.of_type" title="sqlalchemy.orm.PropComparator.of_type"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PropComparator.of_type()</span></code></a> method is used to specify
a specific subtype to use when constructing SQL expressions along
a <a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> that has a <a class="reference internal" href="../glossary.html#term-polymorphic"><span class="xref std std-term">polymorphic</span></a> mapping as its target.
This method can now be used to target <em>any number</em> of target subtypes,
by combining it with the new <a class="reference internal" href="../orm/inheritance_loading.html#sqlalchemy.orm.with_polymorphic" title="sqlalchemy.orm.with_polymorphic"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_polymorphic()</span></code></a> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># use eager loading in conjunction with with_polymorphic targets</span>
<span class="n">Job_P</span> <span class="o">=</span> <span class="n">with_polymorphic</span><span class="p">(</span><span class="n">Job</span><span class="p">,</span> <span class="p">[</span><span class="n">SubJob</span><span class="p">,</span> <span class="n">ExtraJob</span><span class="p">],</span> <span class="n">aliased</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">DataContainer</span><span class="p">)</span><span class="o">.</span>\
            <span class="n">join</span><span class="p">(</span><span class="n">DataContainer</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">Job_P</span><span class="p">))</span><span class="o">.</span>\
                <span class="n">options</span><span class="p">(</span><span class="n">contains_eager</span><span class="p">(</span><span class="n">DataContainer</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">Job_P</span><span class="p">)))</span></pre></div>
</div>
<p>The method now works equally well in most places a regular relationship
attribute is accepted, including with loader functions like
<a class="reference internal" href="../orm/loading_relationships.html#sqlalchemy.orm.joinedload" title="sqlalchemy.orm.joinedload"><code class="xref py py-func docutils literal notranslate"><span class="pre">joinedload()</span></code></a>, <a class="reference internal" href="../orm/loading_relationships.html#sqlalchemy.orm.subqueryload" title="sqlalchemy.orm.subqueryload"><code class="xref py py-func docutils literal notranslate"><span class="pre">subqueryload()</span></code></a>, <a class="reference internal" href="../orm/loading_relationships.html#sqlalchemy.orm.contains_eager" title="sqlalchemy.orm.contains_eager"><code class="xref py py-func docutils literal notranslate"><span class="pre">contains_eager()</span></code></a>,
and comparison methods like <a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.PropComparator.any" title="sqlalchemy.orm.PropComparator.any"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PropComparator.any()</span></code></a>
and <a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.PropComparator.has" title="sqlalchemy.orm.PropComparator.has"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PropComparator.has()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># use eager loading in conjunction with with_polymorphic targets</span>
<span class="n">Job_P</span> <span class="o">=</span> <span class="n">with_polymorphic</span><span class="p">(</span><span class="n">Job</span><span class="p">,</span> <span class="p">[</span><span class="n">SubJob</span><span class="p">,</span> <span class="n">ExtraJob</span><span class="p">],</span> <span class="n">aliased</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">DataContainer</span><span class="p">)</span><span class="o">.</span>\
            <span class="n">join</span><span class="p">(</span><span class="n">DataContainer</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">Job_P</span><span class="p">))</span><span class="o">.</span>\
                <span class="n">options</span><span class="p">(</span><span class="n">contains_eager</span><span class="p">(</span><span class="n">DataContainer</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">Job_P</span><span class="p">)))</span>

<span class="c1"># pass subclasses to eager loads (implicitly applies with_polymorphic)</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">ParentThing</span><span class="p">)</span><span class="o">.</span>\
                <span class="n">options</span><span class="p">(</span>
                    <span class="n">joinedload_all</span><span class="p">(</span>
                        <span class="n">ParentThing</span><span class="o">.</span><span class="n">container</span><span class="p">,</span>
                        <span class="n">DataContainer</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">SubJob</span><span class="p">)</span>
                <span class="p">))</span>

<span class="c1"># control self-referential aliasing with any()/has()</span>
<span class="n">Job_A</span> <span class="o">=</span> <span class="n">aliased</span><span class="p">(</span><span class="n">Job</span><span class="p">)</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Job</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DataContainer</span><span class="o">.</span><span class="n">jobs</span><span class="p">)</span><span class="o">.</span>\
                <span class="nb">filter</span><span class="p">(</span>
                    <span class="n">DataContainer</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">Job_A</span><span class="p">)</span><span class="o">.</span>\
                        <span class="nb">any</span><span class="p">(</span><span class="n">and_</span><span class="p">(</span><span class="n">Job_A</span><span class="o">.</span><span class="n">id</span> <span class="o">&lt;</span> <span class="n">Job</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">Job_A</span><span class="o">.</span><span class="n">type</span><span class="o">==</span><span class="s1">&#39;fred&#39;</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../orm/inheritance_loading.html#inheritance-of-type"><span class="std std-ref">Referring to specific subtypes on relationships</span></a></p>
</div>
<p><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2438">#2438</a> <a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/1106">#1106</a></p>
</div>
<div class="section" id="events-can-be-applied-to-unmapped-superclasses">
<h3>Events Can Be Applied to Unmapped Superclasses<a class="headerlink" href="#events-can-be-applied-to-unmapped-superclasses" title="Permalink to this headline">¶</a></h3>
<p>Mapper and instance events can now be associated with an unmapped
superclass, where those events will be propagated to subclasses
as those subclasses are mapped.   The <code class="docutils literal notranslate"><span class="pre">propagate=True</span></code> flag
should be used.  This feature allows events to be associated
with a declarative base class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="k">import</span> <span class="n">declarative_base</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>

<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="s2">&quot;load&quot;</span><span class="p">,</span> <span class="n">Base</span><span class="p">,</span> <span class="n">propagate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">on_load</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;New instance loaded:&quot;</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>

<span class="c1"># on_load() will be applied to SomeClass</span>
<span class="k">class</span> <span class="nc">SomeClass</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;sometable&#39;</span>

    <span class="c1"># ...</span></pre></div>
</div>
<p><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2585">#2585</a></p>
</div>
<div class="section" id="declarative-distinguishes-between-modules-packages">
<h3>Declarative Distinguishes Between Modules/Packages<a class="headerlink" href="#declarative-distinguishes-between-modules-packages" title="Permalink to this headline">¶</a></h3>
<p>A key feature of Declarative is the ability to refer
to other mapped classes using their string name.   The
registry of class names is now sensitive to the owning
module and package of a given class.   The classes
can be referred to via dotted name in expressions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Snack</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="c1"># ...</span>

    <span class="n">peanuts</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;nuts.Peanut&quot;</span><span class="p">,</span>
            <span class="n">primaryjoin</span><span class="o">=</span><span class="s2">&quot;nuts.Peanut.snack_id == Snack.id&quot;</span><span class="p">)</span></pre></div>
</div>
<p>The resolution allows that any full or partial
disambiguating package name can be used.   If the
path to a particular class is still ambiguous,
an error is raised.</p>
<p><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2338">#2338</a></p>
</div>
<div class="section" id="new-deferredreflection-feature-in-declarative">
<h3>New DeferredReflection Feature in Declarative<a class="headerlink" href="#new-deferredreflection-feature-in-declarative" title="Permalink to this headline">¶</a></h3>
<p>The “deferred reflection” example has been moved to a
supported feature within Declarative.  This feature allows
the construction of declarative mapped classes with only
placeholder <code class="docutils literal notranslate"><span class="pre">Table</span></code> metadata, until a <code class="docutils literal notranslate"><span class="pre">prepare()</span></code> step
is called, given an <code class="docutils literal notranslate"><span class="pre">Engine</span></code> with which to reflect fully
all tables and establish actual mappings.   The system
supports overriding of columns, single and joined
inheritance, as well as distinct bases-per-engine. A full
declarative configuration can now be created against an
existing table that is assembled upon engine creation time
in one step:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ReflectedOne</span><span class="p">(</span><span class="n">DeferredReflection</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="n">__abstract__</span> <span class="o">=</span> <span class="kc">True</span>

<span class="k">class</span> <span class="nc">ReflectedTwo</span><span class="p">(</span><span class="n">DeferredReflection</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="n">__abstract__</span> <span class="o">=</span> <span class="kc">True</span>

<span class="k">class</span> <span class="nc">MyClass</span><span class="p">(</span><span class="n">ReflectedOne</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;mytable&#39;</span>

<span class="k">class</span> <span class="nc">MyOtherClass</span><span class="p">(</span><span class="n">ReflectedOne</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;myothertable&#39;</span>

<span class="k">class</span> <span class="nc">YetAnotherClass</span><span class="p">(</span><span class="n">ReflectedTwo</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;yetanothertable&#39;</span>

<span class="n">ReflectedOne</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="n">engine_one</span><span class="p">)</span>
<span class="n">ReflectedTwo</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="n">engine_two</span><span class="p">)</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../orm/extensions/declarative/api.html#sqlalchemy.ext.declarative.DeferredReflection" title="sqlalchemy.ext.declarative.DeferredReflection"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeferredReflection</span></code></a></p>
</div>
<p><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2485">#2485</a></p>
</div>
<div class="section" id="orm-classes-now-accepted-by-core-constructs">
<h3>ORM Classes Now Accepted by Core Constructs<a class="headerlink" href="#orm-classes-now-accepted-by-core-constructs" title="Permalink to this headline">¶</a></h3>
<p>While the SQL expressions used with <a class="reference internal" href="../orm/query.html#sqlalchemy.orm.query.Query.filter" title="sqlalchemy.orm.query.Query.filter"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.filter()</span></code></a>,
such as <code class="docutils literal notranslate"><span class="pre">User.id</span> <span class="pre">==</span> <span class="pre">5</span></code>, have always been compatible for
use with core constructs such as <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a>, the mapped
class itself would not be recognized when passed to <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a>,
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.select_from" title="sqlalchemy.sql.expression.Select.select_from"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.select_from()</span></code></a>, or <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.correlate" title="sqlalchemy.sql.expression.Select.correlate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.correlate()</span></code></a>.
A new SQL registration system allows a mapped class to be
accepted as a FROM clause within the core:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="k">import</span> <span class="n">select</span>

<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">User</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span></pre></div>
</div>
<p>Above, the mapped <code class="docutils literal notranslate"><span class="pre">User</span></code> class will expand into
the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> to which <code class="docutils literal notranslate"><span class="pre">User</span></code> is mapped.</p>
<p><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2245">#2245</a></p>
</div>
<div class="section" id="query-update-supports-update-from">
<span id="change-orm-2365"></span><h3>Query.update() supports UPDATE..FROM<a class="headerlink" href="#query-update-supports-update-from" title="Permalink to this headline">¶</a></h3>
<p>The new UPDATE..FROM mechanics work in query.update().
Below, we emit an UPDATE against <code class="docutils literal notranslate"><span class="pre">SomeEntity</span></code>, adding
a FROM clause (or equivalent, depending on backend)
against <code class="docutils literal notranslate"><span class="pre">SomeOtherEntity</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">query</span><span class="p">(</span><span class="n">SomeEntity</span><span class="p">)</span><span class="o">.</span>\
    <span class="nb">filter</span><span class="p">(</span><span class="n">SomeEntity</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="n">SomeOtherEntity</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span>\
    <span class="nb">filter</span><span class="p">(</span><span class="n">SomeOtherEntity</span><span class="o">.</span><span class="n">foo</span><span class="o">==</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">update</span><span class="p">({</span><span class="s2">&quot;data&quot;</span><span class="p">:</span><span class="s2">&quot;x&quot;</span><span class="p">})</span></pre></div>
</div>
<p>In particular, updates to joined-inheritance
entities are supported, provided the target of the UPDATE is local to the
table being filtered on, or if the parent and child tables
are mixed, they are joined explicitly in the query.  Below,
given <code class="docutils literal notranslate"><span class="pre">Engineer</span></code> as a joined subclass of <code class="docutils literal notranslate"><span class="pre">Person</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">query</span><span class="p">(</span><span class="n">Engineer</span><span class="p">)</span><span class="o">.</span>\
        <span class="nb">filter</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="n">Engineer</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span>\
        <span class="nb">filter</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s1">&#39;dilbert&#39;</span><span class="p">)</span><span class="o">.</span>\
        <span class="n">update</span><span class="p">({</span><span class="s2">&quot;engineer_data&quot;</span><span class="p">:</span><span class="s2">&quot;java&quot;</span><span class="p">})</span></pre></div>
</div>
<p>would produce:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="n">engineer</span> <span class="n">SET</span> <span class="n">engineer_data</span><span class="o">=</span><span class="s1">&#39;java&#39;</span> <span class="n">FROM</span> <span class="n">person</span>
<span class="n">WHERE</span> <span class="n">person</span><span class="o">.</span><span class="n">id</span><span class="o">=</span><span class="n">engineer</span><span class="o">.</span><span class="n">id</span> <span class="n">AND</span> <span class="n">person</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;dilbert&#39;</span></pre></div>
</div>
<p><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2365">#2365</a></p>
</div>
<div class="section" id="rollback-will-only-roll-back-dirty-objects-from-a-begin-nested">
<h3>rollback() will only roll back “dirty” objects from a begin_nested()<a class="headerlink" href="#rollback-will-only-roll-back-dirty-objects-from-a-begin-nested" title="Permalink to this headline">¶</a></h3>
<p>A behavioral change that should improve efficiency for those
users using SAVEPOINT via <code class="docutils literal notranslate"><span class="pre">Session.begin_nested()</span></code> - upon
<code class="docutils literal notranslate"><span class="pre">rollback()</span></code>, only those objects that were made dirty
since the last flush will be expired, the rest of the
<code class="docutils literal notranslate"><span class="pre">Session</span></code> remains intact.  This because a ROLLBACK to a
SAVEPOINT does not terminate the containing transaction’s
isolation, so no expiry is needed except for those changes
that were not flushed in the current transaction.</p>
<p><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2452">#2452</a></p>
</div>
<div class="section" id="caching-example-now-uses-dogpile-cache">
<h3>Caching Example now uses dogpile.cache<a class="headerlink" href="#caching-example-now-uses-dogpile-cache" title="Permalink to this headline">¶</a></h3>
<p>The caching example now uses <a class="reference external" href="https://dogpilecache.readthedocs.io/">dogpile.cache</a>.
Dogpile.cache is a rewrite of the caching portion
of Beaker, featuring vastly simpler and faster operation,
as well as support for distributed locking.</p>
<p>Note that the SQLAlchemy APIs used by the Dogpile example as well
as the previous Beaker example have changed slightly, in particular
this change is needed as illustrated in the Beaker example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span> <span class="n">examples</span><span class="o">/</span><span class="n">beaker_caching</span><span class="o">/</span><span class="n">caching_query</span><span class="o">.</span><span class="n">py</span>
<span class="o">+++</span> <span class="n">examples</span><span class="o">/</span><span class="n">beaker_caching</span><span class="o">/</span><span class="n">caching_query</span><span class="o">.</span><span class="n">py</span>
<span class="o">@@</span> <span class="o">-</span><span class="mi">222</span><span class="p">,</span><span class="mi">7</span> <span class="o">+</span><span class="mi">222</span><span class="p">,</span><span class="mi">8</span> <span class="o">@@</span>

         <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">         if query._current_path:</span>
<span class="s2">-            mapper, key = query._current_path[-2:]</span>
<span class="s2">+            mapper, prop = query._current_path[-2:]</span>
<span class="s2">+            key = prop.key</span>

<span class="s2">             for cls in mapper.class_.__mro__:</span>
<span class="s2">                 if (cls, key) in self._relationship_options:</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-mod docutils literal notranslate"><span class="pre">dogpile_caching</span></code></p>
</div>
<p><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2589">#2589</a></p>
</div>
</div>
<div class="section" id="new-core-features">
<h2>New Core Features<a class="headerlink" href="#new-core-features" title="Permalink to this headline">¶</a></h2>
<div class="section" id="fully-extensible-type-level-operator-support-in-core">
<h3>Fully extensible, type-level operator support in Core<a class="headerlink" href="#fully-extensible-type-level-operator-support-in-core" title="Permalink to this headline">¶</a></h3>
<p>The Core has to date never had any system of adding support
for new SQL operators to Column and other expression
constructs, other than the <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.operators.ColumnOperators.op" title="sqlalchemy.sql.operators.ColumnOperators.op"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnOperators.op()</span></code></a> method
which is “just enough” to make things work. There has also
never been any system in place for Core which allows the
behavior of existing operators to be overridden.   Up until
now, the only way operators could be flexibly redefined was
in the ORM layer, using <a class="reference internal" href="../orm/mapping_columns.html#sqlalchemy.orm.column_property" title="sqlalchemy.orm.column_property"><code class="xref py py-func docutils literal notranslate"><span class="pre">column_property()</span></code></a> given a
<code class="docutils literal notranslate"><span class="pre">comparator_factory</span></code> argument.   Third party libraries
like GeoAlchemy therefore were forced to be ORM-centric and
rely upon an array of hacks to apply new operations as well
as to get them to propagate correctly.</p>
<p>The new operator system in Core adds the one hook that’s
been missing all along, which is to associate new and
overridden operators with <em>types</em>.   Since after all, it’s
not really a column, CAST operator, or SQL function that
really drives what kinds of operations are present, it’s the
<em>type</em> of the expression.   The implementation details are
minimal - only a few extra methods are added to the core
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><code class="xref py py-class docutils literal notranslate"><span class="pre">ColumnElement</span></code></a> type so that it consults its
<a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">TypeEngine</span></code></a> object for an optional set of operators.
New or revised operations can be associated with any type,
either via subclassing of an existing type, by using
<a class="reference internal" href="../core/custom_types.html#sqlalchemy.types.TypeDecorator" title="sqlalchemy.types.TypeDecorator"><code class="xref py py-class docutils literal notranslate"><span class="pre">TypeDecorator</span></code></a>, or “globally across-the-board” by
attaching a new <a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine.Comparator" title="sqlalchemy.types.TypeEngine.Comparator"><code class="xref py py-class docutils literal notranslate"><span class="pre">Comparator</span></code></a> object to an existing type
class.</p>
<p>For example, to add logarithm support to <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Numeric" title="sqlalchemy.types.Numeric"><code class="xref py py-class docutils literal notranslate"><span class="pre">Numeric</span></code></a> types:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.types</span> <span class="k">import</span> <span class="n">Numeric</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.sql</span> <span class="k">import</span> <span class="n">func</span>

<span class="k">class</span> <span class="nc">CustomNumeric</span><span class="p">(</span><span class="n">Numeric</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">comparator_factory</span><span class="p">(</span><span class="n">Numeric</span><span class="o">.</span><span class="n">Comparator</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">func</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span></pre></div>
</div>
<p>The new type is usable like any other type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
          <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
          <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">CustomNumeric</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
          <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">CustomNumeric</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
     <span class="p">)</span>

<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">data</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="p">)])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span></pre></div>
</div>
<p>New features which have come from this immediately include
support for PostgreSQL’s HSTORE type, as well as new
operations associated with PostgreSQL’s ARRAY
type.    It also paves the way for existing types to acquire
lots more operators that are specific to those types, such
as more string, integer and date operators.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../core/custom_types.html#types-operators"><span class="std std-ref">Redefining and Creating New Operators</span></a></p>
<p><a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.HSTORE" title="sqlalchemy.dialects.postgresql.HSTORE"><code class="xref py py-class docutils literal notranslate"><span class="pre">HSTORE</span></code></a></p>
</div>
<p><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2547">#2547</a></p>
</div>
<div class="section" id="multiple-values-support-for-insert">
<span id="feature-2623"></span><h3>Multiple-VALUES support for Insert<a class="headerlink" href="#multiple-values-support-for-insert" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert.values" title="sqlalchemy.sql.expression.Insert.values"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.values()</span></code></a> method now supports a list of dictionaries,
which will render a multi-VALUES statement such as
<code class="docutils literal notranslate"><span class="pre">VALUES</span> <span class="pre">(&lt;row1&gt;),</span> <span class="pre">(&lt;row2&gt;),</span> <span class="pre">...</span></code>.  This is only relevant to backends which
support this syntax, including PostgreSQL, SQLite, and MySQL.  It is
not the same thing as the usual <code class="docutils literal notranslate"><span class="pre">executemany()</span></code> style of INSERT which
remains unchanged:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">users</span><span class="o">.</span><span class="n">insert</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">([</span>
                    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;some name&quot;</span><span class="p">},</span>
                    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;some other name&quot;</span><span class="p">},</span>
                    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;yet another name&quot;</span><span class="p">},</span>
                <span class="p">])</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert.values" title="sqlalchemy.sql.expression.Insert.values"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.values()</span></code></a></p>
</div>
<p><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2623">#2623</a></p>
</div>
<div class="section" id="type-expressions">
<h3>Type Expressions<a class="headerlink" href="#type-expressions" title="Permalink to this headline">¶</a></h3>
<p>SQL expressions can now be associated with types.  Historically,
<a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">TypeEngine</span></code></a> has always allowed Python-side functions which
receive both bound parameters as well as result row values, passing
them through a Python side conversion function on the way to/back from
the database.   The new feature allows similar
functionality, except on the database side:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.types</span> <span class="k">import</span> <span class="n">String</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="k">import</span> <span class="n">func</span><span class="p">,</span> <span class="n">Table</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">MetaData</span>

<span class="k">class</span> <span class="nc">LowerString</span><span class="p">(</span><span class="n">String</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">bind_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bindvalue</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">func</span><span class="o">.</span><span class="n">lower</span><span class="p">(</span><span class="n">bindvalue</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">column_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">func</span><span class="o">.</span><span class="n">lower</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>

<span class="n">metadata</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>
<span class="n">test_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
        <span class="s1">&#39;test_table&#39;</span><span class="p">,</span>
        <span class="n">metadata</span><span class="p">,</span>
        <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">LowerString</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<p>Above, the <code class="docutils literal notranslate"><span class="pre">LowerString</span></code> type defines a SQL expression that will be emitted
whenever the <code class="docutils literal notranslate"><span class="pre">test_table.c.data</span></code> column is rendered in the columns
clause of a SELECT statement:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">select</span><span class="p">([</span><span class="n">test_table</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">test_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s1">&#39;HI&#39;</span><span class="p">))</span>
<span class="go">SELECT lower(test_table.data) AS data</span>
<span class="go">FROM test_table</span>
<span class="go">WHERE test_table.data = lower(:data_1)</span></pre></div>
</div>
<p>This feature is also used heavily by the new release of GeoAlchemy,
to embed PostGIS expressions inline in SQL based on type rules.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../core/custom_types.html#types-sql-value-processing"><span class="std std-ref">Applying SQL-level Bind/Result Processing</span></a></p>
</div>
<p><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/1534">#1534</a></p>
</div>
<div class="section" id="core-inspection-system">
<h3>Core Inspection System<a class="headerlink" href="#core-inspection-system" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="../core/inspection.html#sqlalchemy.inspect" title="sqlalchemy.inspect"><code class="xref py py-func docutils literal notranslate"><span class="pre">inspect()</span></code></a> function introduced in <a class="reference internal" href="#feature-orminspection-08"><span class="std std-ref">New Class/Object Inspection System</span></a>
also applies to the core.  Applied to an <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> it produces
an <a class="reference internal" href="../core/reflection.html#sqlalchemy.engine.reflection.Inspector" title="sqlalchemy.engine.reflection.Inspector"><code class="xref py py-class docutils literal notranslate"><span class="pre">Inspector</span></code></a> object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="k">import</span> <span class="n">inspect</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="k">import</span> <span class="n">create_engine</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;postgresql://scott:tiger@localhost/test&quot;</span><span class="p">)</span>
<span class="n">insp</span> <span class="o">=</span> <span class="n">inspect</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">insp</span><span class="o">.</span><span class="n">get_table_names</span><span class="p">())</span></pre></div>
</div>
<p>It can also be applied to any <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ClauseElement" title="sqlalchemy.sql.expression.ClauseElement"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClauseElement</span></code></a>, which returns
the <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ClauseElement" title="sqlalchemy.sql.expression.ClauseElement"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClauseElement</span></code></a> itself, such as <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a>, <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a>,
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a>, etc.   This allows it to work fluently between Core
and ORM constructs.</p>
</div>
<div class="section" id="new-method-expression-select-correlate-except">
<h3>New Method <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.correlate_except" title="sqlalchemy.sql.expression.Select.correlate_except"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.correlate_except()</span></code></a><a class="headerlink" href="#new-method-expression-select-correlate-except" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> now has a method <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.correlate_except" title="sqlalchemy.sql.expression.Select.correlate_except"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.correlate_except()</span></code></a>
which specifies “correlate on all FROM clauses except those
specified”.  It can be used for mapping scenarios where
a related subquery should correlate normally, except
against a particular target selectable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SnortEvent</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;event&quot;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">signature</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;signature.id&quot;</span><span class="p">))</span>

    <span class="n">signatures</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Signature&quot;</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Signature</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;signature&quot;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">sig_count</span> <span class="o">=</span> <span class="n">column_property</span><span class="p">(</span>
                    <span class="n">select</span><span class="p">([</span><span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)])</span><span class="o">.</span>\
                        <span class="n">where</span><span class="p">(</span><span class="n">SnortEvent</span><span class="o">.</span><span class="n">signature</span> <span class="o">==</span> <span class="nb">id</span><span class="p">)</span><span class="o">.</span>
                        <span class="n">correlate_except</span><span class="p">(</span><span class="n">SnortEvent</span><span class="p">)</span>
                <span class="p">)</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.correlate_except" title="sqlalchemy.sql.expression.Select.correlate_except"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.correlate_except()</span></code></a></p>
</div>
</div>
<div class="section" id="postgresql-hstore-type">
<h3>PostgreSQL HSTORE type<a class="headerlink" href="#postgresql-hstore-type" title="Permalink to this headline">¶</a></h3>
<p>Support for PostgreSQL’s <code class="docutils literal notranslate"><span class="pre">HSTORE</span></code> type is now available as
<a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.HSTORE" title="sqlalchemy.dialects.postgresql.HSTORE"><code class="xref py py-class docutils literal notranslate"><span class="pre">HSTORE</span></code></a>.   This type makes great usage
of the new operator system to provide a full range of operators
for HSTORE types, including index access, concatenation,
and containment methods such as
<code class="xref py py-meth docutils literal notranslate"><span class="pre">comparator_factory.has_key()</span></code>,
<code class="xref py py-meth docutils literal notranslate"><span class="pre">comparator_factory.has_any()</span></code>, and
<code class="xref py py-meth docutils literal notranslate"><span class="pre">comparator_factory.matrix()</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.dialects.postgresql</span> <span class="k">import</span> <span class="n">HSTORE</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&#39;data_table&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
        <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;hstore_data&#39;</span><span class="p">,</span> <span class="n">HSTORE</span><span class="p">)</span>
    <span class="p">)</span>

<span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
    <span class="n">select</span><span class="p">([</span><span class="n">data</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">hstore_data</span><span class="p">[</span><span class="s1">&#39;some_key&#39;</span><span class="p">]])</span>
<span class="p">)</span><span class="o">.</span><span class="n">scalar</span><span class="p">()</span>

<span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
    <span class="n">select</span><span class="p">([</span><span class="n">data</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">hstore_data</span><span class="o">.</span><span class="n">matrix</span><span class="p">()])</span>
<span class="p">)</span><span class="o">.</span><span class="n">scalar</span><span class="p">()</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.HSTORE" title="sqlalchemy.dialects.postgresql.HSTORE"><code class="xref py py-class docutils literal notranslate"><span class="pre">HSTORE</span></code></a></p>
<p><a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.hstore" title="sqlalchemy.dialects.postgresql.hstore"><code class="xref py py-class docutils literal notranslate"><span class="pre">hstore</span></code></a></p>
</div>
<p><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2606">#2606</a></p>
</div>
<div class="section" id="enhanced-postgresql-array-type">
<h3>Enhanced PostgreSQL ARRAY type<a class="headerlink" href="#enhanced-postgresql-array-type" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a> type will accept an optional
“dimension” argument, pinning it to a fixed number of
dimensions and greatly improving efficiency when retrieving
results:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># old way, still works since PG supports N-dimensions per row:</span>
<span class="n">Column</span><span class="p">(</span><span class="s2">&quot;my_array&quot;</span><span class="p">,</span> <span class="n">postgresql</span><span class="o">.</span><span class="n">ARRAY</span><span class="p">(</span><span class="n">Integer</span><span class="p">))</span>

<span class="c1"># new way, will render ARRAY with correct number of [] in DDL,</span>
<span class="c1"># will process binds and results more efficiently as we don&#39;t need</span>
<span class="c1"># to guess how many levels deep to go</span>
<span class="n">Column</span><span class="p">(</span><span class="s2">&quot;my_array&quot;</span><span class="p">,</span> <span class="n">postgresql</span><span class="o">.</span><span class="n">ARRAY</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span></pre></div>
</div>
<p>The type also introduces new operators, using the new type-specific
operator framework.  New operations include indexed access:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
    <span class="n">select</span><span class="p">([</span><span class="n">mytable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">arraycol</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
<span class="p">)</span></pre></div>
</div>
<p>slice access in SELECT:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
    <span class="n">select</span><span class="p">([</span><span class="n">mytable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">arraycol</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]])</span>
<span class="p">)</span></pre></div>
</div>
<p>slice updates in UPDATE:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
    <span class="n">mytable</span><span class="o">.</span><span class="n">update</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">({</span><span class="n">mytable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">arraycol</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">]:</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]})</span>
<span class="p">)</span></pre></div>
</div>
<p>freestanding array literals:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy.dialects</span> <span class="k">import</span> <span class="n">postgresql</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span>
<span class="gp">... </span>   <span class="n">select</span><span class="p">([</span>
<span class="gp">... </span>       <span class="n">postgresql</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="n">postgresql</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="gp">... </span>   <span class="p">])</span>
<span class="gp">... </span> <span class="p">)</span>
<span class="go">[1, 2, 3, 4, 5]</span></pre></div>
</div>
<p>array concatenation, where below, the right side <code class="docutils literal notranslate"><span class="pre">[4,</span> <span class="pre">5,</span> <span class="pre">6]</span></code> is coerced into an array literal:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span><span class="p">([</span><span class="n">mytable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">arraycol</span> <span class="o">+</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]])</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a></p>
<p><a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.array" title="sqlalchemy.dialects.postgresql.array"><code class="xref py py-class docutils literal notranslate"><span class="pre">array</span></code></a></p>
</div>
<p><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2441">#2441</a></p>
</div>
<div class="section" id="new-configurable-date-time-types-for-sqlite">
<h3>New, configurable DATE, TIME types for SQLite<a class="headerlink" href="#new-configurable-date-time-types-for-sqlite" title="Permalink to this headline">¶</a></h3>
<p>SQLite has no built-in DATE, TIME, or DATETIME types, and
instead provides some support for storage of date and time
values either as strings or integers.   The date and time
types for SQLite are enhanced in 0.8 to be much more
configurable as to the specific format, including that the
“microseconds” portion is optional, as well as pretty much
everything else.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Column</span><span class="p">(</span><span class="s1">&#39;sometimestamp&#39;</span><span class="p">,</span> <span class="n">sqlite</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">(</span><span class="n">truncate_microseconds</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="n">Column</span><span class="p">(</span><span class="s1">&#39;sometimestamp&#39;</span><span class="p">,</span> <span class="n">sqlite</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">(</span>
                    <span class="n">storage_format</span><span class="o">=</span><span class="p">(</span>
                                <span class="s2">&quot;</span><span class="si">%(year)04d%(month)02d%(day)02d</span><span class="s2">&quot;</span>
                                <span class="s2">&quot;</span><span class="si">%(hour)02d%(minute)02d%(second)02d%(microsecond)06d</span><span class="s2">&quot;</span>
                    <span class="p">),</span>
                    <span class="n">regexp</span><span class="o">=</span><span class="s2">&quot;(\d</span><span class="si">{4}</span><span class="s2">)(\d</span><span class="si">{2}</span><span class="s2">)(\d</span><span class="si">{2}</span><span class="s2">)(\d</span><span class="si">{2}</span><span class="s2">)(\d</span><span class="si">{2}</span><span class="s2">)(\d</span><span class="si">{2}</span><span class="s2">)(\d</span><span class="si">{6}</span><span class="s2">)&quot;</span>
                    <span class="p">)</span>
            <span class="p">)</span>
<span class="n">Column</span><span class="p">(</span><span class="s1">&#39;somedate&#39;</span><span class="p">,</span> <span class="n">sqlite</span><span class="o">.</span><span class="n">DATE</span><span class="p">(</span>
                    <span class="n">storage_format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(month)02d</span><span class="s2">/</span><span class="si">%(day)02d</span><span class="s2">/</span><span class="si">%(year)04d</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">regexp</span><span class="o">=</span><span class="s2">&quot;(?P&lt;month&gt;\d+)/(?P&lt;day&gt;\d+)/(?P&lt;year&gt;\d+)&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span></pre></div>
</div>
<p>Huge thanks to Nate Dub for the sprinting on this at Pycon 2012.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../dialects/sqlite.html#sqlalchemy.dialects.sqlite.DATETIME" title="sqlalchemy.dialects.sqlite.DATETIME"><code class="xref py py-class docutils literal notranslate"><span class="pre">DATETIME</span></code></a></p>
<p><a class="reference internal" href="../dialects/sqlite.html#sqlalchemy.dialects.sqlite.DATE" title="sqlalchemy.dialects.sqlite.DATE"><code class="xref py py-class docutils literal notranslate"><span class="pre">DATE</span></code></a></p>
<p><a class="reference internal" href="../dialects/sqlite.html#sqlalchemy.dialects.sqlite.TIME" title="sqlalchemy.dialects.sqlite.TIME"><code class="xref py py-class docutils literal notranslate"><span class="pre">TIME</span></code></a></p>
</div>
<p><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2363">#2363</a></p>
</div>
<div class="section" id="collate-supported-across-all-dialects-in-particular-mysql-postgresql-sqlite">
<h3>“COLLATE” supported across all dialects; in particular MySQL, PostgreSQL, SQLite<a class="headerlink" href="#collate-supported-across-all-dialects-in-particular-mysql-postgresql-sqlite" title="Permalink to this headline">¶</a></h3>
<p>The “collate” keyword, long accepted by the MySQL dialect, is now established
on all <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.String" title="sqlalchemy.types.String"><code class="xref py py-class docutils literal notranslate"><span class="pre">String</span></code></a> types and will render on any backend, including
when features such as <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.MetaData.create_all" title="sqlalchemy.schema.MetaData.create_all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MetaData.create_all()</span></code></a> and <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.cast" title="sqlalchemy.sql.expression.cast"><code class="xref py py-func docutils literal notranslate"><span class="pre">cast()</span></code></a> is used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">cast</span><span class="p">(</span><span class="n">sometable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">somechar</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">collation</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">))])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<span class="go">SELECT CAST(sometable.somechar AS VARCHAR(20) COLLATE &quot;utf8&quot;) AS anon_1</span>
<span class="go">FROM sometable</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.String" title="sqlalchemy.types.String"><code class="xref py py-class docutils literal notranslate"><span class="pre">String</span></code></a></p>
</div>
<p><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2276">#2276</a></p>
</div>
<div class="section" id="prefixes-now-supported-for-expression-update-expression-delete">
<h3>“Prefixes” now supported for <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.update" title="sqlalchemy.sql.expression.update"><code class="xref py py-func docutils literal notranslate"><span class="pre">update()</span></code></a>, <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.delete" title="sqlalchemy.sql.expression.delete"><code class="xref py py-func docutils literal notranslate"><span class="pre">delete()</span></code></a><a class="headerlink" href="#prefixes-now-supported-for-expression-update-expression-delete" title="Permalink to this headline">¶</a></h3>
<p>Geared towards MySQL, a “prefix” can be rendered within any of
these constructs.   E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stmt</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span><span class="o">.</span><span class="n">prefix_with</span><span class="p">(</span><span class="s2">&quot;LOW_PRIORITY&quot;</span><span class="p">,</span> <span class="n">dialect</span><span class="o">=</span><span class="s2">&quot;mysql&quot;</span><span class="p">)</span>


<span class="n">stmt</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">update</span><span class="p">()</span><span class="o">.</span><span class="n">prefix_with</span><span class="p">(</span><span class="s2">&quot;LOW_PRIORITY&quot;</span><span class="p">,</span> <span class="n">dialect</span><span class="o">=</span><span class="s2">&quot;mysql&quot;</span><span class="p">)</span></pre></div>
</div>
<p>The method is new in addition to those which already existed
on <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.insert" title="sqlalchemy.sql.expression.insert"><code class="xref py py-func docutils literal notranslate"><span class="pre">insert()</span></code></a>, <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> and <a class="reference internal" href="../orm/query.html#sqlalchemy.orm.query.Query" title="sqlalchemy.orm.query.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">Update.prefix_with()</span></code></p>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">Delete.prefix_with()</span></code></p>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.prefix_with()</span></code></p>
<p><a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.prefix_with" title="sqlalchemy.sql.expression.Select.prefix_with"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.prefix_with()</span></code></a></p>
<p><a class="reference internal" href="../orm/query.html#sqlalchemy.orm.query.Query.prefix_with" title="sqlalchemy.orm.query.Query.prefix_with"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.prefix_with()</span></code></a></p>
</div>
<p><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2431">#2431</a></p>
</div>
</div>
<div class="section" id="behavioral-changes">
<h2>Behavioral Changes<a class="headerlink" href="#behavioral-changes" title="Permalink to this headline">¶</a></h2>
<div class="section" id="the-consideration-of-a-pending-object-as-an-orphan-has-been-made-more-aggressive">
<span id="legacy-is-orphan-addition"></span><h3>The consideration of a “pending” object as an “orphan” has been made more aggressive<a class="headerlink" href="#the-consideration-of-a-pending-object-as-an-orphan-has-been-made-more-aggressive" title="Permalink to this headline">¶</a></h3>
<p>This is a late add to the 0.8 series, however it is hoped that the new behavior
is generally more consistent and intuitive in a wider variety of
situations.   The ORM has since at least version 0.4 included behavior
such that an object that’s “pending”, meaning that it’s
associated with a <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> but hasn’t been inserted into the database
yet, is automatically expunged from the <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> when it becomes an “orphan”,
which means it has been de-associated with a parent object that refers to it
with <code class="docutils literal notranslate"><span class="pre">delete-orphan</span></code> cascade on the configured <a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a>.   This
behavior is intended to approximately mirror the behavior of a persistent
(that is, already inserted) object, where the ORM will emit a DELETE for such
objects that become orphans based on the interception of detachment events.</p>
<p>The behavioral change comes into play for objects that
are referred to by multiple kinds of parents that each specify <code class="docutils literal notranslate"><span class="pre">delete-orphan</span></code>; the
typical example is an <a class="reference internal" href="../orm/basic_relationships.html#association-pattern"><span class="std std-ref">association object</span></a> that bridges two other kinds of objects
in a many-to-many pattern.   Previously, the behavior was such that the
pending object would be expunged only when de-associated with <em>all</em> of its parents.
With the behavioral change, the pending object
is expunged as soon as it is de-associated from <em>any</em> of the parents that it was
previously associated with.  This behavior is intended to more closely
match that of persistent objects, which are deleted as soon
as they are de-associated from any parent.</p>
<p>The rationale for the older behavior dates back
at least to version 0.4, and was basically a defensive decision to try to alleviate
confusion when an object was still being constructed for INSERT.   But the reality
is that the object is re-associated with the <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> as soon as it is
attached to any new parent in any case.</p>
<p>It’s still possible to flush an object
that is not associated with all of its required parents, if the object was either
not associated with those parents in the first place, or if it was expunged, but then
re-associated with a <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.session.Session" title="sqlalchemy.orm.session.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> via a subsequent attachment event but still
not fully associated.   In this situation, it is expected that the database
would emit an integrity error, as there are likely NOT NULL foreign key columns
that are unpopulated.   The ORM makes the decision to let these INSERT attempts
occur, based on the judgment that an object that is only partially associated with
its required parents but has been actively associated with some of them,
is more often than not a user error, rather than an intentional
omission which should be silently skipped - silently skipping the INSERT here would
make user errors of this nature very hard to debug.</p>
<p>The old behavior, for applications that might have been relying upon it, can be re-enabled for
any <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper" title="sqlalchemy.orm.Mapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapper</span></code></a> by specifying the flag <code class="docutils literal notranslate"><span class="pre">legacy_is_orphan</span></code> as a mapper
option.</p>
<p>The new behavior allows the following test case to work:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="k">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">ForeignKey</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="k">import</span> <span class="n">relationship</span><span class="p">,</span> <span class="n">backref</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="k">import</span> <span class="n">declarative_base</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;user&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">64</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">UserKeyword</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;user_keyword&#39;</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;user.id&#39;</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">keyword_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;keyword.id&#39;</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">user</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="n">User</span><span class="p">,</span>
                <span class="n">backref</span><span class="o">=</span><span class="n">backref</span><span class="p">(</span><span class="s2">&quot;user_keywords&quot;</span><span class="p">,</span>
                                <span class="n">cascade</span><span class="o">=</span><span class="s2">&quot;all, delete-orphan&quot;</span><span class="p">)</span>
            <span class="p">)</span>

    <span class="n">keyword</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Keyword&quot;</span><span class="p">,</span>
                <span class="n">backref</span><span class="o">=</span><span class="n">backref</span><span class="p">(</span><span class="s2">&quot;user_keywords&quot;</span><span class="p">,</span>
                                <span class="n">cascade</span><span class="o">=</span><span class="s2">&quot;all, delete-orphan&quot;</span><span class="p">)</span>
            <span class="p">)</span>

    <span class="c1"># uncomment this to enable the old behavior</span>
    <span class="c1"># __mapper_args__ = {&quot;legacy_is_orphan&quot;: True}</span>

<span class="k">class</span> <span class="nc">Keyword</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;keyword&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">keyword</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;keyword&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">64</span><span class="p">))</span>

<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="k">import</span> <span class="n">create_engine</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="k">import</span> <span class="n">Session</span>

<span class="c1"># note we&#39;re using PostgreSQL to ensure that referential integrity</span>
<span class="c1"># is enforced, for demonstration purposes.</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;postgresql://scott:tiger@localhost/test&quot;</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">drop_all</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="n">u1</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;u1&quot;</span><span class="p">)</span>
<span class="n">k1</span> <span class="o">=</span> <span class="n">Keyword</span><span class="p">(</span><span class="n">keyword</span><span class="o">=</span><span class="s2">&quot;k1&quot;</span><span class="p">)</span>

<span class="n">session</span><span class="o">.</span><span class="n">add_all</span><span class="p">([</span><span class="n">u1</span><span class="p">,</span> <span class="n">k1</span><span class="p">])</span>

<span class="n">uk1</span> <span class="o">=</span> <span class="n">UserKeyword</span><span class="p">(</span><span class="n">keyword</span><span class="o">=</span><span class="n">k1</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">u1</span><span class="p">)</span>

<span class="c1"># previously, if session.flush() were called here,</span>
<span class="c1"># this operation would succeed, but if session.flush()</span>
<span class="c1"># were not called here, the operation fails with an</span>
<span class="c1"># integrity error.</span>
<span class="c1"># session.flush()</span>
<span class="k">del</span> <span class="n">u1</span><span class="o">.</span><span class="n">user_keywords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></pre></div>
</div>
<p><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2655">#2655</a></p>
</div>
<div class="section" id="the-after-attach-event-fires-after-the-item-is-associated-with-the-session-instead-of-before-before-attach-added">
<h3>The after_attach event fires after the item is associated with the Session instead of before; before_attach added<a class="headerlink" href="#the-after-attach-event-fires-after-the-item-is-associated-with-the-session-instead-of-before-before-attach-added" title="Permalink to this headline">¶</a></h3>
<p>Event handlers which use after_attach can now assume the
given instance is associated with the given session:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">Session</span><span class="p">,</span> <span class="s2">&quot;after_attach&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">after_attach</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">session</span></pre></div>
</div>
<p>Some use cases require that it work this way.  However,
other use cases require that the item is <em>not</em> yet part of
the session, such as when a query, intended to load some
state required for an instance, emits autoflush first and
would otherwise prematurely flush the target object.  Those
use cases should use the new “before_attach” event:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">Session</span><span class="p">,</span> <span class="s2">&quot;before_attach&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">before_attach</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">some_necessary_attribute</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Widget</span><span class="p">)</span><span class="o">.</span>\
                                            <span class="n">filter_by</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">widget_name</span><span class="p">)</span><span class="o">.</span>\
                                            <span class="n">first</span><span class="p">()</span></pre></div>
</div>
<p><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2464">#2464</a></p>
</div>
<div class="section" id="query-now-auto-correlates-like-a-select-does">
<h3>Query now auto-correlates like a select() does<a class="headerlink" href="#query-now-auto-correlates-like-a-select-does" title="Permalink to this headline">¶</a></h3>
<p>Previously it was necessary to call <a class="reference internal" href="../orm/query.html#sqlalchemy.orm.query.Query.correlate" title="sqlalchemy.orm.query.Query.correlate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.correlate()</span></code></a> in
order to have a column- or WHERE-subquery correlate to the
parent:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">subq</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Entity</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span>\
                <span class="nb">filter</span><span class="p">(</span><span class="n">Entity</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="n">Parent</span><span class="o">.</span><span class="n">entity_id</span><span class="p">)</span><span class="o">.</span>\
                <span class="n">correlate</span><span class="p">(</span><span class="n">Parent</span><span class="p">)</span><span class="o">.</span>\
                <span class="n">as_scalar</span><span class="p">()</span>
<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Parent</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">subq</span><span class="o">==</span><span class="s2">&quot;some value&quot;</span><span class="p">)</span></pre></div>
</div>
<p>This was the opposite behavior of a plain <code class="docutils literal notranslate"><span class="pre">select()</span></code>
construct which would assume auto-correlation by default.
The above statement in 0.8 will correlate automatically:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">subq</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Entity</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span>\
                <span class="nb">filter</span><span class="p">(</span><span class="n">Entity</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="n">Parent</span><span class="o">.</span><span class="n">entity_id</span><span class="p">)</span><span class="o">.</span>\
                <span class="n">as_scalar</span><span class="p">()</span>
<span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Parent</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">subq</span><span class="o">==</span><span class="s2">&quot;some value&quot;</span><span class="p">)</span></pre></div>
</div>
<p>like in <code class="docutils literal notranslate"><span class="pre">select()</span></code>, correlation can be disabled by calling
<code class="docutils literal notranslate"><span class="pre">query.correlate(None)</span></code> or manually set by passing an
entity, <code class="docutils literal notranslate"><span class="pre">query.correlate(someentity)</span></code>.</p>
<p><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2179">#2179</a></p>
</div>
<div class="section" id="correlation-is-now-always-context-specific">
<span id="correlation-context-specific"></span><h3>Correlation is now always context-specific<a class="headerlink" href="#correlation-is-now-always-context-specific" title="Permalink to this headline">¶</a></h3>
<p>To allow a wider variety of correlation scenarios, the behavior of
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.correlate" title="sqlalchemy.sql.expression.Select.correlate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.correlate()</span></code></a> and <a class="reference internal" href="../orm/query.html#sqlalchemy.orm.query.Query.correlate" title="sqlalchemy.orm.query.Query.correlate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.correlate()</span></code></a> has changed slightly
such that the SELECT statement will omit the “correlated” target from the
FROM clause only if the statement is actually used in that context.  Additionally,
it’s no longer possible for a SELECT statement that’s placed as a FROM
in an enclosing SELECT statement to “correlate” (i.e. omit) a FROM clause.</p>
<p>This change only makes things better as far as rendering SQL, in that it’s no
longer possible to render illegal SQL where there are insufficient FROM
objects relative to what’s being selected:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.sql</span> <span class="k">import</span> <span class="n">table</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">select</span>

<span class="n">t1</span> <span class="o">=</span> <span class="n">table</span><span class="p">(</span><span class="s1">&#39;t1&#39;</span><span class="p">,</span> <span class="n">column</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">))</span>
<span class="n">t2</span> <span class="o">=</span> <span class="n">table</span><span class="p">(</span><span class="s1">&#39;t2&#39;</span><span class="p">,</span> <span class="n">column</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">))</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">])</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></pre></div>
</div>
<p>Prior to this change, the above would return:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">t1</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">t2</span><span class="o">.</span><span class="n">y</span> <span class="n">FROM</span> <span class="n">t2</span></pre></div>
</div>
<p>which is invalid SQL as “t1” is not referred to in any FROM clause.</p>
<p>Now, in the absence of an enclosing SELECT, it returns:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">t1</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">t2</span><span class="o">.</span><span class="n">y</span> <span class="n">FROM</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span></pre></div>
</div>
<p>Within a SELECT, the correlation takes effect as expected:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">s2</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">t1</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="n">t2</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">t1</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="n">s</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span>

<span class="n">SELECT</span> <span class="n">t1</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">t2</span><span class="o">.</span><span class="n">y</span> <span class="n">FROM</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span>
<span class="n">WHERE</span> <span class="n">t1</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">t2</span><span class="o">.</span><span class="n">y</span> <span class="n">AND</span> <span class="n">t1</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span>
    <span class="p">(</span><span class="n">SELECT</span> <span class="n">t1</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">t2</span><span class="o">.</span><span class="n">y</span> <span class="n">FROM</span> <span class="n">t2</span><span class="p">)</span></pre></div>
</div>
<p>This change is not expected to impact any existing applications, as
the correlation behavior remains identical for properly constructed
expressions.  Only an application that relies, most likely within a
testing scenario, on the invalid string output of a correlated
SELECT used in a non-correlating context would see any change.</p>
<p><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2668">#2668</a></p>
</div>
<div class="section" id="create-all-and-drop-all-will-now-honor-an-empty-list-as-such">
<span id="metadata-create-drop-tables"></span><h3>create_all() and drop_all() will now honor an empty list as such<a class="headerlink" href="#create-all-and-drop-all-will-now-honor-an-empty-list-as-such" title="Permalink to this headline">¶</a></h3>
<p>The methods <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.MetaData.create_all" title="sqlalchemy.schema.MetaData.create_all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MetaData.create_all()</span></code></a> and <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.MetaData.drop_all" title="sqlalchemy.schema.MetaData.drop_all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MetaData.drop_all()</span></code></a>
will now accept a list of <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> objects that is empty,
and will not emit any CREATE or DROP statements.  Previously,
an empty list was interpreted the same as passing <code class="docutils literal notranslate"><span class="pre">None</span></code>
for a collection, and CREATE/DROP would be emitted for all
items unconditionally.</p>
<p>This is a bug fix but some applications may have been relying upon
the previous behavior.</p>
<p><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2664">#2664</a></p>
</div>
<div class="section" id="repaired-the-event-targeting-of-instrumentationevents">
<h3>Repaired the Event Targeting of <a class="reference internal" href="../orm/events.html#sqlalchemy.orm.events.InstrumentationEvents" title="sqlalchemy.orm.events.InstrumentationEvents"><code class="xref py py-class docutils literal notranslate"><span class="pre">InstrumentationEvents</span></code></a><a class="headerlink" href="#repaired-the-event-targeting-of-instrumentationevents" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="../orm/events.html#sqlalchemy.orm.events.InstrumentationEvents" title="sqlalchemy.orm.events.InstrumentationEvents"><code class="xref py py-class docutils literal notranslate"><span class="pre">InstrumentationEvents</span></code></a> series of event targets have
documented that the events will only be fired off according to
the actual class passed as a target.  Through 0.7, this wasn’t the
case, and any event listener applied to <a class="reference internal" href="../orm/events.html#sqlalchemy.orm.events.InstrumentationEvents" title="sqlalchemy.orm.events.InstrumentationEvents"><code class="xref py py-class docutils literal notranslate"><span class="pre">InstrumentationEvents</span></code></a>
would be invoked for all classes mapped.  In 0.8, additional
logic has been added so that the events will only invoke for those
classes sent in.  The <code class="docutils literal notranslate"><span class="pre">propagate</span></code> flag here is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>
by default as class instrumentation events are typically used to
intercept classes that aren’t yet created.</p>
<p><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2590">#2590</a></p>
</div>
<div class="section" id="no-more-magic-coercion-of-to-in-when-comparing-to-subquery-in-ms-sql">
<h3>No more magic coercion of “=” to IN when comparing to subquery in MS-SQL<a class="headerlink" href="#no-more-magic-coercion-of-to-in-when-comparing-to-subquery-in-ms-sql" title="Permalink to this headline">¶</a></h3>
<p>We found a very old behavior in the MSSQL dialect which
would attempt to rescue users from themselves when
doing something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scalar_subq</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">someothertable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">someothertable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="o">==</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
<span class="n">select</span><span class="p">([</span><span class="n">sometable</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sometable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="n">scalar_subq</span><span class="p">)</span></pre></div>
</div>
<p>SQL Server doesn’t allow an equality comparison to a scalar
SELECT, that is, “x = (SELECT something)”. The MSSQL dialect
would convert this to an IN.   The same thing would happen
however upon a comparison like “(SELECT something) = x”, and
overall this level of guessing is outside of SQLAlchemy’s
usual scope so the behavior is removed.</p>
<p><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2277">#2277</a></p>
</div>
<div class="section" id="fixed-the-behavior-of-session-is-modified">
<h3>Fixed the behavior of <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.session.Session.is_modified" title="sqlalchemy.orm.session.Session.is_modified"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.is_modified()</span></code></a><a class="headerlink" href="#fixed-the-behavior-of-session-is-modified" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.session.Session.is_modified" title="sqlalchemy.orm.session.Session.is_modified"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.is_modified()</span></code></a> method accepts an argument
<code class="docutils literal notranslate"><span class="pre">passive</span></code> which basically should not be necessary, the
argument in all cases should be the value <code class="docutils literal notranslate"><span class="pre">True</span></code> - when
left at its default of <code class="docutils literal notranslate"><span class="pre">False</span></code> it would have the effect of
hitting the database, and often triggering autoflush which
would itself change the results.   In 0.8 the <code class="docutils literal notranslate"><span class="pre">passive</span></code>
argument will have no effect, and unloaded attributes will
never be checked for history since by definition there can
be no pending state change on an unloaded attribute.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.session.Session.is_modified" title="sqlalchemy.orm.session.Session.is_modified"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.is_modified()</span></code></a></p>
</div>
<p><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2320">#2320</a></p>
</div>
<div class="section" id="schema-column-key-is-honored-in-the-expression-select-c-attribute-of-expression-select-with-expression-select-apply-labels">
<h3><code class="xref py py-attr docutils literal notranslate"><span class="pre">Column.key</span></code> is honored in the <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.c" title="sqlalchemy.sql.expression.Select.c"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Select.c</span></code></a> attribute of <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.select" title="sqlalchemy.sql.expression.select"><code class="xref py py-func docutils literal notranslate"><span class="pre">select()</span></code></a> with <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.apply_labels" title="sqlalchemy.sql.expression.Select.apply_labels"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.apply_labels()</span></code></a><a class="headerlink" href="#schema-column-key-is-honored-in-the-expression-select-c-attribute-of-expression-select-with-expression-select-apply-labels" title="Permalink to this headline">¶</a></h3>
<p>Users of the expression system know that <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.apply_labels" title="sqlalchemy.sql.expression.Select.apply_labels"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.apply_labels()</span></code></a>
prepends the table name to each column name, affecting the
names that are available from <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.c" title="sqlalchemy.sql.expression.Select.c"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Select.c</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">table1</span><span class="p">])</span><span class="o">.</span><span class="n">apply_labels</span><span class="p">()</span>
<span class="n">s</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">table1_col1</span>
<span class="n">s</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">table1_col2</span></pre></div>
</div>
<p>Before 0.8, if the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> had a different <code class="xref py py-attr docutils literal notranslate"><span class="pre">Column.key</span></code>, this
key would be ignored, inconsistently versus when
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.apply_labels" title="sqlalchemy.sql.expression.Select.apply_labels"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.apply_labels()</span></code></a> were not used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># before 0.8</span>
<span class="n">table1</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&#39;t1&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;col1&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;column_one&#39;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">table1</span><span class="p">])</span>
<span class="n">s</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">column_one</span> <span class="c1"># would be accessible like this</span>
<span class="n">s</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">col1</span> <span class="c1"># would raise AttributeError</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">table1</span><span class="p">])</span><span class="o">.</span><span class="n">apply_labels</span><span class="p">()</span>
<span class="n">s</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">table1_column_one</span> <span class="c1"># would raise AttributeError</span>
<span class="n">s</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">table1_col1</span> <span class="c1"># would be accessible like this</span></pre></div>
</div>
<p>In 0.8, <code class="xref py py-attr docutils literal notranslate"><span class="pre">Column.key</span></code> is honored in both cases:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># with 0.8</span>
<span class="n">table1</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&#39;t1&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;col1&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;column_one&#39;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">table1</span><span class="p">])</span>
<span class="n">s</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">column_one</span> <span class="c1"># works</span>
<span class="n">s</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">col1</span> <span class="c1"># AttributeError</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">table1</span><span class="p">])</span><span class="o">.</span><span class="n">apply_labels</span><span class="p">()</span>
<span class="n">s</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">table1_column_one</span> <span class="c1"># works</span>
<span class="n">s</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">table1_col1</span> <span class="c1"># AttributeError</span></pre></div>
</div>
<p>All other behavior regarding “name” and “key” are the same,
including that the rendered SQL will still use the form
<code class="docutils literal notranslate"><span class="pre">&lt;tablename&gt;_&lt;colname&gt;</span></code> - the emphasis here was on
preventing the <code class="xref py py-attr docutils literal notranslate"><span class="pre">Column.key</span></code> contents from being rendered into the
<code class="docutils literal notranslate"><span class="pre">SELECT</span></code> statement so that there are no issues with
special/ non-ascii characters used in the <code class="xref py py-attr docutils literal notranslate"><span class="pre">Column.key</span></code>.</p>
<p><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2397">#2397</a></p>
</div>
<div class="section" id="single-parent-warning-is-now-an-error">
<h3>single_parent warning is now an error<a class="headerlink" href="#single-parent-warning-is-now-an-error" title="Permalink to this headline">¶</a></h3>
<p>A <a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> that is many-to-one or many-to-many and
specifies “cascade=’all, delete-orphan’”, which is an
awkward but nonetheless supported use case (with
restrictions) will now raise an error if the relationship
does not specify the <code class="docutils literal notranslate"><span class="pre">single_parent=True</span></code> option.
Previously it would only emit a warning, but a failure would
follow almost immediately within the attribute system in any
case.</p>
<p><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2405">#2405</a></p>
</div>
<div class="section" id="adding-the-inspector-argument-to-the-column-reflect-event">
<h3>Adding the <code class="docutils literal notranslate"><span class="pre">inspector</span></code> argument to the <code class="docutils literal notranslate"><span class="pre">column_reflect</span></code> event<a class="headerlink" href="#adding-the-inspector-argument-to-the-column-reflect-event" title="Permalink to this headline">¶</a></h3>
<p>0.7 added a new event called <code class="docutils literal notranslate"><span class="pre">column_reflect</span></code>, provided so
that the reflection of columns could be augmented as each
one were reflected.   We got this event slightly wrong in
that the event gave no way to get at the current
<code class="docutils literal notranslate"><span class="pre">Inspector</span></code> and <code class="docutils literal notranslate"><span class="pre">Connection</span></code> being used for the
reflection, in the case that additional information from the
database is needed.   As this is a new event not widely used
yet, we’ll be adding the <code class="docutils literal notranslate"><span class="pre">inspector</span></code> argument into it
directly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">Table</span><span class="p">,</span> <span class="s2">&quot;column_reflect&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">listen_for_col</span><span class="p">(</span><span class="n">inspector</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">column_info</span><span class="p">):</span>
    <span class="c1"># ...</span></pre></div>
</div>
<p><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2418">#2418</a></p>
</div>
<div class="section" id="disabling-auto-detect-of-collations-casing-for-mysql">
<h3>Disabling auto-detect of collations, casing for MySQL<a class="headerlink" href="#disabling-auto-detect-of-collations-casing-for-mysql" title="Permalink to this headline">¶</a></h3>
<p>The MySQL dialect does two calls, one very expensive, to
load all possible collations from the database as well as
information on casing, the first time an <code class="docutils literal notranslate"><span class="pre">Engine</span></code>
connects.   Neither of these collections are used for any
SQLAlchemy functions, so these calls will be changed to no
longer be emitted automatically. Applications that might
have relied on these collections being present on
<code class="docutils literal notranslate"><span class="pre">engine.dialect</span></code> will need to call upon
<code class="docutils literal notranslate"><span class="pre">_detect_collations()</span></code> and <code class="docutils literal notranslate"><span class="pre">_detect_casing()</span></code> directly.</p>
<p><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2404">#2404</a></p>
</div>
<div class="section" id="unconsumed-column-names-warning-becomes-an-exception">
<h3>“Unconsumed column names” warning becomes an exception<a class="headerlink" href="#unconsumed-column-names-warning-becomes-an-exception" title="Permalink to this headline">¶</a></h3>
<p>Referring to a non-existent column in an <code class="docutils literal notranslate"><span class="pre">insert()</span></code> or
<code class="docutils literal notranslate"><span class="pre">update()</span></code> construct will raise an error instead of a
warning:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t1</span> <span class="o">=</span> <span class="n">table</span><span class="p">(</span><span class="s1">&#39;t1&#39;</span><span class="p">,</span> <span class="n">column</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">))</span>
<span class="n">t1</span><span class="o">.</span><span class="n">insert</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="c1"># raises &quot;Unconsumed column names: z&quot;</span></pre></div>
</div>
<p><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2415">#2415</a></p>
</div>
<div class="section" id="inspector-get-primary-keys-is-deprecated-use-inspector-get-pk-constraint">
<h3>Inspector.get_primary_keys() is deprecated, use Inspector.get_pk_constraint<a class="headerlink" href="#inspector-get-primary-keys-is-deprecated-use-inspector-get-pk-constraint" title="Permalink to this headline">¶</a></h3>
<p>These two methods on <code class="docutils literal notranslate"><span class="pre">Inspector</span></code> were redundant, where
<code class="docutils literal notranslate"><span class="pre">get_primary_keys()</span></code> would return the same information as
<code class="docutils literal notranslate"><span class="pre">get_pk_constraint()</span></code> minus the name of the constraint:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">insp</span><span class="o">.</span><span class="n">get_primary_keys</span><span class="p">()</span>
<span class="go">[&quot;a&quot;, &quot;b&quot;]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">insp</span><span class="o">.</span><span class="n">get_pk_constraint</span><span class="p">()</span>
<span class="go">{&quot;name&quot;:&quot;pk_constraint&quot;, &quot;constrained_columns&quot;:[&quot;a&quot;, &quot;b&quot;]}</span></pre></div>
</div>
<p><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2422">#2422</a></p>
</div>
<div class="section" id="case-insensitive-result-row-names-will-be-disabled-in-most-cases">
<h3>Case-insensitive result row names will be disabled in most cases<a class="headerlink" href="#case-insensitive-result-row-names-will-be-disabled-in-most-cases" title="Permalink to this headline">¶</a></h3>
<p>A very old behavior, the column names in <code class="docutils literal notranslate"><span class="pre">RowProxy</span></code> were
always compared case-insensitively:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">row</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;FOO&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Foo&#39;</span><span class="p">]</span>
<span class="go">True</span></pre></div>
</div>
<p>This was for the benefit of a few dialects which in the
early days needed this, like Oracle and Firebird, but in
modern usage we have more accurate ways of dealing with the
case-insensitive behavior of these two platforms.</p>
<p>Going forward, this behavior will be available only
optionally, by passing the flag <code class="docutils literal notranslate"><span class="pre">`case_sensitive=False`</span></code>
to <code class="docutils literal notranslate"><span class="pre">`create_engine()`</span></code>, but otherwise column names
requested from the row must match as far as casing.</p>
<p><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2423">#2423</a></p>
</div>
<div class="section" id="instrumentationmanager-and-alternate-class-instrumentation-is-now-an-extension">
<h3><code class="docutils literal notranslate"><span class="pre">InstrumentationManager</span></code> and alternate class instrumentation is now an extension<a class="headerlink" href="#instrumentationmanager-and-alternate-class-instrumentation-is-now-an-extension" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm.interfaces.InstrumentationManager</span></code>
class is moved to
<code class="docutils literal notranslate"><span class="pre">sqlalchemy.ext.instrumentation.InstrumentationManager</span></code>.
The “alternate instrumentation” system was built for the
benefit of a very small number of installations that needed
to work with existing or unusual class instrumentation
systems, and generally is very seldom used.   The complexity
of this system has been exported to an <code class="docutils literal notranslate"><span class="pre">ext.</span></code> module.  It
remains unused until once imported, typically when a third
party library imports <code class="docutils literal notranslate"><span class="pre">InstrumentationManager</span></code>, at which
point it is injected back into <code class="docutils literal notranslate"><span class="pre">sqlalchemy.orm</span></code> by
replacing the default <code class="docutils literal notranslate"><span class="pre">InstrumentationFactory</span></code> with
<code class="docutils literal notranslate"><span class="pre">ExtendedInstrumentationRegistry</span></code>.</p>
</div>
</div>
<div class="section" id="removed">
<h2>Removed<a class="headerlink" href="#removed" title="Permalink to this headline">¶</a></h2>
<div class="section" id="sqlsoup">
<h3>SQLSoup<a class="headerlink" href="#sqlsoup" title="Permalink to this headline">¶</a></h3>
<p>SQLSoup is a handy package that presents an alternative
interface on top of the SQLAlchemy ORM.   SQLSoup is now
moved into its own project and documented/released
separately; see <a class="reference external" href="https://bitbucket.org/zzzeek/sqlsoup">https://bitbucket.org/zzzeek/sqlsoup</a>.</p>
<p>SQLSoup is a very simple tool that could also benefit from
contributors who are interested in its style of usage.</p>
<p><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2262">#2262</a></p>
</div>
<div class="section" id="mutabletype">
<h3>MutableType<a class="headerlink" href="#mutabletype" title="Permalink to this headline">¶</a></h3>
<p>The older “mutable” system within the SQLAlchemy ORM has
been removed.   This refers to the <code class="docutils literal notranslate"><span class="pre">MutableType</span></code> interface
which was applied to types such as <code class="docutils literal notranslate"><span class="pre">PickleType</span></code> and
conditionally to <code class="docutils literal notranslate"><span class="pre">TypeDecorator</span></code>, and since very early
SQLAlchemy versions has provided a way for the ORM to detect
changes in so-called “mutable” data structures such as JSON
structures and pickled objects.   However, the
implementation was never reasonable and forced a very
inefficient mode of usage on the unit-of-work which caused
an expensive scan of all objects to take place during flush.
In 0.7, the <a class="reference external" href="http://docs.sqlalchemy.org/en/latest/orm/extensions/mutable.html">sqlalchemy.ext.mutable</a> extension was
introduced so that user-defined datatypes can appropriately
send events to the unit of work as changes occur.</p>
<p>Today, usage of <code class="docutils literal notranslate"><span class="pre">MutableType</span></code> is expected to be low, as
warnings have been in place for some years now regarding its
inefficiency.</p>
<p><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2442">#2442</a></p>
</div>
<div class="section" id="sqlalchemy-exceptions-has-been-sqlalchemy-exc-for-years">
<h3>sqlalchemy.exceptions (has been sqlalchemy.exc for years)<a class="headerlink" href="#sqlalchemy-exceptions-has-been-sqlalchemy-exc-for-years" title="Permalink to this headline">¶</a></h3>
<p>We had left in an alias <code class="docutils literal notranslate"><span class="pre">sqlalchemy.exceptions</span></code> to attempt
to make it slightly easier for some very old libraries that
hadn’t yet been upgraded to use <code class="docutils literal notranslate"><span class="pre">sqlalchemy.exc</span></code>.  Some
users are still being confused by it however so in 0.8 we’re
taking it out entirely to eliminate any of that confusion.</p>
<p><a class="reference external" href="http://www.sqlalchemy.org/trac/ticket/2433">#2433</a></p>
</div>
</div>
</div>

    </div>

</div>

<div id="docs-bottom-navigation" class="docs-navigation-links, withsidebar">
        Previous:
        <a href="migration_09.html" title="previous chapter">What’s New in SQLAlchemy 0.9?</a>
        Next:
        <a href="migration_07.html" title="next chapter">What’s New in SQLAlchemy 0.7?</a>

    <div id="docs-copyright">
        &copy; <a href="../copyright.html">Copyright</a> 2007-2020, the SQLAlchemy authors and contributors.
        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 3.0.3.
    </div>
</div>

</div>



        
        

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
          URL_ROOT:    '../',
          VERSION:     '1.3.17',
          COLLAPSE_MODINDEX: false,
          FILE_SUFFIX: '.html'
      };
    </script>

    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>

    <!-- begin iterate through sphinx environment script_files -->
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    <!-- end iterate through sphinx environment script_files -->

    <script type="text/javascript" src="../_static/detectmobile.js"></script>
    <script type="text/javascript" src="../_static/init.js"></script>


    </body>
</html>


