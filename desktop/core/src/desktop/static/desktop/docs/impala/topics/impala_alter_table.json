{"body":"<div><div id=\"alter_table\"><div class=\"hue-doc-title\">ALTER TABLE Statement</div><div><p>\n      The <span class=\"hue-doc-codeph\">ALTER TABLE</span> statement changes the structure or properties of an\n      existing Impala table.\n    </p><p>\n      In Impala, this is primarily a logical operation that updates the table metadata in the\n      metastore database that Impala shares with Hive. Most <span class=\"hue-doc-codeph\">ALTER TABLE</span>\n      operations do not actually rewrite, move, and so on the actual data files. (The\n      <span class=\"hue-doc-codeph\">RENAME TO</span> clause is the one exception; it can cause HDFS files to be\n      moved to different paths.) When you do an <span class=\"hue-doc-codeph\">ALTER TABLE</span> operation, you\n      typically need to perform corresponding physical filesystem operations, such as rewriting\n      the data files to include extra fields, or converting them to a different file format.\n    </p><p id=\"syntax_blurb\"><b>Syntax:</b></p><div class=\"hue-doc-codeblock\">ALTER TABLE [<span class=\"hue-doc-varname\">old_db_name</span>.]<span class=\"hue-doc-varname\">old_table_name</span> RENAME TO [<span class=\"hue-doc-varname\">new_db_name</span>.]<span class=\"hue-doc-varname\">new_table_name</span>\n\nALTER TABLE <span class=\"hue-doc-varname\">name</span> ADD COLUMNS (<span class=\"hue-doc-varname\">col_spec</span>[, <span class=\"hue-doc-varname\">col_spec</span> ...])\nALTER TABLE <span class=\"hue-doc-varname\">name</span> DROP [COLUMN] <span class=\"hue-doc-varname\">column_name</span>\nALTER TABLE <span class=\"hue-doc-varname\">name</span> CHANGE <span class=\"hue-doc-varname\">column_name</span><span class=\"hue-doc-varname\">col_spec</span>\n\nALTER TABLE <span class=\"hue-doc-varname\">name</span> REPLACE COLUMNS (<span class=\"hue-doc-varname\">col_spec</span>[, <span class=\"hue-doc-varname\">col_spec</span> ...])\n\n<span class=\"hue-doc-ph\">ALTER TABLE <span class=\"hue-doc-varname\">name</span> SET OWNER USER <span class=\"hue-doc-varname\">user_name</span>\nALTER TABLE <span class=\"hue-doc-varname\">name</span> SET OWNER ROLE <span class=\"hue-doc-varname\">role_name</span></span><span class=\"hue-doc-ph\">-- Kudu tables only.\nALTER TABLE <span class=\"hue-doc-varname\">name</span> ALTER [COLUMN] <span class=\"hue-doc-varname\">column_name</span>\n  { SET <span class=\"hue-doc-varname\">kudu_storage_attr</span><span class=\"hue-doc-varname\">attr_value</span>\n    | DROP DEFAULT }\n\nkudu_storage_attr ::= { DEFAULT | BLOCK_SIZE | ENCODING | COMPRESSION }</span><span class=\"hue-doc-ph\">-- Non-Kudu tables only.\nALTER TABLE <span class=\"hue-doc-varname\">name</span> ALTER [COLUMN] <span class=\"hue-doc-varname\">column_name</span>\n  SET COMMENT '<span class=\"hue-doc-varname\">comment_text</span>'</span>\n\nALTER TABLE <span class=\"hue-doc-varname\">name</span> ADD [IF NOT EXISTS] PARTITION (<span class=\"hue-doc-varname\">partition_spec</span>)\n  <span class=\"hue-doc-ph\">[<span class=\"hue-doc-varname\">location_spec</span>]</span><span class=\"hue-doc-ph\">[<span class=\"hue-doc-varname\">cache_spec</span>]</span><span class=\"hue-doc-ph\">ALTER TABLE <span class=\"hue-doc-varname\">name</span> ADD [IF NOT EXISTS] RANGE PARTITION <span class=\"hue-doc-varname\">kudu_partition_spec</span></span>\n\nALTER TABLE <span class=\"hue-doc-varname\">name</span> DROP [IF EXISTS] PARTITION (<span class=\"hue-doc-varname\">partition_spec</span>)\n  <span class=\"hue-doc-ph\">[PURGE]</span><span class=\"hue-doc-ph\">ALTER TABLE <span class=\"hue-doc-varname\">name</span> DROP [IF EXISTS] RANGE PARTITION <span class=\"hue-doc-varname\">kudu_partition_spec</span></span><span class=\"hue-doc-ph\">ALTER TABLE <span class=\"hue-doc-varname\">name</span> RECOVER PARTITIONS</span>\n\nALTER TABLE <span class=\"hue-doc-varname\">name</span> [PARTITION (<span class=\"hue-doc-varname\">partition_spec</span>)]\n  SET { FILEFORMAT <span class=\"hue-doc-varname\">file_format</span>\n  | ROW FORMAT <span class=\"hue-doc-varname\">row_format</span>\n  | LOCATION '<span class=\"hue-doc-varname\">hdfs_path_of_directory</span>'\n  | TBLPROPERTIES (<span class=\"hue-doc-varname\">table_properties</span>)\n  | SERDEPROPERTIES (<span class=\"hue-doc-varname\">serde_properties</span>) }\n\n<span class=\"hue-doc-ph\">ALTER TABLE <span class=\"hue-doc-varname\">name</span><span class=\"hue-doc-varname\">colname</span>\n  ('<span class=\"hue-doc-varname\">statsKey</span>'='<span class=\"hue-doc-varname\">val</span>, ...)\n\nstatsKey ::= numDVs | numNulls | avgSize | maxSize</span><span class=\"hue-doc-ph\">ALTER TABLE <span class=\"hue-doc-varname\">name</span> [PARTITION (<span class=\"hue-doc-varname\">partition_spec</span>)] SET { CACHED IN '<span class=\"hue-doc-varname\">pool_name</span>' <span class=\"hue-doc-ph\">[WITH REPLICATION = <span class=\"hue-doc-varname\">integer</span>]</span> | UNCACHED }</span><span class=\"hue-doc-varname\">new_name</span> ::= [<span class=\"hue-doc-varname\">new_database</span>.]<span class=\"hue-doc-varname\">new_table_name</span><span class=\"hue-doc-varname\">col_spec</span> ::= <span class=\"hue-doc-varname\">col_name</span><span class=\"hue-doc-varname\">type_name</span><span class=\"hue-doc-ph\"> COMMENT '<span class=\"hue-doc-varname\">column-comment</span>' [<span class=\"hue-doc-varname\">kudu_attributes</span>]</span><span class=\"hue-doc-ph\"><span class=\"hue-doc-varname\">kudu_attributes</span> ::= { [NOT] NULL | ENCODING <span class=\"hue-doc-varname\">codec</span> | COMPRESSION <span class=\"hue-doc-varname\">algorithm</span> |\n  DEFAULT <span class=\"hue-doc-varname\">constant</span> | BLOCK_SIZE <span class=\"hue-doc-varname\">number</span> }</span><span class=\"hue-doc-varname\">partition_spec</span> ::= <span class=\"hue-doc-varname\">simple_partition_spec</span> | <span class=\"hue-doc-ph\"><span class=\"hue-doc-varname\">complex_partition_spec</span></span><span class=\"hue-doc-varname\">simple_partition_spec</span> ::= <span class=\"hue-doc-varname\">partition_col</span>=<span class=\"hue-doc-varname\">constant_value</span><span class=\"hue-doc-ph\"><span class=\"hue-doc-varname\">complex_partition_spec</span> ::= <span class=\"hue-doc-varname\">comparison_expression_on_partition_col</span></span><span class=\"hue-doc-ph\"><span class=\"hue-doc-varname\">kudu_partition_spec</span> ::= <span class=\"hue-doc-varname\">constant</span><span class=\"hue-doc-varname\">range_operator</span> VALUES <span class=\"hue-doc-varname\">range_operator</span><span class=\"hue-doc-varname\">constant</span> | VALUE = <span class=\"hue-doc-varname\">constant</span></span><span class=\"hue-doc-ph\">cache_spec ::= CACHED IN '<span class=\"hue-doc-varname\">pool_name</span>' [WITH REPLICATION = <span class=\"hue-doc-varname\">integer</span>] | UNCACHED</span><span class=\"hue-doc-ph\">location_spec ::= LOCATION '<span class=\"hue-doc-varname\">hdfs_path_of_directory</span>'</span><span class=\"hue-doc-varname\">table_properties</span> ::= '<span class=\"hue-doc-varname\">name</span>'='<span class=\"hue-doc-varname\">value</span>'[, '<span class=\"hue-doc-varname\">name</span>'='<span class=\"hue-doc-varname\">value</span>' ...]\n\n<span class=\"hue-doc-varname\">serde_properties</span> ::= '<span class=\"hue-doc-varname\">name</span>'='<span class=\"hue-doc-varname\">value</span>'[, '<span class=\"hue-doc-varname\">name</span>'='<span class=\"hue-doc-varname\">value</span>' ...]\n\n<span class=\"hue-doc-varname\">file_format</span> ::= { PARQUET | TEXTFILE | RCFILE | SEQUENCEFILE | AVRO }\n\n<span class=\"hue-doc-varname\">row_format</span> ::= DELIMITED\n  [FIELDS TERMINATED BY '<span class=\"hue-doc-varname\">char</span>' [ESCAPED BY '<span class=\"hue-doc-varname\">char</span>']]\n  [LINES TERMINATED BY '<span class=\"hue-doc-varname\">char</span>']</div><p id=\"ddl_blurb\"><b>Statement type:</b> DDL\n      </p><p id=\"complex_types_blurb\"><b>Complex type considerations:</b></p><p>\n      In Impala 2.3 and higher, the <span class=\"hue-doc-codeph\">ALTER TABLE</span>\n      statement can change the metadata for tables containing complex types\n      (<span class=\"hue-doc-codeph\">ARRAY</span>, <span class=\"hue-doc-codeph\">STRUCT</span>, and <span class=\"hue-doc-codeph\">MAP</span>). For example,\n      you can use an <span class=\"hue-doc-codeph\">ADD COLUMNS</span>, <span class=\"hue-doc-codeph\">DROP COLUMN</span>, or\n      <span class=\"hue-doc-codeph\">CHANGE</span> clause to modify the table layout for complex type columns.\n      Although Impala queries only work for complex type columns in Parquet tables, the complex\n      type support in the <span class=\"hue-doc-codeph\">ALTER TABLE</span> statement applies to all file formats.\n      For example, you can use Impala to update metadata for a staging table in a non-Parquet\n      file format where the data is populated by Hive. Or you can use <span class=\"hue-doc-codeph\">ALTER TABLE SET\n      FILEFORMAT</span> to change the format of an existing table to Parquet so that Impala\n      can query it. Remember that changing the file format for a table does not convert the data\n      files within the table; you must prepare any Parquet data files containing complex types\n      outside Impala, and bring them into the table using <span class=\"hue-doc-codeph\">LOAD DATA</span> or updating\n      the table's <span class=\"hue-doc-codeph\">LOCATION</span> property. See\n      <a class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"topics/impala_complex_types.xml\" data-doc-anchor-id=\"complex_types\">Complex Types (Impala 2.3 or higher only)</a> for details about using\n      complex types.\n    </p><p id=\"usage_notes_blurb\"><b>Usage notes:</b></p><p>\n      Whenever you specify partitions in an <span class=\"hue-doc-codeph\">ALTER TABLE</span> statement, through the\n      <span class=\"hue-doc-codeph\">PARTITION (<span class=\"hue-doc-varname\">partition_spec</span>)</span> clause, you must include\n      all the partitioning columns in the specification.\n    </p><p>\n      Most of the <span class=\"hue-doc-codeph\">ALTER TABLE</span> operations work the same for internal tables\n      (managed by Impala) as for external tables (with data files located in arbitrary\n      locations). The exception is renaming a table; for an external table, the underlying data\n      directory is not renamed or moved.\n    </p><p><b>To drop or alter multiple partitions:</b></p><p>\n      In Impala 2.8 and higher, the expression for the partition clause\n      with a <span class=\"hue-doc-codeph\">DROP</span> or <span class=\"hue-doc-codeph\">SET</span> operation can include comparison\n      operators such as <span class=\"hue-doc-codeph\">&lt;</span>, <span class=\"hue-doc-codeph\">IN</span>, or <span class=\"hue-doc-codeph\">BETWEEN</span>,\n      and Boolean operators such as <span class=\"hue-doc-codeph\">AND</span> and <span class=\"hue-doc-codeph\">OR</span>.\n    </p><p>\n      For example, you might drop a group of partitions corresponding to a particular date range\n      after the data <q>ages out</q>:\n    </p><div class=\"hue-doc-codeblock\">alter table historical_data drop partition (year &lt; 1995);\nalter table historical_data drop partition (year = 1996 and month between 1 and 6);\n</div><p>\n      For tables with multiple partition keys columns, you can specify multiple conditions\n      separated by commas, and the operation only applies to the partitions that match all the\n      conditions (similar to using an <span class=\"hue-doc-codeph\">AND</span> clause):\n    </p><div class=\"hue-doc-codeblock\">alter table historical_data drop partition (year &lt; 1995, last_name like 'A%');\n</div><p>\n      This technique can also be used to change the file format of groups of partitions, as part\n      of an ETL pipeline that periodically consolidates and rewrites the underlying data files\n      in a different file format:\n    </p><div class=\"hue-doc-codeblock\">alter table fast_growing_data partition (year = 2016, month in (10,11,12)) set fileformat parquet;\n</div><div class=\"hue-doc-note\"><p>\n        The extended syntax involving comparison operators and multiple partitions applies to\n        the <span class=\"hue-doc-codeph\">SET FILEFORMAT</span>, <span class=\"hue-doc-codeph\">SET TBLPROPERTIES</span>, <span class=\"hue-doc-codeph\">SET\n        SERDEPROPERTIES</span>, and <span class=\"hue-doc-codeph\">SET [UN]CACHED</span> clauses. You can also use\n        this syntax with the <span class=\"hue-doc-codeph\">PARTITION</span> clause in the <span class=\"hue-doc-codeph\">COMPUTE\n        INCREMENTAL STATS</span> statement, and with the <span class=\"hue-doc-codeph\">PARTITION</span> clause of\n        the <span class=\"hue-doc-codeph\">SHOW FILES</span> statement. Some forms of <span class=\"hue-doc-codeph\">ALTER TABLE</span>\n        still only apply to one partition at a time: the <span class=\"hue-doc-codeph\">SET LOCATION</span> and\n        <span class=\"hue-doc-codeph\">ADD PARTITION</span> clauses. The <span class=\"hue-doc-codeph\">PARTITION</span> clauses in the\n        <span class=\"hue-doc-codeph\">LOAD DATA</span> and <span class=\"hue-doc-codeph\">INSERT</span> statements also only apply to one\n        partition at a time.\n      </p><p>\n        A DDL statement that applies to multiple partitions is considered successful (resulting\n        in no changes) even if no partitions match the conditions. The results are the same as\n        if the <span class=\"hue-doc-codeph\">IF EXISTS</span> clause was specified.\n      </p><p>\n        The performance and scalability of this technique is similar to issuing a sequence of\n        single-partition <span class=\"hue-doc-codeph\">ALTER TABLE</span> statements in quick succession. To\n        minimize bottlenecks due to communication with the metastore database, or causing other\n        DDL operations on the same table to wait, test the effects of performing <span class=\"hue-doc-codeph\">ALTER\n        TABLE</span> statements that affect large numbers of partitions.\n      </p></div><p id=\"s3_blurb\"><b>Amazon S3 considerations:</b></p><p>\n      You can specify an <span class=\"hue-doc-codeph\">s3a://</span> prefix on the <span class=\"hue-doc-codeph\">LOCATION</span>\n      attribute of a table or partition to make Impala query data from the Amazon S3 filesystem.\n      In Impala 2.6 and higher, Impala automatically handles\n      creating or removing the associated folders when you issue <span class=\"hue-doc-codeph\">ALTER TABLE</span>\n      statements with the <span class=\"hue-doc-codeph\">ADD PARTITION</span> or <span class=\"hue-doc-codeph\">DROP PARTITION</span>\n      clauses.\n    </p><p id=\"s3_ddl\">\n        In Impala 2.6 and higher, Impala DDL statements such as\n        <span class=\"hue-doc-codeph\">CREATE DATABASE</span>, <span class=\"hue-doc-codeph\">CREATE TABLE</span>, <span class=\"hue-doc-codeph\">DROP DATABASE CASCADE</span>,\n        <span class=\"hue-doc-codeph\">DROP TABLE</span>, and <span class=\"hue-doc-codeph\">ALTER TABLE [ADD|DROP] PARTITION</span> can create or remove folders\n        as needed in the Amazon S3 system. Prior to Impala 2.6, you had to create folders yourself and point\n        Impala database, tables, or partitions at them, and manually remove folders when no longer needed.\n        See <a class=\"hue-doc-external-link\" href=\"https://www.cloudera.com/documentation/enterprise/latest/topics/impala_s3.html#s3\" target=\"_blank\">Using Impala with the Amazon S3 Filesystem</a> for details about reading and writing S3 data with Impala.\n      </p><p><b>HDFS caching (CACHED IN clause):</b></p><p>\n      If you specify the <span class=\"hue-doc-codeph\">CACHED IN</span> clause, any existing or future data files in\n      the table directory or the partition subdirectories are designated to be loaded into\n      memory with the HDFS caching mechanism. See\n      <a class=\"hue-doc-external-link\" href=\"https://www.cloudera.com/documentation/enterprise/latest/topics/impala_perf_hdfs_caching.html#hdfs_caching\" target=\"_blank\">Using HDFS Caching with Impala (Impala 2.1 or higher only)</a> for details about using\n      the HDFS caching feature.\n    </p><p id=\"impala_cache_replication_factor\">\n        In Impala 2.2 and higher, the optional <span class=\"hue-doc-codeph\">WITH REPLICATION</span> clause\n        for <span class=\"hue-doc-codeph\">CREATE TABLE</span> and <span class=\"hue-doc-codeph\">ALTER TABLE</span> lets you specify\n        a <span class=\"hue-doc-term\">replication factor</span>, the number of hosts on which to cache the same data blocks.\n        When Impala processes a cached data block, where the cache replication factor is greater than 1, Impala randomly\n        selects a host that has a cached copy of that data block. This optimization avoids excessive CPU\n        usage on a single host when the same cached data block is processed multiple times.\n        Where practical, specify a value greater than or equal to the HDFS block replication factor.\n      </p><p id=\"sync_ddl_blurb\">\n        If you connect to different Impala nodes within an <span class=\"hue-doc-cmdname\">impala-shell</span> session for\n        load-balancing purposes, you can enable the <span class=\"hue-doc-codeph\">SYNC_DDL</span> query option to make each DDL\n        statement wait before returning, until the new or changed metadata has been received by all the Impala\n        nodes. See <a class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"topics/impala_sync_ddl.xml\" data-doc-anchor-id=\"sync_ddl\">SYNC_DDL Query Option</a> for details.\n      </p><p><b>To rename a table (RENAME TO clause):</b></p><p>\n      The <span class=\"hue-doc-codeph\">RENAME TO</span> clause lets you change the name of an existing table, and\n      optionally which database it is located in.\n    </p><p>\n      For internal tables, this operation physically renames the directory within HDFS that\n      contains the data files; the original directory name no longer exists. By qualifying the\n      table names with database names, you can use this technique to move an internal table (and\n      its associated data directory) from one database to another. For example:\n    </p><div class=\"hue-doc-codeblock\">create database d1;\ncreate database d2;\ncreate database d3;\nuse d1;\ncreate table mobile (x int);\nuse d2;\n-- Move table from another database to the current one.\nalter table d1.mobile rename to mobile;\nuse d1;\n-- Move table from one database to another.\nalter table d2.mobile rename to d3.mobile;</div><p><b>To change the owner of a table:</b></p><div class=\"hue-doc-codeblock\">ALTER TABLE <span class=\"hue-doc-varname\">name</span> SET OWNER USER <span class=\"hue-doc-varname\">user_name;</span>\nALTER TABLE <span class=\"hue-doc-varname\">name</span> SET OWNER ROLE <span class=\"hue-doc-varname\">role_name;</span></div><p>\n      The table owner is originally set to the user who creates the table. When object ownership\n      is enabled in Sentry, an owner of a table can have the <span class=\"hue-doc-codeph\">ALL</span> with\n      <span class=\"hue-doc-codeph\">GRANT</span> or <span class=\"hue-doc-codeph\">ALL</span> without <span class=\"hue-doc-codeph\">GRANT</span> privilege.\n      The term <span class=\"hue-doc-codeph\">OWNER</span> is used to differentiate between the <span class=\"hue-doc-codeph\">ALL</span>\n      privilege that is explicitly granted via the <span class=\"hue-doc-codeph\">GRANT</span> statement and a\n      privilege that is implicitly granted by the <span class=\"hue-doc-codeph\">CREATE TABLE</span> statement.\n    </p><p>\n      Use the <span class=\"hue-doc-codeph\">ALTER TABLE SET OWNER</span> to transfer the ownership from the current\n      owner to another user or a role.\n    </p><p><b>To change the physical location where Impala looks for data files associated with a\n      table or partition:</b></p><div class=\"hue-doc-codeblock\">ALTER TABLE <span class=\"hue-doc-varname\">table_name</span> [PARTITION (<span class=\"hue-doc-varname\">partition_spec</span>)] SET LOCATION '<span class=\"hue-doc-varname\">hdfs_path_of_directory</span>';</div><p>\n      The path you specify is the full HDFS path where the data files reside, or will be\n      created. Impala does not create any additional subdirectory named after the table. Impala\n      does not move any data files to this new location or change any data files that might\n      already exist in that directory.\n    </p><p>\n      To set the location for a single partition, include the <span class=\"hue-doc-codeph\">PARTITION</span> clause.\n      Specify all the same partitioning columns for the table, with a constant value for each,\n      to precisely identify the single partition affected by the statement:\n    </p><div class=\"hue-doc-codeblock\">create table p1 (s string) partitioned by (month int, day int);\n-- Each ADD PARTITION clause creates a subdirectory in HDFS.\nalter table p1 add partition (month=1, day=1);\nalter table p1 add partition (month=1, day=2);\nalter table p1 add partition (month=2, day=1);\nalter table p1 add partition (month=2, day=2);\n-- Redirect queries, INSERT, and LOAD DATA for one partition\n-- to a specific different directory.\nalter table p1 partition (month=1, day=1) set location '/usr/external_data/new_years_day';\n</div><div class=\"hue-doc-note\" id=\"add_partition_set_location\">        If you are creating a partition for the first time and specifying its location, for maximum efficiency, use\n        a single <span class=\"hue-doc-codeph\">ALTER TABLE</span> statement including both the <span class=\"hue-doc-codeph\">ADD PARTITION</span> and\n        <span class=\"hue-doc-codeph\">LOCATION</span> clauses, rather than separate statements with <span class=\"hue-doc-codeph\">ADD PARTITION</span> and\n        <span class=\"hue-doc-codeph\">SET LOCATION</span> clauses.\n      </div><p><b>To automatically detect new partition directories added through Hive or HDFS\n      operations:</b></p><p>\n      In Impala 2.3 and higher, the <span class=\"hue-doc-codeph\">RECOVER PARTITIONS</span>\n      clause scans a partitioned table to detect if any new partition directories were added\n      outside of Impala, such as by Hive <span class=\"hue-doc-codeph\">ALTER TABLE</span> statements or by\n      <span class=\"hue-doc-cmdname\">hdfs dfs</span> or <span class=\"hue-doc-cmdname\">hadoop fs</span> commands. The <span class=\"hue-doc-codeph\">RECOVER\n      PARTITIONS</span> clause automatically recognizes any data files present in these new\n      directories, the same as the <span class=\"hue-doc-codeph\">REFRESH</span> statement does.\n    </p><p>\n      For example, here is a sequence of examples showing how you might create a partitioned\n      table in Impala, create new partitions through Hive, copy data files into the new\n      partitions with the <span class=\"hue-doc-cmdname\">hdfs</span> command, and have Impala recognize the new\n      partitions and new data:\n    </p><p>\n      In Impala, create the table, and a single partition for demonstration purposes:\n    </p><div class=\"hue-doc-codeblock\">create database recover_partitions;\nuse recover_partitions;\ncreate table t1 (s string) partitioned by (yy int, mm int);\ninsert into t1 partition (yy = 2016, mm = 1) values ('Partition exists');\nshow files in t1;\n+---------------------------------------------------------------------+------+--------------+\n| Path                                                                | Size | Partition    |\n+---------------------------------------------------------------------+------+--------------+\n| /user/hive/warehouse/recover_partitions.db/t1/yy=2016/mm=1/data.txt | 17B  | yy=2016/mm=1 |\n+---------------------------------------------------------------------+------+--------------+\nquit;\n</div><p>\n      In Hive, create some new partitions. In a real use case, you might create the partitions\n      and populate them with data as the final stages of an ETL pipeline.\n    </p><div class=\"hue-doc-codeblock\">hive&gt; use recover_partitions;\nOK\nhive&gt; alter table t1 add partition (yy = 2016, mm = 2);\nOK\nhive&gt; alter table t1 add partition (yy = 2016, mm = 3);\nOK\nhive&gt; quit;\n</div><p>\n      For demonstration purposes, manually copy data (a single row) into these new partitions,\n      using manual HDFS operations:\n    </p><div class=\"hue-doc-codeblock\">$ hdfs dfs -ls /user/hive/warehouse/recover_partitions.db/t1/yy=2016/\nFound 3 items\ndrwxr-xr-x - impala   hive 0 2016-05-09 16:06 /user/hive/warehouse/recover_partitions.db/t1/yy=2016/mm=1\ndrwxr-xr-x - jrussell hive 0 2016-05-09 16:14 /user/hive/warehouse/recover_partitions.db/t1/yy=2016/mm=2\ndrwxr-xr-x - jrussell hive 0 2016-05-09 16:13 /user/hive/warehouse/recover_partitions.db/t1/yy=2016/mm=3\n\n$ hdfs dfs -cp /user/hive/warehouse/recover_partitions.db/t1/yy=2016/mm=1/data.txt \\\n  /user/hive/warehouse/recover_partitions.db/t1/yy=2016/mm=2/data.txt\n$ hdfs dfs -cp /user/hive/warehouse/recover_partitions.db/t1/yy=2016/mm=1/data.txt \\\n  /user/hive/warehouse/recover_partitions.db/t1/yy=2016/mm=3/data.txt\n</div><div class=\"hue-doc-codeblock\">hive&gt; select * from t1;\nOK\nPartition exists  2016  1\nPartition exists  2016  2\nPartition exists  2016  3\nhive&gt; quit;\n</div><p>\n      In Impala, initially the partitions and data are not visible. Running <span class=\"hue-doc-codeph\">ALTER\n      TABLE</span> with the <span class=\"hue-doc-codeph\">RECOVER PARTITIONS</span> clause scans the table data\n      directory to find any new partition directories, and the data files inside them:\n    </p><div class=\"hue-doc-codeblock\">select * from t1;\n+------------------+------+----+\n| s                | yy   | mm |\n+------------------+------+----+\n| Partition exists | 2016 | 1  |\n+------------------+------+----+\n\nalter table t1 recover partitions;\nselect * from t1;\n+------------------+------+----+\n| s                | yy   | mm |\n+------------------+------+----+\n| Partition exists | 2016 | 1  |\n| Partition exists | 2016 | 3  |\n| Partition exists | 2016 | 2  |\n+------------------+------+----+\n</div><p><b>To change the key-value pairs of the TBLPROPERTIES and SERDEPROPERTIES fields:</b></p><div class=\"hue-doc-codeblock\">ALTER TABLE <span class=\"hue-doc-varname\">table_name</span> SET TBLPROPERTIES ('<span class=\"hue-doc-varname\">key1</span>'='<span class=\"hue-doc-varname\">value1</span>', '<span class=\"hue-doc-varname\">key2</span>'='<span class=\"hue-doc-varname\">value2</span>'[, ...]);\nALTER TABLE <span class=\"hue-doc-varname\">table_name</span> SET SERDEPROPERTIES ('<span class=\"hue-doc-varname\">key1</span>'='<span class=\"hue-doc-varname\">value1</span>', '<span class=\"hue-doc-varname\">key2</span>'='<span class=\"hue-doc-varname\">value2</span>'[, ...]);</div><p>\n      The <span class=\"hue-doc-codeph\">TBLPROPERTIES</span> clause is primarily a way to associate arbitrary\n      user-specified data items with a particular table.\n    </p><p>\n      The <span class=\"hue-doc-codeph\">SERDEPROPERTIES</span> clause sets up metadata defining how tables are read\n      or written, needed in some cases by Hive but not used extensively by Impala. You would use\n      this clause primarily to change the delimiter in an existing text table or partition, by\n      setting the <span class=\"hue-doc-codeph\">'serialization.format'</span> and <span class=\"hue-doc-codeph\">'field.delim'</span>\n      property values to the new delimiter character: The <span class=\"hue-doc-codeph\">SERDEPROPERTIES</span>\n      clause does not change the existing data in the table. The change only affects the future\n      insert into the table.\n    </p><p>\n      Use the <span class=\"hue-doc-codeph\">DESCRIBE FORMATTED</span> statement to see the current values of these\n      properties for an existing table. See\n      <a class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"topics/impala_create_table.xml\" data-doc-anchor-id=\"create_table\">CREATE TABLE Statement</a> for more details about these\n      clauses.\n    </p><p><b>To manually set or update table or column statistics:</b></p><p>\n      Although for most tables the <span class=\"hue-doc-codeph\">COMPUTE STATS</span> or <span class=\"hue-doc-codeph\">COMPUTE INCREMENTAL\n      STATS</span> statement is all you need to keep table and column statistics up to date\n      for a table, sometimes for a very large table or one that is updated frequently, the\n      length of time to recompute all the statistics might make it impractical to run those\n      statements as often as needed. As a workaround, you can use the <span class=\"hue-doc-codeph\">ALTER\n      TABLE</span> statement to set table statistics at the level of the entire table or a\n      single partition, or column statistics at the level of the entire table.\n    </p><p> You can set the <span class=\"hue-doc-codeph\">numrows</span> value for table statistics by\n      changing the <span class=\"hue-doc-codeph\">TBLPROPERTIES</span> setting for a table or\n      partition. For example: <div class=\"hue-doc-codeblock\" id=\"set_numrows_example\">create table analysis_data stored as parquet as select * from raw_data;\nInserted 1000000000 rows in 181.98s\ncompute stats analysis_data;\ninsert into analysis_data select * from smaller_table_we_forgot_before;\nInserted 1000000 rows in 15.32s\n-- Now there are 1001000000 rows. We can update this single data point in the stats.\nalter table analysis_data set tblproperties('numRows'='1001000000', 'STATS_GENERATED_VIA_STATS_TASK'='true');</div><div class=\"hue-doc-codeblock\" id=\"set_numrows_partitioned_example\">-- If the table originally contained 1 million rows, and we add another partition with 30 thousand rows,\n-- change the numRows property for the partition and the overall table.\nalter table partitioned_data partition(year=2009, month=4) set tblproperties ('numRows'='30000', 'STATS_GENERATED_VIA_STATS_TASK'='true');\nalter table partitioned_data set tblproperties ('numRows'='1030000', 'STATS_GENERATED_VIA_STATS_TASK'='true');</div></p><p>\n      In Impala 2.6 and higher, you can use the <span class=\"hue-doc-codeph\">SET COLUMN\n      STATS</span> clause to set a specific stats value for a particular column.\n    </p><p id=\"set_column_stats_example\">\n        You specify a case-insensitive symbolic name for the kind of statistics:\n        <span class=\"hue-doc-codeph\">numDVs</span>, <span class=\"hue-doc-codeph\">numNulls</span>, <span class=\"hue-doc-codeph\">avgSize</span>, <span class=\"hue-doc-codeph\">maxSize</span>.\n        The key names and values are both quoted. This operation applies to an entire table,\n        not a specific partition. For example:\n<div class=\"hue-doc-codeblock\">create table t1 (x int, s string);\ninsert into t1 values (1, 'one'), (2, 'two'), (2, 'deux');\nshow column stats t1;\n+--------+--------+------------------+--------+----------+----------+\n| Column | Type   | #Distinct Values | #Nulls | Max Size | Avg Size |\n+--------+--------+------------------+--------+----------+----------+\n| x      | INT    | -1               | -1     | 4        | 4        |\n| s      | STRING | -1               | -1     | -1       | -1       |\n+--------+--------+------------------+--------+----------+----------+\nalter table t1 set column stats x ('numDVs'='2','numNulls'='0');\nalter table t1 set column stats s ('numdvs'='3','maxsize'='4');\nshow column stats t1;\n+--------+--------+------------------+--------+----------+----------+\n| Column | Type   | #Distinct Values | #Nulls | Max Size | Avg Size |\n+--------+--------+------------------+--------+----------+----------+\n| x      | INT    | 2                | 0      | 4        | 4        |\n| s      | STRING | 3                | -1     | 4        | -1       |\n+--------+--------+------------------+--------+----------+----------+\n</div></p><p><b>To reorganize columns for a table:</b></p><div class=\"hue-doc-codeblock\">ALTER TABLE <span class=\"hue-doc-varname\">table_name</span> ADD COLUMNS (<span class=\"hue-doc-varname\">column_defs</span>);\nALTER TABLE <span class=\"hue-doc-varname\">table_name</span> REPLACE COLUMNS (<span class=\"hue-doc-varname\">column_defs</span>);\nALTER TABLE <span class=\"hue-doc-varname\">table_name</span> CHANGE <span class=\"hue-doc-varname\">column_name</span><span class=\"hue-doc-varname\">new_name</span><span class=\"hue-doc-varname\">new_type</span>;\nALTER TABLE <span class=\"hue-doc-varname\">table_name</span> DROP <span class=\"hue-doc-varname\">column_name</span>;</div><p>\n      The <span class=\"hue-doc-varname\">column_spec</span> is the same as in the <span class=\"hue-doc-codeph\">CREATE TABLE</span>\n      statement: the column name, then its data type, then an optional comment. You can add\n      multiple columns at a time. The parentheses are required whether you add a single column\n      or multiple columns. When you replace columns, all the original column definitions are\n      discarded. You might use this technique if you receive a new set of data files with\n      different data types or columns in a different order. (The data files are retained, so if\n      the new columns are incompatible with the old ones, use <span class=\"hue-doc-codeph\">INSERT OVERWRITE</span>\n      or <span class=\"hue-doc-codeph\">LOAD DATA OVERWRITE</span> to replace all the data before issuing any further\n      queries.)\n    </p><p>\n      For example, here is how you might add columns to an existing table. The first\n      <span class=\"hue-doc-codeph\">ALTER TABLE</span> adds two new columns, and the second <span class=\"hue-doc-codeph\">ALTER\n      TABLE</span> adds one new column. A single Impala query reads both the old and new data\n      files, containing different numbers of columns. For any columns not present in a\n      particular data file, all the column values are considered to be <span class=\"hue-doc-codeph\">NULL</span>.\n    </p><div class=\"hue-doc-codeblock\">create table t1 (x int);\ninsert into t1 values (1), (2);\n\nalter table t1 add columns (s string, t timestamp);\ninsert into t1 values (3, 'three', now());\n\nalter table t1 add columns (b boolean);\ninsert into t1 values (4, 'four', now(), true);\n\nselect * from t1 order by x;\n+---+-------+-------------------------------+------+\n| x | s     | t                             | b    |\n+---+-------+-------------------------------+------+\n| 1 | NULL  | NULL                          | NULL |\n| 2 | NULL  | NULL                          | NULL |\n| 3 | three | 2016-05-11 11:19:45.054457000 | NULL |\n| 4 | four  | 2016-05-11 11:20:20.260733000 | true |\n+---+-------+-------------------------------+------+\n</div><p>\n      You might use the <span class=\"hue-doc-codeph\">CHANGE</span> clause to rename a single column, or to treat an\n      existing column as a different type than before, such as to switch between treating a\n      column as <span class=\"hue-doc-codeph\">STRING</span> and <span class=\"hue-doc-codeph\">TIMESTAMP</span>, or between\n      <span class=\"hue-doc-codeph\">INT</span> and <span class=\"hue-doc-codeph\">BIGINT</span>. You can only drop a single column at a\n      time; to drop multiple columns, issue multiple <span class=\"hue-doc-codeph\">ALTER TABLE</span> statements, or\n      define the new set of columns with a single <span class=\"hue-doc-codeph\">ALTER TABLE ... REPLACE\n      COLUMNS</span> statement.\n    </p><p>\n      The following examples show some safe operations to drop or change columns. Dropping the\n      final column in a table lets Impala ignore the data causing any disruption to existing\n      data files. Changing the type of a column works if existing data values can be safely\n      converted to the new type. The type conversion rules depend on the file format of the\n      underlying table. For example, in a text table, the same value can be interpreted as a\n      <span class=\"hue-doc-codeph\">STRING</span> or a numeric value, while in a binary format such as Parquet, the\n      rules are stricter and type conversions only work between certain sizes of integers.\n    </p><div class=\"hue-doc-codeblock\">create table optional_columns (x int, y int, z int, a1 int, a2 int);\ninsert into optional_columns values (1,2,3,0,0), (2,3,4,100,100);\n\n-- When the last column in the table is dropped, Impala ignores the\n-- values that are no longer needed. (Dropping A1 but leaving A2\n-- would cause problems, as we will see in a subsequent example.)\nalter table optional_columns drop column a2;\nalter table optional_columns drop column a1;\n\nselect * from optional_columns;\n+---+---+---+\n| x | y | z |\n+---+---+---+\n| 1 | 2 | 3 |\n| 2 | 3 | 4 |\n+---+---+---+\n</div><div class=\"hue-doc-codeblock\">create table int_to_string (s string, x int);\ninsert into int_to_string values ('one', 1), ('two', 2);\n\n-- What was an INT column will now be interpreted as STRING.\n-- This technique works for text tables but not other file formats.\n-- The second X represents the new name of the column, which we keep the same.\nalter table int_to_string change x x string;\n\n-- Once the type is changed, we can insert non-integer values into the X column\n-- and treat that column as a string, for example by uppercasing or concatenating.\ninsert into int_to_string values ('three', 'trois');\nselect s, upper(x) from int_to_string;\n+-------+----------+\n| s     | upper(x) |\n+-------+----------+\n| one   | 1        |\n| two   | 2        |\n| three | TROIS    |\n+-------+----------+\n</div><p>\n      Remember that Impala does not actually do any conversion for the underlying data files as\n      a result of <span class=\"hue-doc-codeph\">ALTER TABLE</span> statements. If you use <span class=\"hue-doc-codeph\">ALTER\n      TABLE</span> to create a table layout that does not agree with the contents of the\n      underlying files, you must replace the files yourself, such as using <span class=\"hue-doc-codeph\">LOAD\n      DATA</span> to load a new set of data files, or <span class=\"hue-doc-codeph\">INSERT OVERWRITE</span> to\n      copy from another table and replace the original data.\n    </p><p>\n      The following example shows what happens if you delete the middle column from a Parquet\n      table containing three columns. The underlying data files still contain three columns of\n      data. Because the columns are interpreted based on their positions in the data file\n      instead of the specific column names, a <span class=\"hue-doc-codeph\">SELECT *</span> query now reads the\n      first and second columns from the data file, potentially leading to unexpected results or\n      conversion errors. For this reason, if you expect to someday drop a column, declare it as\n      the last column in the table, where its data can be ignored by queries after the column is\n      dropped. Or, re-run your ETL process and create new data files if you drop or change the\n      type of a column in a way that causes problems with existing data files.\n    </p><div class=\"hue-doc-codeblock\">-- Parquet table showing how dropping a column can produce unexpected results.\ncreate table p1 (s1 string, s2 string, s3 string) stored as parquet;\n\ninsert into p1 values ('one', 'un', 'uno'), ('two', 'deux', 'dos'),\n  ('three', 'trois', 'tres');\nselect * from p1;\n+-------+-------+------+\n| s1    | s2    | s3   |\n+-------+-------+------+\n| one   | un    | uno  |\n| two   | deux  | dos  |\n| three | trois | tres |\n+-------+-------+------+\n\nalter table p1 drop column s2;\n-- The S3 column contains unexpected results.\n-- Because S2 and S3 have compatible types, the query reads\n-- values from the dropped S2, because the existing data files\n-- still contain those values as the second column.\nselect * from p1;\n+-------+-------+\n| s1    | s3    |\n+-------+-------+\n| one   | un    |\n| two   | deux  |\n| three | trois |\n+-------+-------+\n</div><div class=\"hue-doc-codeblock\">-- Parquet table showing how dropping a column can produce conversion errors.\ncreate table p2 (s1 string, x int, s3 string) stored as parquet;\n\ninsert into p2 values ('one', 1, 'uno'), ('two', 2, 'dos'), ('three', 3, 'tres');\nselect * from p2;\n+-------+---+------+\n| s1    | x | s3   |\n+-------+---+------+\n| one   | 1 | uno  |\n| two   | 2 | dos  |\n| three | 3 | tres |\n+-------+---+------+\n\nalter table p2 drop column x;\nselect * from p2;\nWARNINGS:\nFile '<span class=\"hue-doc-varname\">hdfs_filename</span>' has an incompatible Parquet schema for column 'add_columns.p2.s3'.\nColumn type: STRING, Parquet schema:\noptional int32 x [i:1 d:1 r:0]\n\nFile '<span class=\"hue-doc-varname\">hdfs_filename</span>' has an incompatible Parquet schema for column 'add_columns.p2.s3'.\nColumn type: STRING, Parquet schema:\noptional int32 x [i:1 d:1 r:0]\n</div><p>\n      In Impala 2.6 and higher, if an Avro table is created without\n      column definitions in the <span class=\"hue-doc-codeph\">CREATE TABLE</span> statement, and columns are later\n      added through <span class=\"hue-doc-codeph\">ALTER TABLE</span>, the resulting table is now queryable. Missing\n      values from the newly added columns now default to <span class=\"hue-doc-codeph\">NULL</span>.\n    </p><p><b>To change the file format that Impala expects data to be in, for a table or\n      partition:</b></p><p>\n      Use an <span class=\"hue-doc-codeph\">ALTER TABLE ... SET FILEFORMAT</span> clause. You can include an optional\n      <span class=\"hue-doc-codeph\">PARTITION (<span class=\"hue-doc-varname\">col1</span>=<span class=\"hue-doc-varname\">val1</span>,\n      <span class=\"hue-doc-varname\">col2</span>=<span class=\"hue-doc-varname\">val2</span>, ...</span> clause so that the file\n      format is changed for a specific partition rather than the entire table.\n    </p><p>\n      Because this operation only changes the table metadata, you must do any conversion of\n      existing data using regular Hadoop techniques outside of Impala. Any new data created by\n      the Impala <span class=\"hue-doc-codeph\">INSERT</span> statement will be in the new format. You cannot specify\n      the delimiter for Text files; the data files must be comma-delimited.\n</p><p>\n      To set the file format for a single partition, include the <span class=\"hue-doc-codeph\">PARTITION</span>\n      clause. Specify all the same partitioning columns for the table, with a constant value for\n      each, to precisely identify the single partition affected by the statement:\n    </p><div class=\"hue-doc-codeblock\">create table p1 (s string) partitioned by (month int, day int);\n-- Each ADD PARTITION clause creates a subdirectory in HDFS.\nalter table p1 add partition (month=1, day=1);\nalter table p1 add partition (month=1, day=2);\nalter table p1 add partition (month=2, day=1);\nalter table p1 add partition (month=2, day=2);\n-- Queries and INSERT statements will read and write files\n-- in this format for this specific partition.\nalter table p1 partition (month=2, day=2) set fileformat parquet;\n</div><p><b>To change the row format with different delimiter characters:</b></p><p>\n      Use the <span class=\"hue-doc-codeph\">SET ROW FORMAT DELIMITED</span> clause to ingest data files that use a\n      different delimiter character or a different line end character. When specifying delimiter\n      and line end characters with the <span class=\"hue-doc-codeph\">FIELDS TERMINATED BY</span>, <span class=\"hue-doc-codeph\">ESCAPED\n      BY</span>, and <span class=\"hue-doc-codeph\">LINES TERMINATED BY</span> clauses, you can use the following:\n      <ul><li>\n          A regular ASCII character surrounded by single or double quotation marks.\n        </li><li>\n          An octal sequence, such as <span class=\"hue-doc-codeph\">'\\054'</span> representing a comma or\n          <span class=\"hue-doc-codeph\">'\\0'</span> for ASCII null (hex 00).\n        </li><li>\n          Special characters, such as:\n          <ul><li><span class=\"hue-doc-codeph\">'\\t'</span> for tab\n            </li><li><span class=\"hue-doc-codeph\">'\\n'</span> for newline or linefeed\n            </li><li><span class=\"hue-doc-codeph\">'\\r'</span> for carriage return\n            </li></ul></li><li>\n          An integer in the range '-127'..'128' (with quotation marks but no backslash)\n          <p>\n            Negative values are subtracted from 256. For example, <span class=\"hue-doc-codeph\">FIELDS TERMINATED BY\n            '-2'</span> sets the field delimiter to ASCII code 254.\n          </p></li></ul></p><p>\n      For more examples of text tables, see <a class=\"hue-doc-external-link\" href=\"https://www.cloudera.com/documentation/enterprise/latest/topics/impala_txtfile.html#txtfile\" target=\"_blank\">Using Text Data Files with Impala Tables</a>.\n    </p><p>\n      For the <span class=\"hue-doc-codeph\">ESCAPED BY</span> clause, choose an escape character that is not used\n      anywhere else in the file. The character following the escape character is taken literally\n      as part of a field value.\n    </p><p>\n      Surrounding field values with quotation marks does not help Impala to parse fields with\n      embedded delimiter characters as the quotation marks are considered to be part of the\n      column value.\n    </p><p>\n      If you want to use <span class=\"hue-doc-codeph\">\\</span> as the escape character, specify the clause in\n      <span class=\"hue-doc-cmdname\">impala-shell</span> as <span class=\"hue-doc-codeph\">ESCAPED BY '\\\\'</span>.\n    </p><p><b>To add or drop partitions for a table</b>, the table must already be partitioned (that\n      is, created with a <span class=\"hue-doc-codeph\">PARTITIONED BY</span> clause). The partition is a physical\n      directory in HDFS, with a name that encodes a particular column value (the <b>partition\n      key</b>). The Impala <span class=\"hue-doc-codeph\">INSERT</span> statement already creates the partition if\n      necessary, so the <span class=\"hue-doc-codeph\">ALTER TABLE ... ADD PARTITION</span> is primarily useful for\n      importing data by moving or copying existing data files into the HDFS directory\n      corresponding to a partition. (You can use the <span class=\"hue-doc-codeph\">LOAD DATA</span> statement to\n      move files into the partition directory, or <span class=\"hue-doc-codeph\">ALTER TABLE ... PARTITION (...) SET\n      LOCATION</span> to point a partition at a directory that already contains data files.\n    </p><p>\n      The <span class=\"hue-doc-codeph\">DROP PARTITION</span> clause is used to remove the HDFS directory and\n      associated data files for a particular set of partition key values; for example, if you\n      always analyze the last 3 months worth of data, at the beginning of each month you might\n      drop the oldest partition that is no longer needed. Removing partitions reduces the amount\n      of metadata associated with the table and the complexity of calculating the optimal query\n      plan, which can simplify and speed up queries on partitioned tables, particularly join\n      queries. Here is an example showing the <span class=\"hue-doc-codeph\">ADD PARTITION</span> and <span class=\"hue-doc-codeph\">DROP\n      PARTITION</span> clauses.\n    </p><p>\n      To avoid errors while adding or dropping partitions whose existence is not certain, add\n      the optional <span class=\"hue-doc-codeph\">IF [NOT] EXISTS</span> clause between the <span class=\"hue-doc-codeph\">ADD</span> or\n      <span class=\"hue-doc-codeph\">DROP</span> keyword and the <span class=\"hue-doc-codeph\">PARTITION</span> keyword. That is, the\n      entire clause becomes <span class=\"hue-doc-codeph\">ADD IF NOT EXISTS PARTITION</span> or <span class=\"hue-doc-codeph\">DROP IF\n      EXISTS PARTITION</span>. The following example shows how partitions can be created\n      automatically through <span class=\"hue-doc-codeph\">INSERT</span> statements, or manually through\n      <span class=\"hue-doc-codeph\">ALTER TABLE</span> statements. The <span class=\"hue-doc-codeph\">IF [NOT] EXISTS</span> clauses let\n      the <span class=\"hue-doc-codeph\">ALTER TABLE</span> statements succeed even if a new requested partition\n      already exists, or a partition to be dropped does not exist.\n    </p><p>\n      Inserting 2 year values creates 2 partitions:\n    </p><div class=\"hue-doc-codeblock\">create table partition_t (s string) partitioned by (y int);\ninsert into partition_t (s,y) values ('two thousand',2000), ('nineteen ninety',1990);\nshow partitions partition_t;\n+-------+-------+--------+------+--------------+-------------------+--------+-------------------+\n| y     | #Rows | #Files | Size | Bytes Cached | Cache Replication | Format | Incremental stats |\n+-------+-------+--------+------+--------------+-------------------+--------+-------+\n| 1990  | -1    | 1      | 16B  | NOT CACHED   | NOT CACHED        | TEXT   | false |\n| 2000  | -1    | 1      | 13B  | NOT CACHED   | NOT CACHED        | TEXT   | false |\n| Total | -1    | 2      | 29B  | 0B           |                   |        |       |\n+-------+-------+--------+------+--------------+-------------------+--------+-------+\n</div><p>\n      Without the <span class=\"hue-doc-codeph\">IF NOT EXISTS</span> clause, an attempt to add a new partition might\n      fail:\n    </p><div class=\"hue-doc-codeblock\">alter table partition_t add partition (y=2000);\nERROR: AnalysisException: Partition spec already exists: (y=2000).\n</div><p>\n      The <span class=\"hue-doc-codeph\">IF NOT EXISTS</span> clause makes the statement succeed whether or not there\n      was already a partition with the specified key value:\n    </p><div class=\"hue-doc-codeblock\">alter table partition_t add if not exists partition (y=2000);\nalter table partition_t add if not exists partition (y=2010);\nshow partitions partition_t;\n+-------+-------+--------+------+--------------+-------------------+--------+-------------------+\n| y     | #Rows | #Files | Size | Bytes Cached | Cache Replication | Format | Incremental stats |\n+-------+-------+--------+------+--------------+-------------------+--------+-------+\n| 1990  | -1    | 1      | 16B  | NOT CACHED   | NOT CACHED        | TEXT   | false |\n| 2000  | -1    | 1      | 13B  | NOT CACHED   | NOT CACHED        | TEXT   | false |\n| 2010  | -1    | 0      | 0B   | NOT CACHED   | NOT CACHED        | TEXT   | false |\n| Total | -1    | 2      | 29B  | 0B           |                   |        |       |\n+-------+-------+--------+------+--------------+-------------------+--------+-------+\n</div><p>\n      Likewise, the <span class=\"hue-doc-codeph\">IF EXISTS</span> clause lets <span class=\"hue-doc-codeph\">DROP PARTITION</span>\n      succeed whether or not the partition is already in the table:\n    </p><div class=\"hue-doc-codeblock\">alter table partition_t drop if exists partition (y=2000);\nalter table partition_t drop if exists partition (y=1950);\nshow partitions partition_t;\n+-------+-------+--------+------+--------------+-------------------+--------+-------------------+\n| y     | #Rows | #Files | Size | Bytes Cached | Cache Replication | Format | Incremental stats |\n+-------+-------+--------+------+--------------+-------------------+--------+-------+\n| 1990  | -1    | 1      | 16B  | NOT CACHED   | NOT CACHED        | TEXT   | false |\n| 2010  | -1    | 0      | 0B   | NOT CACHED   | NOT CACHED        | TEXT   | false |\n| Total | -1    | 1      | 16B  | 0B           |                   |        |       |\n+-------+-------+--------+------+--------------+-------------------+--------+-------+\n</div><p>\n      The optional <span class=\"hue-doc-codeph\">PURGE</span> keyword, available in\n      Impala 2.3 and higher, is used with the <span class=\"hue-doc-codeph\">DROP\n      PARTITION</span> clause to remove associated HDFS data files immediately rather than\n      going through the HDFS trashcan mechanism. Use this keyword when dropping a partition if\n      it is crucial to remove the data as quickly as possible to free up space, or if there is a\n      problem with the trashcan, such as the trash cannot being configured or being in a\n      different HDFS encryption zone than the data files.\n    </p><div class=\"hue-doc-codeblock\">-- Create an empty table and define the partitioning scheme.\ncreate table part_t (x int) partitioned by (month int);\n-- Create an empty partition into which you could copy data files from some other source.\nalter table part_t add partition (month=1);\n-- After changing the underlying data, issue a REFRESH statement to make the data visible in Impala.\nrefresh part_t;\n-- Later, do the same for the next month.\nalter table part_t add partition (month=2);\n\n-- Now you no longer need the older data.\nalter table part_t drop partition (month=1);\n-- If the table was partitioned by month and year, you would issue a statement like:\n-- alter table part_t drop partition (year=2003,month=1);\n-- which would require 12 ALTER TABLE statements to remove a year's worth of data.\n\n-- If the data files for subsequent months were in a different file format,\n-- you could set a different file format for the new partition as you create it.\nalter table part_t add partition (month=3) set fileformat=parquet;\n</div><p>\n      The value specified for a partition key can be an arbitrary constant expression, without\n      any references to columns. For example:\n    </p><div class=\"hue-doc-codeblock\">alter table time_data add partition (month=concat('Decem','ber'));\nalter table sales_data add partition (zipcode = cast(9021 * 10 as string));</div><div class=\"hue-doc-note\"><p>\n        An alternative way to reorganize a table and its associated data files is to use\n        <span class=\"hue-doc-codeph\">CREATE TABLE</span> to create a variation of the original table, then use\n        <span class=\"hue-doc-codeph\">INSERT</span> to copy the transformed or reordered data to the new table. The\n        advantage of <span class=\"hue-doc-codeph\">ALTER TABLE</span> is that it avoids making a duplicate copy of\n        the data files, allowing you to reorganize huge volumes of data in a space-efficient way\n        using familiar Hadoop techniques.\n      </p></div><p><b>To switch a table between internal and external:</b></p><p id=\"switch_internal_external_table\">\n        You can switch a table from internal to external, or from external to internal, by using the <span class=\"hue-doc-codeph\">ALTER\n        TABLE</span> statement:\n<div class=\"hue-doc-codeblock\">-- Switch a table from internal to external.\nALTER TABLE <span class=\"hue-doc-varname\">table_name</span> SET TBLPROPERTIES('EXTERNAL'='TRUE');\n\n-- Switch a table from external to internal.\nALTER TABLE <span class=\"hue-doc-varname\">table_name</span> SET TBLPROPERTIES('EXTERNAL'='FALSE');\n</div></p><p id=\"cancel_blurb_no\"><b>Cancellation:</b> Cannot be cancelled.\n      </p><p id=\"permissions_blurb\"><b>HDFS permissions:</b></p><p>\n      Most <span class=\"hue-doc-codeph\">ALTER TABLE</span> clauses do not actually read or write any HDFS files,\n      and so do not depend on specific HDFS permissions. For example, the <span class=\"hue-doc-codeph\">SET\n      FILEFORMAT</span> clause does not actually check the file format existing data files or\n      convert them to the new format, and the <span class=\"hue-doc-codeph\">SET LOCATION</span> clause does not\n      require any special permissions on the new location. (Any permission-related failures\n      would come later, when you actually query or insert into the table.)\n    </p><p>\n      In general, <span class=\"hue-doc-codeph\">ALTER TABLE</span> clauses that do touch HDFS files and directories\n      require the same HDFS permissions as corresponding <span class=\"hue-doc-codeph\">CREATE</span>,\n      <span class=\"hue-doc-codeph\">INSERT</span>, or <span class=\"hue-doc-codeph\">SELECT</span> statements. The permissions allow the\n      user ID that the <span class=\"hue-doc-cmdname\">impalad</span> daemon runs under, typically the\n      <span class=\"hue-doc-codeph\">impala</span> user, to read or write files or directories, or (in the case of\n      the execute bit) descend into a directory. The <span class=\"hue-doc-codeph\">RENAME TO</span> clause requires\n      read, write, and execute permission in the source and destination database directories and\n      in the table data directory, and read and write permission for the data files within the\n      table. The <span class=\"hue-doc-codeph\">ADD PARTITION</span> and <span class=\"hue-doc-codeph\">DROP PARTITION</span> clauses\n      require write and execute permissions for the associated partition directory.\n    </p><p id=\"kudu_blurb\"><b>Kudu considerations:</b></p><p>\n      Because of the extra constraints and features of Kudu tables, such as the <span class=\"hue-doc-codeph\">NOT\n      NULL</span> and <span class=\"hue-doc-codeph\">DEFAULT</span> attributes for columns, <span class=\"hue-doc-codeph\">ALTER\n      TABLE</span> has specific requirements related to Kudu tables:\n      <ul><li><p>\n            In an <span class=\"hue-doc-codeph\">ADD COLUMNS</span> operation, you can specify the\n            <span class=\"hue-doc-codeph\">NULL</span>, <span class=\"hue-doc-codeph\">NOT NULL</span>, and <span class=\"hue-doc-codeph\">DEFAULT\n            <span class=\"hue-doc-varname\">default_value</span></span> column attributes.\n          </p></li><li><p>\n            In Impala 2.9 and higher, you can also specify the\n            <span class=\"hue-doc-codeph\">ENCODING</span>, <span class=\"hue-doc-codeph\">COMPRESSION</span>, and\n            <span class=\"hue-doc-codeph\">BLOCK_SIZE</span> attributes when adding a column.\n          </p></li><li><p>\n            If you add a column with a <span class=\"hue-doc-codeph\">NOT NULL</span> attribute, it must also have a\n            <span class=\"hue-doc-codeph\">DEFAULT</span> attribute, so the default value can be assigned to that\n            column for all existing rows.\n          </p></li><li><p>\n            The <span class=\"hue-doc-codeph\">DROP COLUMN</span> clause works the same for a Kudu table as for other\n            kinds of tables.\n          </p></li><li><p>\n            Although you can change the name of a column with the <span class=\"hue-doc-codeph\">CHANGE</span>\n            clause, you cannot change the type of a column in a Kudu table.\n          </p></li><li><p>\n            You cannot change the nullability of existing columns in a Kudu table.\n          </p></li><li><p>\n            In Impala 2.10, you can change the default value, encoding,\n            compression, or block size of existing columns in a Kudu table by using the\n            <span class=\"hue-doc-codeph\">SET</span> clause.\n          </p></li><li><p>\n            You cannot use the <span class=\"hue-doc-codeph\">REPLACE COLUMNS</span> clause with a Kudu table.\n          </p></li><li>\n          The <span class=\"hue-doc-codeph\">RENAME TO</span> clause for a Kudu table only affects the name stored in\n          the metastore database that Impala uses to refer to the table. To change which\n          underlying Kudu table is associated with an Impala table name, you must change the\n          <span class=\"hue-doc-codeph\">TBLPROPERTIES</span> property of the table: <span class=\"hue-doc-codeph\">SET\n          TBLPROPERTIES('kudu.table_name'='<span class=\"hue-doc-varname\">kudu_tbl_name</span>)</span>. You can\n          only change underlying Kudu tables for the external tables.\n        </li></ul></p><p>\n      The following are some examples of using the <span class=\"hue-doc-codeph\">ADD COLUMNS</span> clause for a\n      Kudu table:\n    </p><div class=\"hue-doc-codeblock\">CREATE TABLE t1 ( x INT, PRIMARY KEY (x) )\n  PARTITION BY HASH (x) PARTITIONS 16\n  STORED AS KUDU\n\nALTER TABLE t1 ADD COLUMNS (y STRING ENCODING prefix_encoding);\nALTER TABLE t1 ADD COLUMNS (z INT DEFAULT 10);\nALTER TABLE t1 ADD COLUMNS (a STRING NOT NULL DEFAULT '', t TIMESTAMP COMPRESSION default_compression);\n</div><p>\n      The following are some examples of modifying column defaults and storage attributes for a\n      Kudu table:\n    </p><div class=\"hue-doc-codeblock\">create table kt (x bigint primary key, s string default 'yes', t timestamp)\n  stored as kudu;\n\n-- You can change the default value for a column, which affects any rows\n-- inserted after this change is made.\nalter table kt alter column s set default 'no';\n\n-- You can remove the default value for a column, which affects any rows\n-- inserted after this change is made. If the column is nullable, any\n-- future inserts default to NULL for this column. If the column is marked\n-- NOT NULL, any future inserts must specify a value for the column.\nalter table kt alter column s drop default;\n\ninsert into kt values (1, 'foo', now());\n-- Because of the DROP DEFAULT above, omitting S from the insert\n-- gives it a value of NULL.\ninsert into kt (x, t) values (2, now());\n\nselect * from kt;\n+---+------+-------------------------------+\n| x | s    | t                             |\n+---+------+-------------------------------+\n| 2 | NULL | 2017-10-02 00:03:40.652156000 |\n| 1 | foo  | 2017-10-02 00:03:04.346185000 |\n+---+------+-------------------------------+\n\n-- Other storage-related attributes can also be changed for columns.\n-- These changes take effect for any newly inserted rows, or rows\n-- rearranged due to compaction after deletes or updates.\nalter table kt alter column s set encoding prefix_encoding;\n-- The COLUMN keyword is optional in the syntax.\nalter table kt alter x set block_size 2048;\nalter table kt alter column t set compression zlib;\n\ndesc kt;\n+------+-----------+---------+-------------+----------+---------------+-----------------+---------------------+------------+\n| name | type      | comment | primary_key | nullable | default_value | encoding        | compression         | block_size |\n+------+-----------+---------+-------------+----------+---------------+-----------------+---------------------+------------+\n| x    | bigint    |         | true        | false    |               | AUTO_ENCODING   | DEFAULT_COMPRESSION | 2048       |\n| s    | string    |         | false       | true     |               | PREFIX_ENCODING | DEFAULT_COMPRESSION | 0          |\n| t    | timestamp |         | false       | true     |               | AUTO_ENCODING   | ZLIB                | 0          |\n+------+-----------+---------+-------------+----------+---------------+-----------------+---------------------+------------+\n</div><p>\n      Kudu tables all use an underlying partitioning mechanism. The partition syntax is\n      different than for non-Kudu tables. You can use the <span class=\"hue-doc-codeph\">ALTER TABLE</span> statement\n      to add and drop <span class=\"hue-doc-term\">range partitions</span> from a Kudu table. Any new range must not\n      overlap with any existing ranges. Dropping a range removes all the associated rows from\n      the table. See <a class=\"hue-doc-external-link\" href=\"https://www.cloudera.com/documentation/enterprise/latest/topics/impala_kudu.html#kudu_partitioning\" target=\"_blank\">Partitioning for Kudu Tables</a> for details.\n    </p><p id=\"related_info\"><b>Related information:</b></p><p><a class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"topics/impala_tables.xml\" data-doc-anchor-id=\"tables\">Overview of Impala Tables</a>,\n      <a class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"topics/impala_create_table.xml\" data-doc-anchor-id=\"create_table\">CREATE TABLE Statement</a>,\n      <a class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"topics/impala_drop_table.xml\" data-doc-anchor-id=\"drop_table\">DROP TABLE Statement</a>,\n      <a class=\"hue-doc-external-link\" href=\"https://www.cloudera.com/documentation/enterprise/latest/topics/impala_partitioning.html#partitioning\" target=\"_blank\">Partitioning for Impala Tables</a>,\n      <a class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"topics/impala_tables.xml\" data-doc-anchor-id=\"internal_tables\">Internal Tables</a>,\n      <a class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"topics/impala_tables.xml\" data-doc-anchor-id=\"external_tables\">External Tables</a></p></div></div></div>","title":"ALTER TABLE Statement"}