{"body":"<div><div id=\"admission_control\"><div class=\"hue-doc-title\">Configuring Admission Control</div><div><p>\n      Impala includes features that balance and maximize resources in your\n      Apache Hadoop cluster. This topic describes how you can improve\n      efficiency of your a Apache Hadoop cluster using those features.\n    </p><p>\n      The configuration options for admission control range from the simple (a single resource\n      pool with a single set of options) to the complex (multiple resource pools with different\n      options, each pool handling queries for a different set of users and groups).\n    </p></div><div id=\"concept_bz4_vxz_jgb\"><div class=\"hue-doc-title\">Configuring Admission Control in Command Line Interface</div><div><p>\n        To configure admission control, use a combination of startup options for the Impala\n        daemon and edit or create the configuration files\n        <span class=\"hue-doc-filepath\">fair-scheduler.xml</span> and <span class=\"hue-doc-filepath\">llama-site.xml</span>.\n      </p><p>\n        For a straightforward configuration using a single resource pool named\n        <span class=\"hue-doc-codeph\">default</span>, you can specify configuration options on the command line and\n        skip the <span class=\"hue-doc-filepath\">fair-scheduler.xml</span> and <span class=\"hue-doc-filepath\">llama-site.xml</span>\n        configuration files.\n      </p><p>\n        For an advanced configuration with multiple resource pools using different settings:\n        <ol><li>\n            Set up the <span class=\"hue-doc-filepath\">fair-scheduler.xml</span> and\n            <span class=\"hue-doc-filepath\">llama-site.xml</span> configuration files manually.\n          </li><li>\n            Provide the paths to each one using the <span class=\"hue-doc-cmdname\">impalad</span> command-line\n            options, <span class=\"hue-doc-codeph\">‑‑fair_scheduler_allocation_path</span> and\n            <span class=\"hue-doc-codeph\">‑‑llama_site_path</span> respectively.\n          </li></ol></p><p>\n        The Impala admission control feature uses the Fair Scheduler configuration settings to\n        determine how to map users and groups to different resource pools. For example, you\n        might set up different resource pools with separate memory limits, and maximum number of\n        concurrent and queued queries, for different categories of users within your\n        organization. For details about all the Fair Scheduler configuration settings, see the\n        <a class=\"hue-doc-external-link\" href=\"http://hadoop.apache.org/docs/current/hadoop-yarn/hadoop-yarn-site/FairScheduler.html#Configuration\" target=\"_blank\">Apache\n        wiki</a>.\n      </p><p>\n        The Impala admission control feature uses a small subset of possible settings from the\n        <span class=\"hue-doc-filepath\">llama-site.xml</span> configuration file:\n      </p><div class=\"hue-doc-codeblock\">llama.am.throttling.maximum.placed.reservations.<span class=\"hue-doc-varname\">queue_name</span>\nllama.am.throttling.maximum.queued.reservations.<span class=\"hue-doc-varname\">queue_name</span><span class=\"hue-doc-ph\">impala.admission-control.pool-default-query-options.<span class=\"hue-doc-varname\">queue_name</span>\nimpala.admission-control.pool-queue-timeout-ms.<span class=\"hue-doc-varname\">queue_name</span></span></div><p>\n        The <span class=\"hue-doc-codeph\">impala.admission-control.pool-queue-timeout-ms</span> setting specifies\n        the timeout value for this pool in milliseconds.\n      </p><p>\n        The<span class=\"hue-doc-codeph\">impala.admission-control.pool-default-query-options</span> settings\n        designates the default query options for all queries that run in this pool. Its argument\n        value is a comma-delimited string of 'key=value' pairs, <span class=\"hue-doc-codeph\">'key1=val1,key2=val2,\n        ...'</span>. For example, this is where you might set a default memory limit for all\n        queries in the pool, using an argument such as <span class=\"hue-doc-codeph\">MEM_LIMIT=5G</span>.\n      </p><p>\n        The <span class=\"hue-doc-codeph\">impala.admission-control.*</span> configuration settings are available in\n        Impala 2.5 and higher.\n      </p></div><div id=\"concept_cz4_vxz_jgb\"><div class=\"hue-doc-title\">Example of Admission Control Configuration</div><div><p>\n          Here are sample <span class=\"hue-doc-filepath\">fair-scheduler.xml</span> and\n          <span class=\"hue-doc-filepath\">llama-site.xml</span> files that define resource pools\n          <span class=\"hue-doc-codeph\">root.default</span>, <span class=\"hue-doc-codeph\">root.development</span>, and\n          <span class=\"hue-doc-codeph\">root.production</span>. These files define resource pools for Impala\n          admission control and are separate from the similar\n          <span class=\"hue-doc-codeph\">fair-scheduler.xml</span>that defines resource pools for YARN.\n        </p><p><b>fair-scheduler.xml:</b></p><p>\n          Although Impala does not use the <span class=\"hue-doc-codeph\">vcores</span> value, you must still specify\n          it to satisfy YARN requirements for the file contents.\n        </p><p>\n          Each <span class=\"hue-doc-codeph\">&lt;aclSubmitApps&gt;</span> tag (other than the one for\n          <span class=\"hue-doc-codeph\">root</span>) contains a comma-separated list of users, then a space, then a\n          comma-separated list of groups; these are the users and groups allowed to submit\n          Impala statements to the corresponding resource pool.\n        </p><p>\n          If you leave the <span class=\"hue-doc-codeph\">&lt;aclSubmitApps&gt;</span> element empty for a pool,\n          nobody can submit directly to that pool; child pools can specify their own\n          <span class=\"hue-doc-codeph\">&lt;aclSubmitApps&gt;</span> values to authorize users and groups to submit\n          to those pools.\n        </p><div class=\"hue-doc-codeblock\">&lt;allocations&gt;\n\n    &lt;queue name=\"root\"&gt;\n        &lt;aclSubmitApps&gt; &lt;/aclSubmitApps&gt;\n        &lt;queue name=\"default\"&gt;\n            &lt;maxResources&gt;50000 mb, 0 vcores&lt;/maxResources&gt;\n            &lt;aclSubmitApps&gt;*&lt;/aclSubmitApps&gt;\n        &lt;/queue&gt;\n        &lt;queue name=\"development\"&gt;\n            &lt;maxResources&gt;200000 mb, 0 vcores&lt;/maxResources&gt;\n            &lt;aclSubmitApps&gt;user1,user2 dev,ops,admin&lt;/aclSubmitApps&gt;\n        &lt;/queue&gt;\n        &lt;queue name=\"production\"&gt;\n            &lt;maxResources&gt;1000000 mb, 0 vcores&lt;/maxResources&gt;\n            &lt;aclSubmitApps&gt; ops,admin&lt;/aclSubmitApps&gt;\n        &lt;/queue&gt;\n    &lt;/queue&gt;\n    &lt;queuePlacementPolicy&gt;\n        &lt;rule name=\"specified\" create=\"false\"/&gt;\n        &lt;rule name=\"default\" /&gt;\n    &lt;/queuePlacementPolicy&gt;\n&lt;/allocations&gt;\n\n</div><p><b>llama-site.xml:</b></p><div class=\"hue-doc-codeblock\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;configuration&gt;\n  &lt;property&gt;\n    &lt;name&gt;llama.am.throttling.maximum.placed.reservations.root.default&lt;/name&gt;\n    &lt;value&gt;10&lt;/value&gt;\n  &lt;/property&gt;\n  &lt;property&gt;\n    &lt;name&gt;llama.am.throttling.maximum.queued.reservations.root.default&lt;/name&gt;\n    &lt;value&gt;50&lt;/value&gt;\n  &lt;/property&gt;\n  &lt;property&gt;\n    &lt;name&gt;impala.admission-control.pool-default-query-options.root.default&lt;/name&gt;\n    &lt;value&gt;mem_limit=128m,query_timeout_s=20,max_io_buffers=10&lt;/value&gt;\n  &lt;/property&gt;\n  &lt;property&gt;\n    &lt;name&gt;impala.admission-control.<b>pool-queue-timeout-ms</b>.root.default&lt;/name&gt;\n    &lt;value&gt;30000&lt;/value&gt;\n  &lt;/property&gt;\n  &lt;property&gt;\n    &lt;name&gt;impala.admission-control.<b>max-query-mem-limit</b>.root.default.regularPool&lt;/name&gt;\n    &lt;value&gt;1610612736&lt;/value&gt;&lt;!--1.5GB--&gt;\n  &lt;/property&gt;\n  &lt;property&gt;\n    &lt;name&gt;impala.admission-control.<b>min-query-mem-limit</b>.root.default.regularPool&lt;/name&gt;\n    &lt;value&gt;52428800&lt;/value&gt;&lt;!--50MB--&gt;\n  &lt;/property&gt;\n  &lt;property&gt;\n    &lt;name&gt;impala.admission-control.<b>clamp-mem-limit-query-option</b>.root.default.regularPool&lt;/name&gt;\n    &lt;value&gt;true&lt;/value&gt;\n  &lt;/property&gt;\n</div></div></div></div><div id=\"concept_zy4_vxz_jgb\"><div class=\"hue-doc-title\">Configuring Cluster-wide Admission Control</div><div><div class=\"hue-doc-note\">        These settings only apply if you enable admission control but leave dynamic resource\n        pools disabled. In Impala 2.5 and higher, we recommend\n        that you set up dynamic resource pools and customize the settings for each pool as\n        described in <a class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"topics/impala_admission_config.xml\" data-doc-anchor-id=\"concept_bz4_vxz_jgb\">Configuring Admission Control in Command Line Interface</a>.\n      </div><p>\n        The following Impala configuration options let you adjust the settings of the admission\n        control feature. When supplying the options on the <span class=\"hue-doc-cmdname\">impalad</span> command\n        line, prepend the option name with <span class=\"hue-doc-codeph\">--</span>.\n      </p><dl><dt><span class=\"hue-doc-codeph\">queue_wait_timeout_ms</span></dt><dd><b>Purpose:</b> Maximum amount of time (in milliseconds) that a request waits to be\n            admitted before timing out.\n            <p><b>Type:</b><span class=\"hue-doc-codeph\">int64</span></p><p><b>Default:</b><span class=\"hue-doc-codeph\">60000</span></p></dd><dt><span class=\"hue-doc-codeph\">default_pool_max_requests</span></dt><dd><b>Purpose:</b> Maximum number of concurrent outstanding requests allowed to run\n            before incoming requests are queued. Because this limit applies cluster-wide, but\n            each Impala node makes independent decisions to run queries immediately or queue\n            them, it is a soft limit; the overall number of concurrent queries might be slightly\n            higher during times of heavy load. A negative value indicates no limit. Ignored if\n            <span class=\"hue-doc-codeph\">fair_scheduler_config_path</span> and <span class=\"hue-doc-codeph\">llama_site_path</span> are\n            set.\n            <p><b>Type:</b><span class=\"hue-doc-codeph\">int64</span></p><p><b>Default:</b><span class=\"hue-doc-ph\">-1, meaning unlimited (prior to\n              Impala 2.5 the default was 200)</span></p></dd><dt><span class=\"hue-doc-codeph\">default_pool_max_queued</span></dt><dd><b>Purpose:</b> Maximum number of requests allowed to be queued before rejecting\n            requests. Because this limit applies cluster-wide, but each Impala node makes\n            independent decisions to run queries immediately or queue them, it is a soft limit;\n            the overall number of queued queries might be slightly higher during times of heavy\n            load. A negative value or 0 indicates requests are always rejected once the maximum\n            concurrent requests are executing. Ignored if\n            <span class=\"hue-doc-codeph\">fair_scheduler_config_path</span> and <span class=\"hue-doc-codeph\">llama_site_path</span> are\n            set.\n            <p><b>Type:</b><span class=\"hue-doc-codeph\">int64</span></p><p><b>Default:</b><span class=\"hue-doc-ph\">unlimited</span></p></dd><dt><span class=\"hue-doc-codeph\">default_pool_mem_limit</span></dt><dd><b>Purpose:</b> Maximum amount of memory (across the entire cluster) that all\n            outstanding requests in this pool can use before new requests to this pool are\n            queued. Specified in bytes, megabytes, or gigabytes by a number followed by the\n            suffix <span class=\"hue-doc-codeph\">b</span> (optional), <span class=\"hue-doc-codeph\">m</span>, or <span class=\"hue-doc-codeph\">g</span>,\n            either uppercase or lowercase. You can specify floating-point values for megabytes\n            and gigabytes, to represent fractional numbers such as <span class=\"hue-doc-codeph\">1.5</span>. You can\n            also specify it as a percentage of the physical memory by specifying the suffix\n            <span class=\"hue-doc-codeph\">%</span>. 0 or no setting indicates no limit. Defaults to bytes if no unit\n            is given. Because this limit applies cluster-wide, but each Impala node makes\n            independent decisions to run queries immediately or queue them, it is a soft limit;\n            the overall memory used by concurrent queries might be slightly higher during times\n            of heavy load. Ignored if <span class=\"hue-doc-codeph\">fair_scheduler_config_path</span> and\n            <span class=\"hue-doc-codeph\">llama_site_path</span> are set.\n            <div class=\"hue-doc-note\" id=\"admission_compute_stats\">        Impala relies on the statistics produced by the <span class=\"hue-doc-codeph\">COMPUTE STATS</span> statement\n        to estimate memory usage for each query. See\n        <a class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"topics/impala_compute_stats.xml\" data-doc-anchor-id=\"compute_stats\">COMPUTE STATS Statement</a> for guidelines about how\n        and when to use this statement.\n      </div><p id=\"type_string\"><b>Type:</b> string\n      </p><p><b>Default:</b><span class=\"hue-doc-codeph\">\"\"</span> (empty string, meaning unlimited)\n            </p></dd><dt><span class=\"hue-doc-codeph\">disable_pool_max_requests</span></dt><dd><b>Purpose:</b> Disables all per-pool limits on the maximum number of running\n            requests.\n            <p><b>Type:</b> Boolean\n            </p><p><b>Default:</b><span class=\"hue-doc-codeph\">false</span></p></dd><dt><span class=\"hue-doc-codeph\">disable_pool_mem_limits</span></dt><dd><b>Purpose:</b> Disables all per-pool mem limits.\n            <p><b>Type:</b> Boolean\n            </p><p><b>Default:</b><span class=\"hue-doc-codeph\">false</span></p></dd><dt><span class=\"hue-doc-codeph\">fair_scheduler_allocation_path</span></dt><dd><b>Purpose:</b> Path to the fair scheduler allocation file\n            (<span class=\"hue-doc-codeph\">fair-scheduler.xml</span>).\n            <p id=\"type_string\"><b>Type:</b> string\n      </p><p><b>Default:</b><span class=\"hue-doc-codeph\">\"\"</span> (empty string)\n            </p><p><b>Usage notes:</b> Admission control only uses a small subset of the settings\n              that can go in this file, as described below. For details about all the Fair\n              Scheduler configuration settings, see the\n              <a class=\"hue-doc-external-link\" href=\"http://hadoop.apache.org/docs/current/hadoop-yarn/hadoop-yarn-site/FairScheduler.html#Configuration\" target=\"_blank\">Apache\n              wiki</a>.\n            </p></dd><dt><span class=\"hue-doc-codeph\">llama_site_path</span></dt><dd><b>Purpose:</b> Path to the configuration file used by admission control\n            (<span class=\"hue-doc-codeph\">llama-site.xml</span>). If set,\n            <span class=\"hue-doc-codeph\">fair_scheduler_allocation_path</span> must also be set.\n            <p id=\"type_string\"><b>Type:</b> string\n      </p><p><b>Default:</b><span class=\"hue-doc-codeph\">\"\"</span> (empty string)\n            </p><p><b>Usage notes:</b> Admission control only uses a few of the settings that can go\n              in this file, as described below.\n            </p></dd></dl></div></div></div></div>","title":"Configuring Admission Control"}