{"body":"<div><div id=\"order_by\"><div class=\"hue-doc-title\">ORDER BY Clause</div><div><p>\n      The familiar <span class=\"hue-doc-codeph\">ORDER BY</span> clause of a <span class=\"hue-doc-codeph\">SELECT</span> statement sorts the result set\n      based on the values from one or more columns.\n    </p><p>\n      For distributed queries, this is a relatively expensive operation, because the entire result set must be\n      produced and transferred to one node before the sorting can happen. This can require more memory capacity\n      than a query without <span class=\"hue-doc-codeph\">ORDER BY</span>. Even if the query takes approximately the same time to finish\n      with or without the <span class=\"hue-doc-codeph\">ORDER BY</span> clause, subjectively it can appear slower because no results\n      are available until all processing is finished, rather than results coming back gradually as rows matching\n      the <span class=\"hue-doc-codeph\">WHERE</span> clause are found. Therefore, if you only need the first N results from the sorted\n      result set, also include the <span class=\"hue-doc-codeph\">LIMIT</span> clause, which reduces network overhead and the memory\n      requirement on the coordinator node.\n    </p><div class=\"hue-doc-note\"><p>\n        In Impala 1.4.0 and higher, the <span class=\"hue-doc-codeph\">LIMIT</span> clause is now optional (rather than required) for\n        queries that use the <span class=\"hue-doc-codeph\">ORDER BY</span> clause. Impala automatically uses a temporary disk work area\n        to perform the sort if the sort operation would otherwise exceed the Impala memory limit for a particular\n        DataNode.\n      </p></div><p id=\"syntax_blurb\"><b>Syntax:</b></p><p>\n      The full syntax for the <span class=\"hue-doc-codeph\">ORDER BY</span> clause is:\n    </p><div class=\"hue-doc-codeblock\">ORDER BY <span class=\"hue-doc-varname\">col_ref</span> [, <span class=\"hue-doc-varname\">col_ref</span> ...] [ASC | DESC] [NULLS FIRST | NULLS LAST]\n\ncol_ref ::= <span class=\"hue-doc-varname\">column_name</span> | <span class=\"hue-doc-varname\">integer_literal</span></div><p>\n      Although the most common usage is <span class=\"hue-doc-codeph\">ORDER BY <span class=\"hue-doc-varname\">column_name</span></span>, you can also\n      specify <span class=\"hue-doc-codeph\">ORDER BY 1</span> to sort by the first column of the result set, <span class=\"hue-doc-codeph\">ORDER BY\n      2</span> to sort by the second column, and so on. The number must be a numeric literal, not some other kind\n      of constant expression. (If the argument is some other expression, even a <span class=\"hue-doc-codeph\">STRING</span> value, the\n      query succeeds but the order of results is undefined.)\n    </p><p><span class=\"hue-doc-codeph\">ORDER BY <span class=\"hue-doc-varname\">column_number</span></span> can only be used when the query explicitly lists\n      the columns in the <span class=\"hue-doc-codeph\">SELECT</span> list, not with <span class=\"hue-doc-codeph\">SELECT *</span> queries.\n    </p><p><b>Ascending and descending sorts:</b></p><p>\n      The default sort order (the same as using the <span class=\"hue-doc-codeph\">ASC</span> keyword) puts the smallest values at the\n      start of the result set, and the largest values at the end. Specifying the <span class=\"hue-doc-codeph\">DESC</span> keyword\n      reverses that order.\n    </p><p><b>Sort order for NULL values:</b></p><p>\n      See <a class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"topics/impala_literals.xml\" data-doc-anchor-id=\"null\">NULL</a> for details about how <span class=\"hue-doc-codeph\">NULL</span> values are positioned\n      in the sorted result set, and how to use the <span class=\"hue-doc-codeph\">NULLS FIRST</span> and <span class=\"hue-doc-codeph\">NULLS LAST</span>\n      clauses. (The sort position for <span class=\"hue-doc-codeph\">NULL</span> values in <span class=\"hue-doc-codeph\">ORDER BY ... DESC</span> queries is\n      changed in Impala 1.2.1 and higher to be more standards-compliant, and the <span class=\"hue-doc-codeph\">NULLS FIRST</span> and\n      <span class=\"hue-doc-codeph\">NULLS LAST</span> keywords are new in Impala 1.2.1.)\n    </p><p id=\"order_by_limit\">\n        Prior to Impala 1.4.0, Impala required any query including an\n        <span class=\"hue-doc-codeph\"><a class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"topics/impala_order_by.xml\" data-doc-anchor-id=\"order_by\">ORDER BY</a></span> clause to also use a\n        <span class=\"hue-doc-codeph\"><a class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"topics/impala_limit.xml\" data-doc-anchor-id=\"limit\">LIMIT</a></span> clause. In Impala 1.4.0 and\n        higher, the <span class=\"hue-doc-codeph\">LIMIT</span> clause is optional for <span class=\"hue-doc-codeph\">ORDER BY</span> queries. In cases where\n        sorting a huge result set requires enough memory to exceed the Impala memory limit for a particular node,\n        Impala automatically uses a temporary disk work area to perform the sort operation.\n      </p><p id=\"complex_types_blurb\"><b>Complex type considerations:</b></p><p>\n      In Impala 2.3 and higher, the complex data types <span class=\"hue-doc-codeph\">STRUCT</span>,\n      <span class=\"hue-doc-codeph\">ARRAY</span>, and <span class=\"hue-doc-codeph\">MAP</span> are available. These columns cannot\n      be referenced directly in the <span class=\"hue-doc-codeph\">ORDER BY</span> clause.\n      When you query a complex type column, you use join notation to <q>unpack</q> the elements\n      of the complex type, and within the join query you can include an <span class=\"hue-doc-codeph\">ORDER BY</span>\n      clause to control the order in the result set of the scalar elements from the complex type.\n      See <a class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"topics/impala_complex_types.xml\" data-doc-anchor-id=\"complex_types\">Complex Types (Impala 2.3 or higher only)</a> for details about Impala support for complex types.\n    </p><p>\n      The following query shows how a complex type column cannot be directly used in an <span class=\"hue-doc-codeph\">ORDER BY</span> clause:\n    </p><div class=\"hue-doc-codeblock\">CREATE TABLE games (id BIGINT, score ARRAY &lt;BIGINT&gt;) STORED AS PARQUET;\n...use LOAD DATA to load externally created Parquet files into the table...\nSELECT id FROM games ORDER BY score DESC;\nERROR: AnalysisException: ORDER BY expression 'score' with complex type 'ARRAY&lt;BIGINT&gt;' is not supported.\n</div><p id=\"example_blurb\"><b>Examples:</b></p><p>\n      The following query retrieves the user ID and score, only for scores greater than one million,\n      with the highest scores for each user listed first.\n      Because the individual array elements are now represented as separate rows in the result set,\n      they can be used in the <span class=\"hue-doc-codeph\">ORDER BY</span> clause, referenced using the <span class=\"hue-doc-codeph\">ITEM</span>\n      pseudocolumn that represents each array element.\n    </p><div class=\"hue-doc-codeblock\">SELECT id, item FROM games, games.score\n  WHERE item &gt; 1000000\nORDER BY id, item desc;\n</div><p>\n      The following queries use similar <span class=\"hue-doc-codeph\">ORDER BY</span> techniques with variations of the <span class=\"hue-doc-codeph\">GAMES</span>\n      table, where the complex type is an <span class=\"hue-doc-codeph\">ARRAY</span> containing <span class=\"hue-doc-codeph\">STRUCT</span> or <span class=\"hue-doc-codeph\">MAP</span>\n      elements to represent additional details about each game that was played.\n      For an array of structures, the fields of the structure are referenced as <span class=\"hue-doc-codeph\">ITEM.<span class=\"hue-doc-varname\">field_name</span></span>.\n      For an array of maps, the keys and values within each array element are referenced as <span class=\"hue-doc-codeph\">ITEM.KEY</span>\n      and <span class=\"hue-doc-codeph\">ITEM.VALUE</span>.\n    </p><div class=\"hue-doc-codeblock\">CREATE TABLE games2 (id BIGINT, play array &lt; struct &lt;game_name: string, score: BIGINT, high_score: boolean&gt; &gt;) STORED AS PARQUET\n...use LOAD DATA to load externally created Parquet files into the table...\nSELECT id, item.game_name, item.score FROM games2, games2.play\n  WHERE item.score &gt; 1000000\nORDER BY id, item.score DESC;\n\nCREATE TABLE games3 (id BIGINT, play ARRAY &lt; MAP &lt;STRING, BIGINT&gt; &gt;) STORED AS PARQUET;\n...use LOAD DATA to load externally created Parquet files into the table...\nSELECT id, info.key AS k, info.value AS v from games3, games3.play AS plays, games3.play.item AS info\n  WHERE info.KEY = 'score' AND info.VALUE &gt; 1000000\nORDER BY id, info.value desc;\n</div><p id=\"usage_notes_blurb\"><b>Usage notes:</b></p><p>\n      Although the <span class=\"hue-doc-codeph\">LIMIT</span> clause is now optional on <span class=\"hue-doc-codeph\">ORDER BY</span> queries, if your\n      query only needs some number of rows that you can predict in advance, use the <span class=\"hue-doc-codeph\">LIMIT</span> clause\n      to reduce unnecessary processing. For example, if the query has a clause <span class=\"hue-doc-codeph\">LIMIT 10</span>, each data\n      node sorts its portion of the relevant result set and only returns 10 rows to the coordinator node. The\n      coordinator node picks the 10 highest or lowest row values out of this small intermediate result set.\n    </p><p>\n      If an <span class=\"hue-doc-codeph\">ORDER BY</span> clause is applied to an early phase of query processing, such as a subquery\n      or a view definition, Impala ignores the <span class=\"hue-doc-codeph\">ORDER BY</span> clause. To get ordered results from a\n      subquery or view, apply an <span class=\"hue-doc-codeph\">ORDER BY</span> clause to the outermost or final <span class=\"hue-doc-codeph\">SELECT</span>\n      level.\n    </p><p><span class=\"hue-doc-codeph\">ORDER BY</span> is often used in combination with <span class=\"hue-doc-codeph\">LIMIT</span> to perform <q>top-N</q>\n      queries:\n    </p><div class=\"hue-doc-codeblock\">SELECT user_id AS \"Top 10 Visitors\", SUM(page_views) FROM web_stats\n  GROUP BY page_views, user_id\n  ORDER BY SUM(page_views) DESC LIMIT 10;\n</div><p><span class=\"hue-doc-codeph\">ORDER BY</span> is sometimes used in combination with <span class=\"hue-doc-codeph\">OFFSET</span> and\n      <span class=\"hue-doc-codeph\">LIMIT</span> to paginate query results, although it is relatively inefficient to issue multiple\n      queries like this against the large tables typically used with Impala:\n    </p><div class=\"hue-doc-codeblock\">SELECT page_title AS \"Page 1 of search results\", page_url FROM search_content\n  WHERE LOWER(page_title) LIKE '%game%')\n  ORDER BY page_title LIMIT 10 OFFSET 0;\nSELECT page_title AS \"Page 2 of search results\", page_url FROM search_content\n  WHERE LOWER(page_title) LIKE '%game%')\n  ORDER BY page_title LIMIT 10 OFFSET 10;\nSELECT page_title AS \"Page 3 of search results\", page_url FROM search_content\n  WHERE LOWER(page_title) LIKE '%game%')\n  ORDER BY page_title LIMIT 10 OFFSET 20;\n</div><p id=\"internals_blurb\"><b>Internal details:</b></p><p>\n      Impala sorts the intermediate results of an <span class=\"hue-doc-codeph\">ORDER BY</span> clause in memory whenever practical. In\n      a cluster of N DataNodes, each node sorts roughly 1/Nth of the result set, the exact proportion varying\n      depending on how the data matching the query is distributed in HDFS.\n    </p><p>\n      If the size of the sorted intermediate result set on any DataNode would cause the query to exceed the Impala\n      memory limit, Impala sorts as much as practical in memory, then writes partially sorted data to disk. (This\n      technique is known in industry terminology as <q>external sorting</q> and <q>spilling to disk</q>.) As each\n      8 MB batch of data is written to disk, Impala frees the corresponding memory to sort a new 8 MB batch of\n      data. When all the data has been processed, a final merge sort operation is performed to correctly order the\n      in-memory and on-disk results as the result set is transmitted back to the coordinator node. When external\n      sorting becomes necessary, Impala requires approximately 60 MB of RAM at a minimum for the buffers needed to\n      read, write, and sort the intermediate results. If more RAM is available on the DataNode, Impala will use\n      the additional RAM to minimize the amount of disk I/O for sorting.\n    </p><p>\n      This external sort technique is used as appropriate on each DataNode (possibly including the coordinator\n      node) to sort the portion of the result set that is processed on that node. When the sorted intermediate\n      results are sent back to the coordinator node to produce the final result set, the coordinator node uses a\n      merge sort technique to produce a final sorted result set without using any extra resources on the\n      coordinator node.\n    </p><p><b>Configuration for disk usage:</b></p><p id=\"order_by_scratch_dir\">\n        By default, intermediate files used during large sort, join, aggregation, or analytic function operations\n        are stored in the directory <span class=\"hue-doc-filepath\">/tmp/impala-scratch</span> . These files are removed when the\n        operation finishes. (Multiple concurrent queries can perform operations that use the <q>spill to disk</q>\n        technique, without any name conflicts for these temporary files.) You can specify a different location by\n        starting the <span class=\"hue-doc-cmdname\">impalad</span> daemon with the\n        <span class=\"hue-doc-codeph\">--scratch_dirs=\"<span class=\"hue-doc-varname\">path_to_directory</span>\"</span> configuration option.\n        You can specify a single directory, or a comma-separated list of directories. The scratch directories must\n        be on the local filesystem, not in HDFS. You might specify different directory paths for different hosts,\n        depending on the capacity and speed\n        of the available storage devices. In Impala 2.3 or higher, Impala successfully starts (with a warning\n        Impala successfully starts (with a warning written to the log) if it cannot create or read and write files\n        in one of the scratch directories. If there is less than 1 GB free on the filesystem where that directory resides,\n        Impala still runs, but writes a warning message to its log.  If Impala encounters an error reading or writing\n        files in a scratch directory during a query, Impala logs the error and the query fails.\n      </p><p id=\"insert_sort_blurb\"><b>Sorting considerations:</b> Although you can specify an <span class=\"hue-doc-codeph\">ORDER BY</span> clause in an\n        <span class=\"hue-doc-codeph\">INSERT ... SELECT</span> statement, any <span class=\"hue-doc-codeph\">ORDER BY</span> clause is ignored and the\n        results are not necessarily sorted. An <span class=\"hue-doc-codeph\">INSERT ... SELECT</span> operation potentially creates\n        many different data files, prepared on different data nodes, and therefore the notion of the data being\n        stored in sorted order is impractical.\n      </p><p id=\"order_by_view_restriction\">\n        An <span class=\"hue-doc-codeph\">ORDER BY</span> clause without an additional <span class=\"hue-doc-codeph\">LIMIT</span> clause is ignored in any\n        view definition. If you need to sort the entire result set from a view, use an <span class=\"hue-doc-codeph\">ORDER BY</span>\n        clause in the <span class=\"hue-doc-codeph\">SELECT</span> statement that queries the view. You can still make a simple <q>top\n        10</q> report by combining the <span class=\"hue-doc-codeph\">ORDER BY</span> and <span class=\"hue-doc-codeph\">LIMIT</span> clauses in the same\n        view definition:\n<div class=\"hue-doc-codeblock\">[localhost:21000] &gt; create table unsorted (x bigint);\n[localhost:21000] &gt; insert into unsorted values (1), (9), (3), (7), (5), (8), (4), (6), (2);\n[localhost:21000] &gt; create view sorted_view as select x from unsorted order by x;\n[localhost:21000] &gt; select x from sorted_view; -- ORDER BY clause in view has no effect.\n+---+\n| x |\n+---+\n| 1 |\n| 9 |\n| 3 |\n| 7 |\n| 5 |\n| 8 |\n| 4 |\n| 6 |\n| 2 |\n+---+\n[localhost:21000] &gt; select x from sorted_view order by x; -- View query requires ORDER BY at outermost level.\n+---+\n| x |\n+---+\n| 1 |\n| 2 |\n| 3 |\n| 4 |\n| 5 |\n| 6 |\n| 7 |\n| 8 |\n| 9 |\n+---+\n[localhost:21000] &gt; create view top_3_view as select x from unsorted order by x limit 3;\n[localhost:21000] &gt; select x from top_3_view; -- ORDER BY and LIMIT together in view definition are preserved.\n+---+\n| x |\n+---+\n| 1 |\n| 2 |\n| 3 |\n+---+\n</div></p><p>\n      With the lifting of the requirement to include a <span class=\"hue-doc-codeph\">LIMIT</span> clause in every <span class=\"hue-doc-codeph\">ORDER\n      BY</span> query (in Impala 1.4 and higher):\n    </p><ul><li><p>\n          Now the use of scratch disk space raises the possibility of an <q>out of disk space</q> error on a\n          particular DataNode, as opposed to the previous possibility of an <q>out of memory</q> error. Make sure\n          to keep at least 1 GB free on the filesystem used for temporary sorting work.\n        </p></li></ul><p id=\"null_sorting_change\">\n        In Impala 1.2.1 and higher, all <span class=\"hue-doc-codeph\">NULL</span> values come at the end of the result set for\n        <span class=\"hue-doc-codeph\">ORDER BY ... ASC</span> queries, and at the beginning of the result set for <span class=\"hue-doc-codeph\">ORDER BY ...\n        DESC</span> queries. In effect, <span class=\"hue-doc-codeph\">NULL</span> is considered greater than all other values for\n        sorting purposes. The original Impala behavior always put <span class=\"hue-doc-codeph\">NULL</span> values at the end, even for\n        <span class=\"hue-doc-codeph\">ORDER BY ... DESC</span> queries. The new behavior in Impala 1.2.1 makes Impala more compatible\n        with other popular database systems. In Impala 1.2.1 and higher, you can override or specify the sorting\n        behavior for <span class=\"hue-doc-codeph\">NULL</span> by adding the clause <span class=\"hue-doc-codeph\">NULLS FIRST</span> or <span class=\"hue-doc-codeph\">NULLS\n        LAST</span> at the end of the <span class=\"hue-doc-codeph\">ORDER BY</span> clause.\n      </p><div class=\"hue-doc-codeblock\">[localhost:21000] &gt; create table numbers (x int);\n[localhost:21000] &gt; insert into numbers values (1), (null), (2), (null), (3);\n[localhost:21000] &gt; select x from numbers order by x nulls first;\n+------+\n| x    |\n+------+\n| NULL |\n| NULL |\n| 1    |\n| 2    |\n| 3    |\n+------+\n[localhost:21000] &gt; select x from numbers order by x desc nulls first;\n+------+\n| x    |\n+------+\n| NULL |\n| NULL |\n| 3    |\n| 2    |\n| 1    |\n+------+\n[localhost:21000] &gt; select x from numbers order by x nulls last;\n+------+\n| x    |\n+------+\n| 1    |\n| 2    |\n| 3    |\n| NULL |\n| NULL |\n+------+\n[localhost:21000] &gt; select x from numbers order by x desc nulls last;\n+------+\n| x    |\n+------+\n| 3    |\n| 2    |\n| 1    |\n| NULL |\n| NULL |\n+------+\n</div><p id=\"related_info\"><b>Related information:</b></p><p>\n      See <a class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"topics/impala_select.xml\" data-doc-anchor-id=\"select\">SELECT Statement</a> for further examples of queries with the <span class=\"hue-doc-codeph\">ORDER\n      BY</span> clause.\n    </p><p>\n      Analytic functions use the <span class=\"hue-doc-codeph\">ORDER BY</span> clause in a different context to define the sequence in\n      which rows are analyzed. See <a class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"topics/impala_analytic_functions.xml\" data-doc-anchor-id=\"analytic_functions\">Impala Analytic Functions</a> for details.\n    </p></div></div></div>","title":"ORDER BY Clause"}