{"body":"<div><div id=\"views\"><div class=\"hue-doc-title\">Overview of Impala Views</div><div><p>\n      Views are lightweight logical constructs that act as aliases for queries. You can specify a view name in a\n      query (a <span class=\"hue-doc-codeph\">SELECT</span> statement or the <span class=\"hue-doc-codeph\">SELECT</span> portion of an\n      <span class=\"hue-doc-codeph\">INSERT</span> statement) where you would usually specify a table name.\n    </p><p>\n      A view lets you:\n    </p><ul><li>\n        Issue complicated queries with compact and simple syntax:\n<div class=\"hue-doc-codeblock\">-- Take a complicated reporting query, plug it into a CREATE VIEW statement...\ncreate view v1 as select c1, c2, avg(c3) from t1 group by c3 order by c1 desc limit 10;\n-- ... and now you can produce the report with 1 line of code.\nselect * from v1;</div></li><li>\n        Reduce maintenance, by avoiding the duplication of complicated queries across multiple applications in\n        multiple languages:\n<div class=\"hue-doc-codeblock\">create view v2 as select t1.c1, t1.c2, t2.c3 from t1 join t2 on (t1.id = t2.id);\n-- This simple query is safer to embed in reporting applications than the longer query above.\n-- The view definition can remain stable even if the structure of the underlying tables changes.\nselect c1, c2, c3 from v2;</div></li><li>\n        Build a new, more refined query on top of the original query by adding new clauses, select-list\n        expressions, function calls, and so on:\n<div class=\"hue-doc-codeblock\">create view average_price_by_category as select category, avg(price) as avg_price from products group by category;\ncreate view expensive_categories as select category, avg_price from average_price_by_category order by avg_price desc limit 10000;\ncreate view top_10_expensive_categories as select category, avg_price from expensive_categories limit 10;</div>\n        This technique lets you build up several more or less granular variations of the same query, and switch\n        between them when appropriate.\n</li><li>\n        Set up aliases with intuitive names for tables, columns, result sets from joins, and so on:\n<div class=\"hue-doc-codeblock\">-- The original tables might have cryptic names inherited from a legacy system.\ncreate view action_items as select rrptsk as assignee, treq as due_date, dmisc as notes from vxy_t1_br;\n-- You can leave original names for compatibility, build new applications using more intuitive ones.\nselect assignee, due_date, notes from action_items;</div></li><li>\n        Swap tables with others that use different file formats, partitioning schemes, and so on without any\n        downtime for data copying or conversion:\n<div class=\"hue-doc-codeblock\">create table slow (x int, s string) stored as textfile;\ncreate view report as select s from slow where x between 20 and 30;\n-- Query is kind of slow due to inefficient table definition, but it works.\nselect * from report;\n\ncreate table fast (s string) partitioned by (x int) stored as parquet;\n-- ...Copy data from SLOW to FAST. Queries against REPORT view continue to work...\n\n-- After changing the view definition, queries will be faster due to partitioning,\n-- binary format, and compression in the new table.\nalter view report as select s from fast where x between 20 and 30;\nselect * from report;</div></li><li>\n        Avoid coding lengthy subqueries and repeating the same subquery text in many other queries.\n      </li><li>\n        Set up fine-grained security where a user can query some columns from a table but not other columns.\n        Because Impala 2.3 and higher support column-level authorization, this technique is no longer\n        required. If you formerly implemented column-level security through views, see\n        \n    the documentation for Apache Sentry\n   for details about the column-level authorization feature.\n      </li></ul><p>\n      The SQL statements that configure views are <a class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"topics/impala_create_view.xml\" data-doc-anchor-id=\"create_view\">CREATE VIEW Statement</a>,\n      <a class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"topics/impala_alter_view.xml\" data-doc-anchor-id=\"alter_view\">ALTER VIEW Statement</a>, and <a class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"topics/impala_drop_view.xml\" data-doc-anchor-id=\"drop_view\">DROP VIEW Statement</a>. You can\n      specify view names when querying data (<a class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"topics/impala_select.xml\" data-doc-anchor-id=\"select\">SELECT Statement</a>) and copying data from one\n      table to another (<a class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"topics/impala_insert.xml\" data-doc-anchor-id=\"insert\">INSERT Statement</a>). The <a class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"topics/impala_with.xml\" data-doc-anchor-id=\"with\">WITH</a>\n      clause creates an inline view, that only exists for the duration of a single query.\n    </p><div class=\"hue-doc-codeblock\">[localhost:21000] &gt; create view trivial as select * from customer;\n[localhost:21000] &gt; create view some_columns as select c_first_name, c_last_name, c_login from customer;\n[localhost:21000] &gt; select * from some_columns limit 5;\nQuery finished, fetching results ...\n+--------------+-------------+---------+\n| c_first_name | c_last_name | c_login |\n+--------------+-------------+---------+\n| Javier       | Lewis       |         |\n| Amy          | Moses       |         |\n| Latisha      | Hamilton    |         |\n| Michael      | White       |         |\n| Robert       | Moran       |         |\n+--------------+-------------+---------+\n[localhost:21000] &gt; create view ordered_results as select * from some_columns order by c_last_name desc, c_first_name desc limit 1000;\n[localhost:21000] &gt; select * from ordered_results limit 5;\nQuery: select * from ordered_results limit 5\nQuery finished, fetching results ...\n+--------------+-------------+---------+\n| c_first_name | c_last_name | c_login |\n+--------------+-------------+---------+\n| Thomas       | Zuniga      |         |\n| Sarah        | Zuniga      |         |\n| Norma        | Zuniga      |         |\n| Lloyd        | Zuniga      |         |\n| Lisa         | Zuniga      |         |\n+--------------+-------------+---------+\nReturned 5 row(s) in 0.48s</div><p>\n      The previous example uses descending order for <span class=\"hue-doc-codeph\">ORDERED_RESULTS</span> because in the sample TPCD-H\n      data, there are some rows with empty strings for both <span class=\"hue-doc-codeph\">C_FIRST_NAME</span> and\n      <span class=\"hue-doc-codeph\">C_LAST_NAME</span>, making the lowest-ordered names unuseful in a sample query.\n    </p><div class=\"hue-doc-codeblock\">create view visitors_by_day as select day, count(distinct visitors) as howmany from web_traffic group by day;\ncreate view top_10_days as select day, howmany from visitors_by_day order by howmany limit 10;\nselect * from top_10_days;</div><p id=\"usage_notes_blurb\"><b>Usage notes:</b></p><p id=\"describe_formatted_view\">\n        To see the definition of a view, issue a <span class=\"hue-doc-codeph\">DESCRIBE FORMATTED</span> statement,\n        which shows the query from the original <span class=\"hue-doc-codeph\">CREATE VIEW</span> statement:\n<div class=\"hue-doc-codeblock\">[localhost:21000] &gt; create view v1 as select * from t1;\n[localhost:21000] &gt; describe formatted v1;\nQuery finished, fetching results ...\n+------------------------------+------------------------------+------------+\n| name                         | type                         | comment    |\n+------------------------------+------------------------------+------------+\n| # col_name                   | data_type                    | comment    |\n|                              | NULL                         | NULL       |\n| x                            | int                          | None       |\n| y                            | int                          | None       |\n| s                            | string                       | None       |\n|                              | NULL                         | NULL       |\n| # Detailed Table Information | NULL                         | NULL       |\n| Database:                    | views                        | NULL       |\n| Owner:                       | doc_demo                     | NULL       |\n| CreateTime:                  | Mon Jul 08 15:56:27 EDT 2013 | NULL       |\n| LastAccessTime:              | UNKNOWN                      | NULL       |\n| Protect Mode:                | None                         | NULL       |\n| Retention:                   | 0                            | NULL       |\n<b>| Table Type:                  | VIRTUAL_VIEW                 | NULL       |</b>\n| Table Parameters:            | NULL                         | NULL       |\n|                              | transient_lastDdlTime        | 1373313387 |\n|                              | NULL                         | NULL       |\n| # Storage Information        | NULL                         | NULL       |\n| SerDe Library:               | null                         | NULL       |\n| InputFormat:                 | null                         | NULL       |\n| OutputFormat:                | null                         | NULL       |\n| Compressed:                  | No                           | NULL       |\n| Num Buckets:                 | 0                            | NULL       |\n| Bucket Columns:              | []                           | NULL       |\n| Sort Columns:                | []                           | NULL       |\n|                              | NULL                         | NULL       |\n| # View Information           | NULL                         | NULL       |\n<b>| View Original Text:          | SELECT * FROM t1             | NULL       |\n| View Expanded Text:          | SELECT * FROM t1             | NULL       |</b>\n+------------------------------+------------------------------+------------+\n</div></p><p id=\"create_table_like_view\">\n        Prior to Impala 1.4.0, it was not possible to use the <span class=\"hue-doc-codeph\">CREATE TABLE LIKE\n        <span class=\"hue-doc-varname\">view_name</span></span> syntax. In Impala 1.4.0 and higher, you can create\n        a table with the same column definitions as a view using the <span class=\"hue-doc-codeph\">CREATE TABLE\n        LIKE</span> technique. Although <span class=\"hue-doc-codeph\">CREATE TABLE LIKE</span> normally inherits\n        the file format of the original table, a view has no underlying file format, so\n        <span class=\"hue-doc-codeph\">CREATE TABLE LIKE <span class=\"hue-doc-varname\">view_name</span></span> produces a text table by\n        default. To specify a different file format, include a <span class=\"hue-doc-codeph\">STORED AS\n        <span class=\"hue-doc-varname\">file_format</span></span> clause at the end of the <span class=\"hue-doc-codeph\">CREATE TABLE\n        LIKE</span> statement.\n      </p><p id=\"complex_types_blurb\"><b>Complex type considerations:</b></p><p id=\"complex_types_views\">\n        For tables containing complex type columns (<span class=\"hue-doc-codeph\">ARRAY</span>,\n        <span class=\"hue-doc-codeph\">STRUCT</span>, or <span class=\"hue-doc-codeph\">MAP</span>), you typically use join queries to\n        refer to the complex values. You can use views to hide the join notation, making such\n        tables seem like traditional denormalized tables, and making those tables queryable by\n        business intelligence tools that do not have built-in support for those complex types.\n        See <a class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"topics/impala_complex_types.xml\" data-doc-anchor-id=\"complex_types_views\">Accessing Complex Type Data in Flattened Form Using Views</a> for details.\n      </p><p id=\"straight_join_nested_queries\">\n        The <span class=\"hue-doc-codeph\">STRAIGHT_JOIN</span> hint affects the join order of table references in\n        the query block containing the hint. It does not affect the join order of nested\n        queries, such as views, inline views, or <span class=\"hue-doc-codeph\">WHERE</span>-clause subqueries. To\n        use this hint for performance tuning of complex queries, apply the hint to all query\n        blocks that need a fixed join order.\n      </p><p id=\"restrictions_blurb\"><b>Restrictions:</b></p><ul><li><p>\n          You cannot insert into an Impala view. (In some database systems, this operation is allowed and inserts\n          rows into the base table.) You can use a view name on the right-hand side of an <span class=\"hue-doc-codeph\">INSERT</span>\n          statement, in the <span class=\"hue-doc-codeph\">SELECT</span> part.\n        </p></li><li><p id=\"partitions_and_views\">\n        If a view applies to a partitioned table, any partition pruning considers the clauses on\n        both the original query and any additional <span class=\"hue-doc-codeph\">WHERE</span> predicates in the\n        query that refers to the view. Prior to Impala 1.4, only the <span class=\"hue-doc-codeph\">WHERE</span>\n        clauses on the original query from the <span class=\"hue-doc-codeph\">CREATE VIEW</span> statement were used\n        for partition pruning.\n      </p></li><li><p id=\"order_by_view_restriction\">\n        An <span class=\"hue-doc-codeph\">ORDER BY</span> clause without an additional <span class=\"hue-doc-codeph\">LIMIT</span> clause\n        is ignored in any view definition. If you need to sort the entire result set from a\n        view, use an <span class=\"hue-doc-codeph\">ORDER BY</span> clause in the <span class=\"hue-doc-codeph\">SELECT</span> statement\n        that queries the view. You can still make a simple <q>top 10</q> report by combining the\n        <span class=\"hue-doc-codeph\">ORDER BY</span> and <span class=\"hue-doc-codeph\">LIMIT</span> clauses in the same view\n        definition:\n<div class=\"hue-doc-codeblock\">[localhost:21000] &gt; create table unsorted (x bigint);\n[localhost:21000] &gt; insert into unsorted values (1), (9), (3), (7), (5), (8), (4), (6), (2);\n[localhost:21000] &gt; create view sorted_view as select x from unsorted order by x;\n[localhost:21000] &gt; select x from sorted_view; -- ORDER BY clause in view has no effect.\n+---+\n| x |\n+---+\n| 1 |\n| 9 |\n| 3 |\n| 7 |\n| 5 |\n| 8 |\n| 4 |\n| 6 |\n| 2 |\n+---+\n[localhost:21000] &gt; select x from sorted_view order by x; -- View query requires ORDER BY at outermost level.\n+---+\n| x |\n+---+\n| 1 |\n| 2 |\n| 3 |\n| 4 |\n| 5 |\n| 6 |\n| 7 |\n| 8 |\n| 9 |\n+---+\n[localhost:21000] &gt; create view top_3_view as select x from unsorted order by x limit 3;\n[localhost:21000] &gt; select x from top_3_view; -- ORDER BY and LIMIT together in view definition are preserved.\n+---+\n| x |\n+---+\n| 1 |\n| 2 |\n| 3 |\n+---+\n</div></p></li><li><p id=\"tablesample_caveat\">\n        The <span class=\"hue-doc-codeph\">TABLESAMPLE</span> clause of the <span class=\"hue-doc-codeph\">SELECT</span> statement does\n        not apply to a table reference derived from a view, a subquery, or anything other than a\n        real base table. This clause only works for tables backed by HDFS or HDFS-like data\n        files, therefore it does not apply to Kudu or HBase tables.\n      </p></li></ul><p><b>Related statements:</b><a class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"topics/impala_create_view.xml\" data-doc-anchor-id=\"create_view\">CREATE VIEW Statement</a>,\n      <a class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"topics/impala_alter_view.xml\" data-doc-anchor-id=\"alter_view\">ALTER VIEW Statement</a>, <a class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"topics/impala_drop_view.xml\" data-doc-anchor-id=\"drop_view\">DROP VIEW Statement</a></p></div></div></div>","title":"Overview of Impala Views"}