{"body":"<div><div id=\"breakpad\"><div class=\"hue-doc-title\">Breakpad Minidumps for Impala (Impala 2.6 or higher only)</div><div><p>\n      The <a class=\"hue-doc-external-link\" href=\"https://chromium.googlesource.com/breakpad/breakpad/\" target=\"_blank\">breakpad</a>\n      project is an open-source framework for crash reporting.\n      In Impala 2.6 and higher, Impala can use <span class=\"hue-doc-codeph\">breakpad</span> to record stack information and\n      register values when any of the Impala-related daemons crash due to an error such as <span class=\"hue-doc-codeph\">SIGSEGV</span>\n      or unhandled exceptions.\n      The dump files are much smaller than traditional core dump files. The dump mechanism itself uses very little\n      memory, which improves reliability if the crash occurs while the system is low on memory.\n    </p><div class=\"hue-doc-note\">      Because of the internal mechanisms involving Impala memory allocation and Linux\n      signalling for out-of-memory (OOM) errors, if an Impala-related daemon experiences a\n      crash due to an OOM condition, it does <i>not</i> generate a minidump for that error.\n    <p/></div></div><div id=\"breakpad_minidump_enable\"><div class=\"hue-doc-title\">Enabling or Disabling Minidump Generation</div><div><p>\n        By default, a minidump file is generated when an Impala-related daemon\n        crashes.\n      </p><p>\n        To turn off generation of the minidump files, use one of the following\n        options:\n\n        <ul><li>\n            Set the <span class=\"hue-doc-codeph\">--enable_minidumps</span> configuration setting\n            to <span class=\"hue-doc-codeph\">false</span>. Restart the corresponding services or\n            daemons.\n          </li><li>\n            Set the <span class=\"hue-doc-codeph\">--minidump_path</span> configuration setting to\n            an empty string. Restart the corresponding services or daemons.\n          </li></ul></p><p>\n        In Impala 2.7 and higher,\n        you can send a <span class=\"hue-doc-codeph\">SIGUSR1</span> signal to any Impala-related daemon to write a\n        Breakpad minidump. For advanced troubleshooting, you can now produce a minidump\n        without triggering a crash.\n      </p></div></div><div id=\"breakpad_minidump_location\"><div class=\"hue-doc-title\">Specifying the Location for Minidump Files</div><div><p>\n        By default, all minidump files are written to the following location\n        on the host where a crash occurs:\n        <ul><li><p>\n              Clusters not managed by cluster management software:\n              <span class=\"hue-doc-filepath\"><span class=\"hue-doc-varname\">impala_log_dir</span>/<span class=\"hue-doc-varname\">daemon_name</span>/minidumps/<span class=\"hue-doc-varname\">daemon_name</span></span></p></li></ul>\n        The minidump files for <span class=\"hue-doc-cmdname\">impalad</span>, <span class=\"hue-doc-cmdname\">catalogd</span>,\n        and <span class=\"hue-doc-cmdname\">statestored</span> are each written to a separate directory.\n      </p><p>\n        To specify a different location, set the\n        <div class=\"hue-doc-uicontrol\">minidump_path</div>\n        configuration setting of one or more Impala-related daemons, and restart the corresponding services or daemons.\n      </p><p>\n        If you specify a relative path for this setting, the value is interpreted relative to\n        the default <div class=\"hue-doc-uicontrol\">minidump_path</div> directory.\n      </p></div></div><div id=\"breakpad_minidump_number\"><div class=\"hue-doc-title\">Controlling the Number of Minidump Files</div><div><p>\n        Like any files used for logging or troubleshooting, consider limiting the number of\n        minidump files, or removing unneeded ones, depending on the amount of free storage\n        space on the hosts in the cluster.\n      </p><p>\n        Because the minidump files are only used for problem resolution, you can remove any such files that\n        are not needed to debug current issues.\n      </p><p>\n        To control how many minidump files Impala keeps around at any one time,\n        set the <div class=\"hue-doc-uicontrol\">max_minidumps</div> configuration setting for\n        of one or more Impala-related daemon, and restart the corresponding services or daemons.\n        The default for this setting is 9. A zero or negative value is interpreted as\n        <q>unlimited</q>.\n      </p></div></div><div id=\"breakpad_minidump_logging\"><div class=\"hue-doc-title\">Detecting Crash Events</div><div><p>\n        You can see in the Impala log files when crash events occur that generate\n        minidump files. Because each restart begins a new log file, the <q>crashed</q> message\n        is always at or near the bottom of the log file. There might be another later message\n        if core dumps are also enabled.\n      </p></div></div><div id=\"breakpad_demo\"><div class=\"hue-doc-title\">Demonstration of Breakpad Feature</div><div><p>\n        The following example uses the command <span class=\"hue-doc-cmdname\">kill -11</span> to\n        simulate a <span class=\"hue-doc-codeph\">SIGSEGV</span> crash for an <span class=\"hue-doc-cmdname\">impalad</span>\n        process on a single DataNode, then examines the relevant log files and minidump file.\n      </p><p>\n        First, as root on a worker node, kill the <span class=\"hue-doc-cmdname\">impalad</span> process with a\n        <span class=\"hue-doc-codeph\">SIGSEGV</span> error. The original process ID was 23114.\n      </p><div class=\"hue-doc-codeblock\"># ps ax | grep impalad\n23114 ?        Sl     0:18 /opt/local/parcels/&lt;parcel_version&gt;/lib/impala/sbin/impalad --flagfile=/var/run/impala/process/114-impala-IMPALAD/impala-conf/impalad_flags\n31259 pts/0    S+     0:00 grep impalad\n#\n# kill -11 23114\n#\n# ps ax | grep impalad\n31374 ?        Rl     0:04 /opt/local/parcels/&lt;parcel_version&gt;/lib/impala/sbin/impalad --flagfile=/var/run/impala/process/114-impala-IMPALAD/impala-conf/impalad_flags\n31475 pts/0    S+     0:00 grep impalad\n</div><p>\n        We locate the log directory underneath <span class=\"hue-doc-filepath\">/var/log</span>.\n        There is a <span class=\"hue-doc-codeph\">.INFO</span>, <span class=\"hue-doc-codeph\">.WARNING</span>, and <span class=\"hue-doc-codeph\">.ERROR</span>\n        log file for the 23114 process ID. The minidump message is written to the\n        <span class=\"hue-doc-codeph\">.INFO</span> file and the <span class=\"hue-doc-codeph\">.ERROR</span> file, but not the\n        <span class=\"hue-doc-codeph\">.WARNING</span> file. In this case, a large core file was also produced.\n      </p><div class=\"hue-doc-codeblock\"># cd /var/log/impalad\n# ls -la | grep 23114\n-rw-------   1 impala impala 3539079168 Jun 23 15:20 core.23114\n-rw-r--r--   1 impala impala      99057 Jun 23 15:20 hs_err_pid23114.log\n-rw-r--r--   1 impala impala        351 Jun 23 15:20 impalad.worker_node_123.impala.log.ERROR.20160623-140343.23114\n-rw-r--r--   1 impala impala      29101 Jun 23 15:20 impalad.worker_node_123.impala.log.INFO.20160623-140343.23114\n-rw-r--r--   1 impala impala        228 Jun 23 14:03 impalad.worker_node_123.impala.log.WARNING.20160623-140343.23114\n</div><p>\n        The <span class=\"hue-doc-codeph\">.INFO</span> log includes the location of the minidump file, followed by\n        a report of a core dump. With the breakpad minidump feature enabled, now we might\n        disable core dumps or keep fewer of them around.\n      </p><div class=\"hue-doc-codeblock\"># cat impalad.worker_node_123.impala.log.INFO.20160623-140343.23114\n...\nWrote minidump to /var/log/impala-minidumps/impalad/0980da2d-a905-01e1-25ff883a-04ee027a.dmp\n#\n# A fatal error has been detected by the Java Runtime Environment:\n#\n#  SIGSEGV (0xb) at pc=0x00000030c0e0b68a, pid=23114, tid=139869541455968\n#\n# JRE version: Java(TM) SE Runtime Environment (7.0_67-b01) (build 1.7.0_67-b01)\n# Java VM: Java HotSpot(TM) 64-Bit Server VM (24.65-b04 mixed mode linux-amd64 compressed oops)\n# Problematic frame:\n# C  [libpthread.so.0+0xb68a]  pthread_cond_wait+0xca\n#\n# Core dump written. Default location: /var/log/impalad/core or core.23114\n#\n# An error report file with more information is saved as:\n# /var/log/impalad/hs_err_pid23114.log\n#\n# If you would like to submit a bug report, please visit:\n#   http://bugreport.sun.com/bugreport/crash.jsp\n# The crash happened outside the Java Virtual Machine in native code.\n# See problematic frame for where to report the bug.\n...\n\n# cat impalad.worker_node_123.impala.log.ERROR.20160623-140343.23114\n\nLog file created at: 2016/06/23 14:03:43\nRunning on machine:.worker_node_123\nLog line format: [IWEF]mmdd hh:mm:ss.uuuuuu threadid file:line] msg\nE0623 14:03:43.911002 23114 logging.cc:118] stderr will be logged to this file.\nWrote minidump to /var/log/impala-minidumps/impalad/0980da2d-a905-01e1-25ff883a-04ee027a.dmp\n</div><p>\n        The resulting minidump file is much smaller than the corresponding core file,\n        making it much easier to supply diagnostic information to the appropriate support channel.\n      </p><div class=\"hue-doc-codeblock\"># pwd\n/var/log/impalad\n# cd ../impala-minidumps/impalad\n# ls\n0980da2d-a905-01e1-25ff883a-04ee027a.dmp\n# du -kh *\n2.4M  0980da2d-a905-01e1-25ff883a-04ee027a.dmp\n</div></div></div></div></div>","title":"Breakpad Minidumps for Impala (Impala 2.6 or higher only)"}