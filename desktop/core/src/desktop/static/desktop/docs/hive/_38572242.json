{"body":"<div><div>\n        <div id=\"title\">\n                        <h1 class=\"hue-doc-title-hive\">Common Table Expression</h1>\n        </div>\n\n        <!--<div id=\"toc\" class=\"content prepend-top\">\n            <h1>Table of Contents</h1>\n            $replacement.render(\"toc\")\n        </div>-->\n\n        <div id=\"src-38572242\">\n            <p>\n    A Common Table Expression (CTE) is a temporary result set derived from a simple query specified in a WITH clause, which immediately precedes a SELECT or INSERT keyword. The CTE is defined only within the execution scope of a single statement. One or more CTEs can be used in a Hive <a class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"_27362043\">SELECT</a>, <a data-doc-anchor-id=\"src-27362036_LanguageManualDML-InsertingdataintoHiveTablesfromqueries\" class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"_27362036\">INSERT</a>, <a data-doc-anchor-id=\"src-27362034_safe-id-TGFuZ3VhZ2VNYW51YWxEREwtQ3JlYXRlVGFibGVBc1NlbGVjdChDVEFTKQ\" class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"_27362034\">CREATE TABLE AS SELECT</a>, or <a data-doc-anchor-id=\"src-27362034_LanguageManualDDL-CreateView\" class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"_27362034\">CREATE VIEW AS SELECT</a> statement.            </p>\n        <div class=\"hue-doc-note-hive\">\n            <div>Version</div>\n                    <p>\n    Common Table Expressions are added in Hive 0.13.0 with <a class=\"hue-doc-external-link\" href=\"https://issues.apache.org/jira/browse/HIVE-1180\" target=\"_blank\">HIVE-1180</a>.            </p>\n        </div>\n        <div id=\"src-38572242_CommonTableExpression-CommonTableExpressionSyntax\">\n        <h2><span>Common Table Expression Syntax</span></h2>\n    <div style=\"counter-reset: scroll-code-numbering 1\">\n                <div class=\"hue-doc-codeblock\">withClause: cteClause (, cteClause)*\ncteClause: cte_name AS (select statment)\n</div>\n    </div>\n    <div id=\"src-38572242_CommonTableExpression-AdditionalGrammarRules\">\n        <h3><span>Additional Grammar Rules</span></h3>\n<ul><li>            <p>\n    The WITH clause is not supported within SubQuery Blocks            </p>\n    </li><li>            <p>\n    CTEs are supported in Views, CTAS and INSERT statements.            </p>\n    </li><li>            <p>\n    <a class=\"hue-doc-external-link\" href=\"http://wiki.postgresql.org/wiki/CTEReadme#Parsing_recursive_queries\" target=\"_blank\">Recursive Queries</a> are not supported.            </p>\n    </li></ul>    </div>\n    </div>\n    <div id=\"src-38572242_CommonTableExpression-Examples\">\n        <h2><span>Examples</span></h2>\n    <div id=\"src-38572242_CommonTableExpression-CTEinSelectStatements\">\n        <h3><span>CTE in Select Statements</span></h3>\n    <div style=\"counter-reset: scroll-code-numbering 1\">\n                <div class=\"hue-doc-codeblock\">with q1 as ( select key from src where key = '5')\nselect *\nfrom q1;\n \n-- from style\nwith q1 as (select * from src where key= '5')\nfrom q1\nselect *;\n \n-- chaining CTEs\nwith q1 as ( select key from q2 where key = '5'),\nq2 as ( select key from src where key = '5')\nselect * from (select key from q1) a;\n \n-- union example\nwith q1 as (select * from src where key= '5'),\nq2 as (select * from src s2 where key = '4')\nselect * from q1 union all select * from q2;\n</div>\n    </div>\n    </div>\n    <div id=\"src-38572242_safe-id-Q29tbW9uVGFibGVFeHByZXNzaW9uLUNURWluVmlld3MsQ1RBUyxhbmRJbnNlcnRTdGF0ZW1lbnRz\">\n        <h3><span>CTE in Views, CTAS, and Insert Statements</span></h3>\n    <div style=\"counter-reset: scroll-code-numbering 1\">\n                <div class=\"hue-doc-codeblock\">-- insert example\ncreate table s1 like src;\nwith q1 as ( select key, value from src where key = '5')\nfrom q1\ninsert overwrite table s1\nselect *;\n \n-- ctas example\ncreate table s2 as\nwith q1 as ( select key from src where key = '4')\nselect * from q1;\n \n-- view example\ncreate view v1 as\nwith q1 as ( select key from src where key = '5')\nselect * from q1;\nselect * from v1;\n \n-- view example, name collision\ncreate view v1 as\nwith q1 as ( select key from src where key = '5')\nselect * from q1;\nwith q1 as ( select key from src where key = '4')\nselect * from v1;\n</div>\n    </div>\n            <p>\n    In the second View example, a query's CTE is different from the CTE used when creating the view. The result will contain rows with key = '5' because in the view's query statement the CTE defined in the view definition takes effect.            </p>\n                <p>\n    Also see this JIRA:            </p>\n    <ul><li>            <p>\n    <a class=\"hue-doc-external-link\" href=\"https://issues.apache.org/jira/browse/HIVE-1180\" target=\"_blank\">HIVE-1180</a> Support Common Table Expressions (CTEs) in Hive            </p>\n    </li></ul>    </div>\n    </div>\n        </div>\n    </div></div>","title":"Common Table Expression"}