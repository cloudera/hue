{"body":"<div><div>\n        <div id=\"title\">\n                        <h1 class=\"hue-doc-title-hive\">Windowing and Analytics Functions</h1>\n        </div>\n\n        <!--<div id=\"toc\" class=\"content prepend-top\">\n            <h1>Table of Contents</h1>\n            $replacement.render(\"toc\")\n        </div>-->\n\n        <div id=\"src-31819589\">\n            <p>\n                </p>\n    <ul><li>            <p>\n    <a data-doc-anchor-id=\"src-31819589_LanguageManualWindowingAndAnalytics-WindowingandAnalyticsFunctions\" class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"_31819589\">Windowing and Analytics Functions</a>            </p>\n    <ul><li>            <p>\n    <a data-doc-anchor-id=\"src-31819589_LanguageManualWindowingAndAnalytics-EnhancementstoHiveQL\" class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"_31819589\">Enhancements to Hive QL</a>            </p>\n    </li><li>            <p>\n    <a data-doc-anchor-id=\"src-31819589_LanguageManualWindowingAndAnalytics-Examples\" class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"_31819589\">Examples</a>            </p>\n    <ul><li>            <p>\n    <a data-doc-anchor-id=\"src-31819589_safe-id-TGFuZ3VhZ2VNYW51YWxXaW5kb3dpbmdBbmRBbmFseXRpY3MtUEFSVElUSU9OQll3aXRob25lcGFydGl0aW9uaW5nY29sdW1uLG5vT1JERVJCWW9yd2luZG93c3BlY2lmaWNhdGlvbg\" class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"_31819589\">PARTITION BY with one partitioning column, no ORDER BY or window specification</a>            </p>\n    </li><li>            <p>\n    <a data-doc-anchor-id=\"src-31819589_safe-id-TGFuZ3VhZ2VNYW51YWxXaW5kb3dpbmdBbmRBbmFseXRpY3MtUEFSVElUSU9OQll3aXRodHdvcGFydGl0aW9uaW5nY29sdW1ucyxub09SREVSQllvcndpbmRvd3NwZWNpZmljYXRpb24\" class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"_31819589\">PARTITION BY with two partitioning columns, no ORDER BY or window specification</a>            </p>\n    </li><li>            <p>\n    <a data-doc-anchor-id=\"src-31819589_safe-id-TGFuZ3VhZ2VNYW51YWxXaW5kb3dpbmdBbmRBbmFseXRpY3MtUEFSVElUSU9OQll3aXRob25lcGFydGl0aW9uaW5nY29sdW1uLG9uZU9SREVSQlljb2x1bW4sYW5kbm93aW5kb3dzcGVjaWZpY2F0aW9u\" class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"_31819589\">PARTITION BY with one partitioning column, one ORDER BY column, and no window specification</a>            </p>\n    </li><li>            <p>\n    <a data-doc-anchor-id=\"src-31819589_safe-id-TGFuZ3VhZ2VNYW51YWxXaW5kb3dpbmdBbmRBbmFseXRpY3MtUEFSVElUSU9OQll3aXRodHdvcGFydGl0aW9uaW5nY29sdW1ucyx0d29PUkRFUkJZY29sdW1ucyxhbmRub3dpbmRvd3NwZWNpZmljYXRpb24\" class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"_31819589\">PARTITION BY with two partitioning columns, two ORDER BY columns, and no window specification</a>            </p>\n    </li><li>            <p>\n    <a data-doc-anchor-id=\"src-31819589_safe-id-TGFuZ3VhZ2VNYW51YWxXaW5kb3dpbmdBbmRBbmFseXRpY3MtUEFSVElUSU9OQll3aXRocGFydGl0aW9uaW5nLE9SREVSQlksYW5kd2luZG93c3BlY2lmaWNhdGlvbg\" class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"_31819589\">PARTITION BY with partitioning, ORDER BY, and window specification</a>            </p>\n    </li><li>            <p>\n    <a data-doc-anchor-id=\"src-31819589_LanguageManualWindowingAndAnalytics-WINDOWclause\" class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"_31819589\">WINDOW clause</a>            </p>\n    </li><li>            <p>\n    <a data-doc-anchor-id=\"src-31819589_LanguageManualWindowingAndAnalytics-LEADusingdefault1rowleadandnotspecifyingdefaultvalue\" class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"_31819589\">LEAD using default 1 row lead and not specifying default value</a>            </p>\n    </li><li>            <p>\n    <a data-doc-anchor-id=\"src-31819589_LanguageManualWindowingAndAnalytics-LAGspecifyingalagof3rowsanddefaultvalueof0\" class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"_31819589\">LAG specifying a lag of 3 rows and default value of 0</a>            </p>\n    </li><li>            <p>\n    <a data-doc-anchor-id=\"src-31819589_LanguageManualWindowingAndAnalytics-Distinctcountingforeachpartition\" class=\"hue-doc-internal-link\" href=\"javascript:void(0);\" data-doc-ref=\"_31819589\">Distinct counting for each partition</a>            </p>\n    </li></ul></li></ul></li></ul>    <div id=\"src-31819589_LanguageManualWindowingAndAnalytics-EnhancementstoHiveQL\">\n        <h2><span>Enhancements to Hive QL</span></h2>\n    <div class=\"hue-doc-note-hive\">\n            <div>Version</div>\n                    <p>\n    Introduced in Hive version 0.11.            </p>\n        </div>\n                <p>\n    This section introduces the Hive QL enhancements for windowing and analytics functions. See \"<a class=\"hue-doc-external-link\" href=\"https://issues.apache.org/jira/secure/attachment/12575830/WindowingSpecification.pdf\" target=\"_blank\">Windowing Specifications in HQL</a>\" (attached to <a class=\"hue-doc-external-link\" href=\"https://issues.apache.org/jira/browse/HIVE-4197\" target=\"_blank\">HIVE-4197</a>) for details. <a class=\"hue-doc-external-link\" href=\"https://issues.apache.org/jira/browse/HIVE-896\" target=\"_blank\">HIVE-896</a> has more information, including links to earlier documentation in the initial comments.            </p>\n                <p>\n    All of the windowing and analytics functions operate as per the SQL standard.            </p>\n                <p>\n    The current release supports the following functions for windowing and analytics:            </p>\n    <ol><li>            <p>\n    Windowing functions            </p>\n    <ul><li>            <p>\n    LEAD            </p>\n    <ul><li>            <p>\n    The number of rows to lead can optionally be specified. If the number of rows to lead is not specified, the lead is one row.            </p>\n    </li><li>            <p>\n    Returns null when the lead for the current row extends beyond the end of the window.            </p>\n    </li></ul></li><li>            <p>\n    LAG            </p>\n    <ul><li>            <p>\n    The number of rows to lag can optionally be specified. If the number of rows to lag is not specified, the lag is one row.            </p>\n    </li><li>            <p>\n    Returns null when the lag for the current row extends before the beginning of the window.            </p>\n    </li></ul></li><li>            <p>\n    FIRST_VALUE            </p>\n    <ul><li>            <p>\n    This takes at most two parameters. The first parameter is the column for which you want the first value, the second (optional) parameter must be a boolean which is <tt>false</tt> by default. If set to true it skips null values.            </p>\n    </li></ul></li><li>            <p>\n    LAST_VALUE            </p>\n    <ul><li>            <p>\n    This takes at most two parameters. The first parameter is the column for which you want the last value, the second (optional) parameter must be a boolean which is <tt>false</tt> by default. If set to true it skips null values.            </p>\n    </li></ul></li></ul></li><li>            <p>\n    The OVER clause            </p>\n    <ul><li>            <p>\n    OVER with standard aggregates:            </p>\n    <ul><li>            <p>\n    COUNT            </p>\n    </li><li>            <p>\n    SUM            </p>\n    </li><li>            <p>\n    MIN            </p>\n    </li><li>            <p>\n    MAX            </p>\n    </li><li>            <p>\n    AVG            </p>\n    </li></ul></li><li>            <p>\n    OVER with a PARTITION BY statement with one or more partitioning columns of any primitive datatype.            </p>\n    </li><li>            <p>\n    OVER with PARTITION BY and ORDER BY            </p>\n        <span id=\"src-31819589_LanguageManualWindowingAndAnalytics-OVERwithPARTITIONBYandORDERBY\"><a name=\"src-31819589_LanguageManualWindowingAndAnalytics-OVERwithPARTITIONBYandORDERBY\"></a></span>\n            <p>\n    with one or more partitioning and/or ordering columns of any datatype.            </p>\n    <ul><li>            <p>\n    OVER with a window specification. Windows can be defined separately in a WINDOW clause. Window specifications support the following formats:            </p>\n        <div>\n                <div>\n        <pre><code>(ROWS | RANGE) BETWEEN (UNBOUNDED | [num]) PRECEDING AND ([num] PRECEDING | CURRENT ROW | (UNBOUNDED | [num]) FOLLOWING)\n(ROWS | RANGE) BETWEEN CURRENT ROW AND (CURRENT ROW | (UNBOUNDED | [num]) FOLLOWING)\n(ROWS | RANGE) BETWEEN [num] FOLLOWING AND (UNBOUNDED | [num]) FOLLOWING</code></pre>\n        </div>\n    </div>\n            <p>\n    When ORDER BY is specified with missing WINDOW clause, the WINDOW specification defaults to <tt>RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW.</tt>            </p>\n                <p>\n    When both ORDER BY and WINDOW clauses are missing, the WINDOW specification defaults to <tt>ROW BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING.</tt>            </p>\n        <div class=\"hue-doc-note-hive\">\n                    <p>\n    The OVER clause supports the following functions, but it does not support a window with them (see <a class=\"hue-doc-external-link\" href=\"https://issues.apache.org/jira/browse/HIVE-4797\" target=\"_blank\">HIVE-4797</a>):            </p>\n                <p>\n    Ranking functions: Rank, NTile, DenseRank, CumeDist, PercentRank.            </p>\n                <p>\n    Lead and Lag functions.            </p>\n        </div>\n    </li></ul></li></ul></li><li>            <p>\n    Analytics functions            </p>\n    <ul><li>            <p>\n    RANK            </p>\n    </li><li>            <p>\n    ROW_NUMBER            </p>\n    </li><li>            <p>\n    DENSE_RANK            </p>\n    </li><li>            <p>\n    CUME_DIST            </p>\n    </li><li>            <p>\n    PERCENT_RANK            </p>\n    </li><li>            <p>\n    NTILE            </p>\n    </li></ul></li><li>            <p>\n    Distinct support in Hive 2.1.0 and later (see <a class=\"hue-doc-external-link\" href=\"https://issues.apache.org/jira/browse/HIVE-9534\" target=\"_blank\">HIVE-9534</a>)            </p>\n                <p>\n    Distinct is supported for aggregation functions including SUM, COUNT and AVG, which aggregate over the distinct values within each partition. Current implementation has the limitation that no ORDER BY or window specification can be supported in the partitioning clause for performance reason. The supported syntax is as follows.            </p>\n        <div style=\"counter-reset: scroll-code-numbering 1\">\n                <div class=\"hue-doc-codeblock\">COUNT(DISTINCT a) OVER (PARTITION BY c)\n</div>\n    </div>\n            <p>\n    ORDER BY and window specification is supported for distinct in Hive 2.2.0 (see <a class=\"hue-doc-external-link\" href=\"https://issues.apache.org/jira/browse/HIVE-13453\" target=\"_blank\">HIVE-13453</a>). An example is as follows.            </p>\n        <div style=\"counter-reset: scroll-code-numbering 1\">\n                <div class=\"hue-doc-codeblock\">COUNT(DISTINCT a) OVER (PARTITION BY c ORDER BY d ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING)\n</div>\n    </div>\n</li><li>            <p>\n    Aggregate functions in OVER clause support in Hive 2.1.0 and later (see <a class=\"hue-doc-external-link\" href=\"https://issues.apache.org/jira/browse/HIVE-13475\" target=\"_blank\">HIVE-13475</a>)            </p>\n                <p>\n    Support to reference aggregate functions within the OVER clause has been added. For instance, currently we can use the SUM aggregation function within the OVER clause as follows.            </p>\n        <div style=\"counter-reset: scroll-code-numbering 1\">\n                <div class=\"hue-doc-codeblock\">SELECT rank() OVER (ORDER BY sum(b))\nFROM T\nGROUP BY a;\n</div>\n    </div>\n</li></ol>    </div>\n    <div id=\"src-31819589_LanguageManualWindowingAndAnalytics-Examples\">\n        <h2><span>Examples</span></h2>\n            <p>\n    This section provides examples of how to use the Hive QL windowing and analytics functions in SELECT statements. See <a class=\"hue-doc-external-link\" href=\"https://issues.apache.org/jira/browse/HIVE-896\" target=\"_blank\">HIVE-896</a> for additional examples.            </p>\n        <div id=\"src-31819589_safe-id-TGFuZ3VhZ2VNYW51YWxXaW5kb3dpbmdBbmRBbmFseXRpY3MtUEFSVElUSU9OQll3aXRob25lcGFydGl0aW9uaW5nY29sdW1uLG5vT1JERVJCWW9yd2luZG93c3BlY2lmaWNhdGlvbg\">\n        <h3><span>PARTITION BY with one partitioning column, no ORDER BY or window specification</span></h3>\n    <div style=\"counter-reset: scroll-code-numbering 1\">\n                <div class=\"hue-doc-codeblock\">SELECT a, COUNT(b) OVER (PARTITION BY c)\nFROM T;\n</div>\n    </div>\n    </div>\n    <div id=\"src-31819589_safe-id-TGFuZ3VhZ2VNYW51YWxXaW5kb3dpbmdBbmRBbmFseXRpY3MtUEFSVElUSU9OQll3aXRodHdvcGFydGl0aW9uaW5nY29sdW1ucyxub09SREVSQllvcndpbmRvd3NwZWNpZmljYXRpb24\">\n        <h3><span>PARTITION BY with two partitioning columns, no ORDER BY or window specification</span></h3>\n    <div style=\"counter-reset: scroll-code-numbering 1\">\n                <div class=\"hue-doc-codeblock\">SELECT a, COUNT(b) OVER (PARTITION BY c, d)\nFROM T;\n</div>\n    </div>\n    </div>\n    <div id=\"src-31819589_safe-id-TGFuZ3VhZ2VNYW51YWxXaW5kb3dpbmdBbmRBbmFseXRpY3MtUEFSVElUSU9OQll3aXRob25lcGFydGl0aW9uaW5nY29sdW1uLG9uZU9SREVSQlljb2x1bW4sYW5kbm93aW5kb3dzcGVjaWZpY2F0aW9u\">\n        <h3><span>PARTITION BY with one partitioning column, one ORDER BY column, and no window specification</span></h3>\n    <div style=\"counter-reset: scroll-code-numbering 1\">\n                <div class=\"hue-doc-codeblock\">SELECT a, SUM(b) OVER (PARTITION BY c ORDER BY d)\nFROM T;\n</div>\n    </div>\n    </div>\n    <div id=\"src-31819589_safe-id-TGFuZ3VhZ2VNYW51YWxXaW5kb3dpbmdBbmRBbmFseXRpY3MtUEFSVElUSU9OQll3aXRodHdvcGFydGl0aW9uaW5nY29sdW1ucyx0d29PUkRFUkJZY29sdW1ucyxhbmRub3dpbmRvd3NwZWNpZmljYXRpb24\">\n        <h3><span>PARTITION BY with two partitioning columns, two ORDER BY columns, and no window specification</span></h3>\n    <div style=\"counter-reset: scroll-code-numbering 1\">\n                <div class=\"hue-doc-codeblock\">SELECT a, SUM(b) OVER (PARTITION BY c, d ORDER BY e, f)\nFROM T;\n</div>\n    </div>\n    </div>\n    <div id=\"src-31819589_safe-id-TGFuZ3VhZ2VNYW51YWxXaW5kb3dpbmdBbmRBbmFseXRpY3MtUEFSVElUSU9OQll3aXRocGFydGl0aW9uaW5nLE9SREVSQlksYW5kd2luZG93c3BlY2lmaWNhdGlvbg\">\n        <h3><span>PARTITION BY with partitioning, ORDER BY, and window specification</span></h3>\n    <div style=\"counter-reset: scroll-code-numbering 1\">\n                <div class=\"hue-doc-codeblock\">SELECT a, SUM(b) OVER (PARTITION BY c ORDER BY d ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)\nFROM T;\n</div>\n    </div>\n    <div style=\"counter-reset: scroll-code-numbering 1\">\n                <div class=\"hue-doc-codeblock\">SELECT a, AVG(b) OVER (PARTITION BY c ORDER BY d ROWS BETWEEN <span class=\"hue-doc-varname\">3</span> PRECEDING AND CURRENT ROW)\nFROM T;\n</div>\n    </div>\n    <div style=\"counter-reset: scroll-code-numbering 1\">\n                <div class=\"hue-doc-codeblock\">SELECT a, AVG(b) OVER (PARTITION BY c ORDER BY d ROWS BETWEEN <span class=\"hue-doc-varname\">3</span> PRECEDING AND <span class=\"hue-doc-varname\">3</span> FOLLOWING)\nFROM T;\n</div>\n    </div>\n    <div style=\"counter-reset: scroll-code-numbering 1\">\n                <div class=\"hue-doc-codeblock\">SELECT a, AVG(b) OVER (PARTITION BY c ORDER BY d ROWS BETWEEN CURRENT ROW AND UNBOUNDED FOLLOWING)\nFROM T;\n</div>\n    </div>\n            <p>\n                </p>\n                <p>\n    There can be multiple <tt>OVER</tt> clauses in a single query. A single <tt>OVER</tt> clause only applies to the immediately preceding function call. In this example, the first OVER clause applies to COUNT(b) and the second OVER clause applies to SUM(b):            </p>\n        <div style=\"counter-reset: scroll-code-numbering 1\">\n                <div class=\"hue-doc-codeblock\">SELECT \n a,\n COUNT(b) OVER (PARTITION BY c),\n SUM(b) OVER (PARTITION BY c)\nFROM T;\n</div>\n    </div>\n            <p>\n                </p>\n                <p>\n    Aliases can be used as well, with or without the keyword AS:            </p>\n        <div style=\"counter-reset: scroll-code-numbering 1\">\n                <div class=\"hue-doc-codeblock\">SELECT \n a,\n COUNT(b) OVER (PARTITION BY c) AS b_count,\n SUM(b) OVER (PARTITION BY c) b_sum\nFROM T;\n</div>\n    </div>\n    </div>\n    <div id=\"src-31819589_LanguageManualWindowingAndAnalytics-WINDOWclause\">\n        <h3><span>WINDOW clause</span></h3>\n    <div style=\"counter-reset: scroll-code-numbering 1\">\n                <div class=\"hue-doc-codeblock\">SELECT a, SUM(b) OVER w\nFROM T\nWINDOW w AS (PARTITION BY c ORDER BY d ROWS UNBOUNDED PRECEDING);\n</div>\n    </div>\n    </div>\n    <div id=\"src-31819589_LanguageManualWindowingAndAnalytics-LEADusingdefault1rowleadandnotspecifyingdefaultvalue\">\n        <h3><span>LEAD using default 1 row lead and not specifying default value</span></h3>\n    <div style=\"counter-reset: scroll-code-numbering 1\">\n                <div class=\"hue-doc-codeblock\">SELECT a, LEAD(a) OVER (PARTITION BY b ORDER BY C)\nFROM T;\n</div>\n    </div>\n    </div>\n    <div id=\"src-31819589_LanguageManualWindowingAndAnalytics-LAGspecifyingalagof3rowsanddefaultvalueof0\">\n        <h3><span>LAG specifying a lag of 3 rows and default value of 0</span></h3>\n    <div style=\"counter-reset: scroll-code-numbering 1\">\n                <div class=\"hue-doc-codeblock\">SELECT a, LAG(a, <span class=\"hue-doc-varname\">3</span>, <span class=\"hue-doc-varname\">0</span>) OVER (PARTITION BY b ORDER BY C)\nFROM T;\n</div>\n    </div>\n    </div>\n    <div id=\"src-31819589_LanguageManualWindowingAndAnalytics-Distinctcountingforeachpartition\">\n        <h3><span>Distinct counting for each partition</span></h3>\n    <div style=\"counter-reset: scroll-code-numbering 1\">\n                <div class=\"hue-doc-codeblock\">SELECT a, COUNT(distinct a) OVER (PARTITION BY b)\nFROM T;\n</div>\n    </div>\n    </div>\n    </div>\n        </div>\n    </div></div>","title":"WindowingAndAnalytics"}